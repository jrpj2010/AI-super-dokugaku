# Day 2: Composerエージェント完全攻略 - AIが自動でファイル作成・編集

## 🚀 学習目標

1. **Composerエージェントの威力を体感する**
   - 複数ファイルの同時編集機能
   - ターミナルコマンドの自動実行
   - コードベース全体の理解と修正
   - インラインdiffで変更内容を確認

2. **AI補完とRAG構築の基礎**
   - Docsフィーチャーで独自のRAGを構築
   - @記法でファイルやフォルダを参照
   - 外部ドキュメント（Supabase、Clerk等）の活用
   - コンテキストウィンドウの管理術

3. **.cursorrulesでAIの振る舞いをカスタマイズ**
   - プロジェクト固有のルール設定
   - コーディング規約の自動適用
   - 使用技術スタックの固定化
   - チーム開発での活用方法

## ✅ 事前準備チェックリスト

- [ ] Day 1の宿題完了（Cursorのインストール）
- [ ] 簡単なHTMLファイルを作成済み
- [ ] Claude 3.7 Sonnet思考モデルの設定完了
- [ ] プロジェクトフォルダの作成
- [ ] インターネット接続の確認

## 📋 詳細カリキュラム（60分）

### 1. オープニング・前回の振り返り（5分）
- Day 1の宿題共有（作成したHTMLページ）
- 本日の目標確認：「フルスタック開発者をゲット」
- デモ：67分でSNSアプリを作った事例の詳細解説

### 2. Composerエージェントの全機能解説（20分）

**Step 1: エージェントモードの基本操作（7分）**

```
重要な概念：
- Agent Mode（デフォルト）：ファイル操作+ターミナル実行
- Chat Mode：質問応答のみ
- YOLO Mode：確認なしで全自動実行
```

**実践：ToDo管理アプリの作成**
```
プロンプト例：
「Next.jsでシンプルなToDo管理アプリを作成してください。
以下の機能を含めてください：
- タスクの追加・編集・削除
- 完了/未完了の切り替え
- ローカルストレージでのデータ保存
- レスポンシブデザイン（Tailwind CSS使用）」
```

**観察ポイント**
- 複数ファイルが同時に作成される様子
- package.jsonの自動生成
- 必要な依存関係の自動インストール
- ターミナルでの`npm install`実行

**Step 2: 複数ファイル編集の威力（7分）**

```
続きのプロンプト：
「このToDo管理アプリに以下の機能を追加してください：
- カテゴリー機能（仕事、プライベート、買い物）
- 期限設定機能
- 優先度（高・中・低）の設定
- フィルター機能」
```

**重要な機能**
- ファイル間の依存関係を理解した編集
- 一貫性のあるコード変更
- 自動的なインポート文の追加
- 型定義の自動生成（TypeScript）

**Step 3: エラー処理とデバッグ（6分）**

```
デバッグプロンプト：
「アプリを実行しようとしたらエラーが出ました。
これを見て修正してください：
[エラーメッセージをペースト]」
```

**デバッグのコツ**
- ブラウザのコンソールログをそのままペースト
- 「Inspect → Console」でエラーを確認
- スクリーンショットも活用（Cmd/Ctrl + V）
- エラーは「学習の機会」として捉える

### 3. AI補完とRAG構築（15分）

**Step 1: Docsフィーチャーの活用（5分）**

```
設定方法：
1. Cmd/Ctrl + , で設定を開く
2. Features → Docs → Add new doc
3. 外部ドキュメントのURLを追加
   - Supabase docs
   - Firebase docs
   - Tailwind CSS docs
   - 社内ドキュメント
```

**実践例：Supabaseを使ったデータベース連携**
```
「@supabase-docs を参照して、
ToDo管理アプリをSupabaseデータベースに
接続してください。認証機能も追加して。」
```

**Step 2: @記法でファイル参照（5分）**

```
@記法の使い方：
- @ファイル名：特定ファイルを参照
- @フォルダ名：フォルダ全体を参照
- @コードベース：プロジェクト全体を参照
- @Docs：追加したドキュメントを参照
```

**実践例**
```
「@components/TodoItem.tsx のデザインを
@design-system.md のガイドラインに
合わせて修正してください」
```

**Step 3: コンテキスト管理のベストプラクティス（5分）**

```
重要な原則：
1. 「新しいチャットは頻繁に作る」
2. 長くなったら即座に新規チャット
3. 関連性の高いファイルだけを@で指定
4. 不要なファイルは.gitignoreに追加
```

### 4. .cursorrulesでAIをカスタマイズ（15分）

**Step 1: .cursorrulesファイルの作成（5分）**

```markdown
# .cursorrules の例

## プロジェクト概要
このプロジェクトはNext.js 14 App Routerを使用した
ToDo管理アプリケーションです。

## 技術スタック
- フロントエンド: Next.js 14, React 18, TypeScript
- スタイリング: Tailwind CSS
- データベース: Supabase
- 認証: Supabase Auth
- 状態管理: React Context API

## コーディング規約
- 全てTypeScriptで記述
- 関数コンポーネントのみ使用（クラスコンポーネント禁止）
- Server ActionsとServer Componentsを優先
- "use client"は最小限に

## 重要な制約
- SQLiteやJSONファイルでのデータ保存は禁止
- 必ずSupabaseを使用すること
- console.logは本番環境で削除すること
```

**Step 2: チーム開発での活用（5分）**

```markdown
## チーム固有のルール

### 命名規則
- コンポーネント: PascalCase
- 関数: camelCase  
- 定数: UPPER_SNAKE_CASE
- ファイル: kebab-case

### ディレクトリ構造
app/
├── (auth)/          # 認証が必要なページ
├── (public)/        # 公開ページ
├── components/      # 共通コンポーネント
├── lib/            # ユーティリティ
└── types/          # 型定義

### Git コミットメッセージ
- feat: 新機能
- fix: バグ修正
- docs: ドキュメント
- style: スタイル調整
- refactor: リファクタリング
```

**Step 3: 実践的な活用例（5分）**

```
プロンプト例：
「新しい機能を追加する際は、
必ず.cursorrulesに従って実装してください。
タスクにタグ機能を追加して。」
```

**高度な設定例**
```markdown
## AIへの特別な指示

### エラーハンドリング
- 全ての非同期処理にtry-catchを追加
- ユーザーフレンドリーなエラーメッセージ
- Sentryへのエラー送信

### パフォーマンス最適化
- 画像は全てnext/imageを使用
- 動的インポートでコード分割
- React.memoで不要な再レンダリング防止
```

### 5. 実践演習（5分）

**課題：チーム開発環境の構築**

1. **プロジェクトセットアップ**
   - 新規Next.jsプロジェクト作成
   - .cursorrulesファイル作成
   - 基本的なコンポーネント作成

2. **エージェント機能の活用**
   - 複数ファイルの同時編集を体験
   - エラーの自動修正を体験
   - ターミナルコマンドの自動実行

3. **RAG構築**
   - 外部ドキュメントを追加
   - @記法での参照を実践

### 6. まとめと次回予告（5分）

**本日の重要ポイント**
- Composerエージェントは「フルスタック開発者」
- .cursorrulesでAIの振る舞いを完全制御
- RAG構築で社内ナレッジを活用可能

**宿題**
1. 自分のプロジェクトに.cursorrulesを作成
2. よく使うドキュメントをDocsに追加
3. 複数ファイルにまたがる機能を1つ実装

**次回予告：Day 3 - 画像活用と音声入力で開発速度10倍**
- スクリーンショットからUIを自動生成
- 音声入力でハンズフリー開発
- デザインツールとの連携

## 💡 便利なプロンプト集

### Composerエージェント活用
- 「このプロジェクト全体をTypeScriptに移行してください」
- 「全てのコンポーネントにローディング状態を追加して」
- 「エラーハンドリングを全API呼び出しに追加して」

### RAG活用
- 「@supabase-docs を参照してリアルタイム機能を追加」
- 「@社内ガイドライン に従ってコードをリファクタリング」
- 「@design-system.md のカラーパレットを全体に適用」

### デバッグ
- 「このエラーを修正して：[エラーメッセージ]」
- 「パフォーマンスを改善してください」
- 「メモリリークの可能性がある箇所を特定して」

## 🔧 トラブルシューティング

### エージェントが動作しない
- Claude 3.7 Sonnet思考版を選択しているか確認
- Agent Modeになっているか確認
- API制限に達していないか確認

### ファイルが作成されない
- プロジェクトフォルダの権限を確認
- ディスク容量を確認
- .gitignoreの設定を確認

### コンテキストエラー
- 新しいチャットを開始
- 不要なファイルを参照から除外
- .cursorrulesを簡潔に保つ

## 📚 参考リンク・追加学習リソース

- [Cursor Agent公式ドキュメント](https://cursor.com/docs/agent)
- [.cursorrules サンプル集](https://github.com/cursor-rules)
- [Supabase Docs](https://supabase.com/docs)
- [Next.js App Router](https://nextjs.org/docs/app)
- [David Ondrej - Cursor Agent Tutorial](https://youtube.com/@davidondrej)
- [TANREN Composerエージェント事例](https://tanren.jp/composer-agent)

## 📝 受講メモ欄

（ここに本日の気づきや感想を記入してください）

---

**お疲れ様でした！**
Composerエージェントの力を手に入れました。次回はさらに開発速度を上げていきます！