"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8844],{8438:function(e,s,t){t.d(s,{Z:function(){return R}});var a=t(52676),i=t(43378),r=t(86811),l=t(75271),n=t(14386),d=t(7717),c=t(44342),o=t(77844),m=t(20061),x=t(60161),u=t(70017),h=t(65819),p=t(4590),v=t(31063),g=t(30674),_=t(96164),f=t(26595),j=t(29197);t(89335);var b=t(87106),N=t(95191),F=t(59892),w=t(54047);let k=e=>{var s,t,i;let{template:r,open:m}=e,k=(0,h.ZP)(e=>e.isLogin),y=(0,u.V)(),[C,E]=(0,l.useState)(!1),{isApp:D}=(0,c.b)(),S=(0,h.gQ)(),{setShareStep:A,showAgentStatus:Z=null==r?void 0:null===(s=r.permission)||void 0===s?void 0:s.read_permission,setShowAgentStatus:T,setSharePermission:B,updateSharePermission:I,sharePermission:z}=(0,w.Z)(),[R,L]=(0,l.useState)([]),[P,U]=(0,l.useState)([]),[O,V]=(0,l.useState)(!1),[M,H]=(0,l.useState)(null),W=(0,h.ZP)(e=>e.userInfo),q=null==W?void 0:null===(i=W.user_org_member)||void 0===i?void 0:null===(t=i.org_settings)||void 0===t?void 0:t.share_permission_config.space_content_share,J=(0,l.useMemo)(()=>{var e;return null==M?void 0:null===(e=M.permission)||void 0===e?void 0:e.is_self},[M]),[$,Y]=(0,l.useState)(!1),G=(0,d.useTranslations)(),K=(0,l.useMemo)(()=>!0===r.system,[r.system]),X=(0,l.useMemo)(()=>{var e,s;let t=null!==(s=null==z?void 0:null===(e=z.access_emails)||void 0===e?void 0:e.length)&&void 0!==s?s:0;return t>0?t:""},[null==z?void 0:z.access_emails]),Q=(0,l.useMemo)(()=>{var e,s;let t=null!==(s=null==z?void 0:null===(e=z.access_emails)||void 0===e?void 0:e.length)&&void 0!==s?s:0;return"PRIVATE"!==Z||J&&t>0},[null==z?void 0:z.access_emails,Z,J]);(0,l.useEffect)(()=>{m&&ee()},[m]);let ee=async()=>{Y(!0);try{let s=await (0,b.hi)(r.short_id),t=await (0,b.VN)(r.short_id);if(t.data){var e;H(t.data),B((null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.permission)||null)}s.data&&(L(s.data.filter(e=>!0===e.permission.is_self)||[]),U(s.data.filter(e=>!1===e.permission.is_self)||[]))}catch(e){console.log(e),L([]),U([])}finally{Y(!1)}},es=(0,l.useMemo)(()=>{let e=R.some(e=>"PRIVATE"===e.permission.read_permission),s=R.some(e=>"PARTIAL_PUBLIC"===e.permission.read_permission);return e||s},[R]),et=async e=>{let s=await (0,N.Y)(r.title),t=(0,F.b)(s),a="".concat(location.origin,"/agents/").concat(t,"-").concat(r.short_id);(0,p.eW)(e,"".concat(G("enterprise.share_agent_tip"),": ").concat(r.title,"\n  ").concat(a)),"whatsapp"===e?(0,v.fk)(x.U.TOPIC_SHARE_SHARE_WHATSAPP,{id:r.short_id},!0):"twitter"===e?(0,v.fk)(x.U.TOPIC_SHARE_SHARE_X,{id:r.short_id},!0):"facebook"===e?(0,v.fk)(x.U.TOPIC_SHARE_SHARE_FACEBOOK,{id:r.short_id},!0):"line"===e&&(0,v.fk)(x.U.TOPIC_SHARE_SHARE_LINE,{id:r.short_id},!0)},ea=async e=>{J&&(T(e),(0,b.qP)({read_permission:e,agent_id:r.short_id}))};(0,l.useEffect)(()=>{if(R.length<=0){V(!0);return}let e=R.every(e=>"PUBLIC"===e.permission.read_permission),s=R.some(e=>"PRIVATE"===e.permission.read_permission);e?V(!0):"PARTIAL_PUBLIC"!==Z||s?V(!1):V(!0)},[R,Z]),(0,l.useEffect)(()=>{if(M){var e;T((null===(e=M.permission)||void 0===e?void 0:e.read_permission)||"PRIVATE")}},[M]);let ei=async()=>{E(!0);let e=o.Z.getState().current,s=await (0,N.Y)(r.title),t=(0,F.b)(s),a="".concat(location.origin,"/agents/").concat(t,"-").concat(r.short_id),i=new URL("".concat(a));e&&i.searchParams.append("invite",e),y.copy(i.toString()),(0,v.fk)(x.U.SEARCH_AGENT_SIDEBAR_SHARE,{id:r.short_id},!0),setTimeout(()=>{E(!1)},3e3)},er=e=>{e.preventDefault(),e.stopPropagation(),(null==z?void 0:z.read_permission)!=="PRIVATE"&&ea("PRIVATE"),A(2),I({read_permission:"PRIVATE"})};return $?(0,a.jsx)("div",{className:"flex flex-col w-full ",children:(0,a.jsx)(g.c,{})}):(0,a.jsxs)(a.Fragment,{children:[k&&!K&&J&&(0,a.jsx)("div",{className:"w-full cursor-pointer border rounded-[12px] p-2 px-4 mb-4 box-border ".concat("PRIVATE"===Z?"border-[#0080FF]":"border-[#E4E7EC]"),onClick:()=>ea("PRIVATE"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-[16px]",children:[(0,a.jsx)("div",{className:"w-[32px] text-[#475467] dark:text-white",children:(0,a.jsx)(n.aL,{})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-[16px] font-bold text-[#344054] dark:text-white",children:G("shareThread.secret")}),(0,a.jsx)("div",{className:"text-[12px] text-[#98A2B3]",style:{lineHeight:"18px"},children:G.rich("share.onlyAuthorCanView",{link:e=>(0,a.jsx)("a",{href:"javascript:void(0)",className:"text-primary",onClick:er,children:e}),count:X})})]})]}),(0,a.jsx)("div",{children:"PRIVATE"===Z&&(0,a.jsx)(n.gw,{})})]})}),S&&(0,a.jsx)("div",{className:"w-full cursor-pointer border rounded-[12px] p-2 px-4 mb-4 box-border ".concat("PARTIAL_PUBLIC"===Z?"border-[#0080FF]":"border-[#E4E7EC]"),onClick:()=>ea("PARTIAL_PUBLIC"),style:{opacity:J?1:.3,cursor:J?"pointer":"not-allowed"},children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-[16px]",children:[(0,a.jsx)("div",{className:"w-[32px] text-[#475467] dark:text-white",children:(0,a.jsx)(n.Wv,{})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-[16px] font-bold text-[#344054] dark:text-white",children:G("shareThread.enterprise_title")}),(0,a.jsx)("div",{className:"text-[12px] text-[#98A2B3] ",style:{lineHeight:"18px"},children:G("shareThread.enterprise_desc")})]})]}),(0,a.jsx)("div",{children:"PARTIAL_PUBLIC"===Z&&(0,a.jsx)(n.gw,{})})]})}),(k&&J&&!S||k&&J&&S&&q||"PUBLIC"===Z)&&(0,a.jsx)("div",{className:"w-full cursor-pointer border rounded-[12px] p-2 px-4 box-border ".concat("PUBLIC"===Z?"border-[#0080FF]":"border-[#E4E7EC]"),onClick:()=>ea("PUBLIC"),style:{opacity:J?1:.3,cursor:J?"pointer":"not-allowed"},children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-[16px]",children:[(0,a.jsx)("div",{className:"w-[32px] text-[#475467] dark:text-white",children:(0,a.jsx)(n.u_,{})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-[16px] font-bold text-[#344054] dark:text-white",children:G("shareThread.shareable")}),(0,a.jsx)("div",{className:"text-[12px] text-[#98A2B3] ",style:{lineHeight:"18px"},children:G("shareThread.anyoneWithLinkCanView")})]})]}),(0,a.jsx)("div",{children:"PUBLIC"===Z&&(0,a.jsx)(n.gw,{})})]})}),es&&Q&&(0,a.jsx)("div",{className:"rounded-md  mt-6",children:(0,a.jsxs)("div",{className:"flex  gap-2 bg-[#FDF5EF] dark:bg-[#3C110E] text-[14px] text-[#D14625] dark:text-[#E68054] p-[16px] rounded-[8px]",children:[" ",(0,a.jsxs)("div",{className:"w-[24px]",children:[" ",(0,a.jsx)(j.Z,{size:24,className:"mt-[4px]"})]}),(0,a.jsx)("span",{children:G("agent.share_tip_desc")})]})}),Q&&(0,a.jsxs)(a.Fragment,{children:[!D&&(0,a.jsxs)("div",{className:"flex items-center justify-between w-full mt-8 shareSites",children:[(0,a.jsxs)("div",{onClick:()=>et("line"),className:"cursor-pointer flex flex-col items-center gap-2",children:[(0,a.jsx)("img",{className:"w-[48px]",src:"/shareThreadImg/line.png",alt:""}),(0,a.jsx)("div",{className:"text-[12px] text-[#98A2B3] dark:text-white",children:"LINE"})]}),(0,a.jsxs)("div",{onClick:()=>et("twitter"),className:"cursor-pointer flex flex-col items-center gap-2",children:[(0,a.jsx)("img",{className:"w-[48px]",src:"/shareThreadImg/twiterlogo.png",alt:""}),(0,a.jsx)("div",{className:"text-[12px] text-[#98A2B3] dark:text-white",children:"X/Twitter"})]}),(0,a.jsxs)("div",{onClick:()=>et("facebook"),className:"cursor-pointer flex flex-col items-center gap-2",children:[(0,a.jsx)("img",{className:"w-[48px]",src:"/shareThreadImg/fblogo.png",alt:""}),(0,a.jsx)("div",{className:"text-[12px] text-[#98A2B3] dark:text-white",children:"Facebook"})]}),(0,a.jsxs)("div",{onClick:()=>et("whatsapp"),className:"cursor-pointer flex flex-col items-center gap-2",children:[(0,a.jsx)("img",{className:"w-[48px]",src:"/shareThreadImg/whatsapp.png",alt:""}),(0,a.jsx)("div",{className:"text-[12px] text-[#98A2B3] dark:text-white",children:"WhatsApp"})]})]}),(0,a.jsx)("div",{className:"w-full  mt-8",children:(0,a.jsx)(_.e,{isOpen:C,content:(0,a.jsx)("div",{className:"p-2 bg-black bg-opacity-70 text-white rounded-lg dark:bg-white dark:text-black",children:G("shareThread.copySuccess")}),classNames:{content:["p-0"]},children:(0,a.jsx)(f.A,{className:"w-full h-[48px] rounded-[12px] text-[14px]",color:"primary",onClick:ei,children:G("shareThread.copyLink")})})})]})]})};var y=t(79395),C=t(15893),E=t(77249),D=t(25773),S=t(27151),A=t(5588),Z=t(25010),T=t(39109),B=t(3574),I=e=>{var s,t,r,n;let{template:c}=e,o=(0,d.useTranslations)(),m=(0,T.Z)(),x=(0,h.gQ)(),{setShareStep:u,sharePermission:p,updateSharePermission:v}=(0,w.Z)(),[g,_]=(0,l.useState)(""),[f,j]=(0,l.useState)(!1),[N,F]=(0,l.useState)(),k=async e=>{let{type:s,email:t}=e;if(null==p?void 0:p.is_self){var a,i;let e=[];if("add"===s){if((null==(e=(0,B.O)(g)||[])?void 0:e.some(e=>!(0,B.v)(e)))||!(null==e?void 0:e.length)){m.error(o("share.email_incorrect_tip"));return}if((null==e?void 0:e.length)>200){m.error(o("share.exceeding_quantity_limit_tip",{count:200}));return}}j(!0),F({type:s,email:t});let r=(null==p?void 0:null===(a=p.access_emails)||void 0===a?void 0:a.length)?null==p?void 0:p.access_emails:[],l=JSON.parse(JSON.stringify(r)),n="remove"===s?r.filter(e=>e!==t):[...e,...r];v({access_emails:n=[...new Set(n)],fail_emails:[]});let d=await (0,b.qP)({read_permission:"PRIVATE",agent_id:c.short_id,access_emails:n}),u=null==d?void 0:d.data;if(console.log("\uD83D\uDE80 ~ updateShare ~ result:",u),j(!1),u){if((null==d?void 0:d.status)!==200){let e=(null==d?void 0:d.code)==="ACCESS_EMAIL_OVER_LIMIT"?o("share.exceeding_quantity_limit_tip",{count:200}):o("server.INTERNAL_SERVER_ERROR");m.error(e),v({access_emails:l,fail_emails:[]}),_("");return}(null==u?void 0:null===(i=u.fail_emails)||void 0===i?void 0:i.length)?x&&m.error(o("share.not_add_outside_org")):m.success("remove"===s?o("share.remove_success_tip"):o("share.add_success_tip")),v({access_emails:(null==u?void 0:u.access_emails)||n,fail_emails:(null==u?void 0:u.fail_emails)||[]}),_("")}else m.default(o("server.INTERNAL_SERVER_ERROR")),v({access_emails:l,fail_emails:[]})}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.fK,{className:"flex justify-between items-center pb-3 border-b border-[#E4E7EC] md:dark:border-gray-500 dark:border-transparent md:mt-0 md:px-6 px-0 -mt-4",children:(0,a.jsxs)(i.$N,{className:"flex items-center gap-2 text-lg w-full",children:[(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>{u(1)},children:(0,a.jsx)(E.Z,{})}),o("share.person_visible")]})}),(0,a.jsx)("div",{className:"flex flex-col items-center w-full box-border shareContainer dark:border-[#2F333B]",children:(0,a.jsxs)("div",{className:"p-6 w-full",children:[(0,a.jsxs)("div",{className:"flex w-full max-w-sm items-center space-x-2",children:[(0,a.jsx)(A.I,{value:g,onChange:e=>{_(e.target.value)},type:"email",placeholder:o("share.add_email_placeholder"),className:"focus-visible:ring-0 focus-visible:ring-offset-0 h-8 text-xs",autoComplete:"off"}),(0,a.jsx)(Z.z,{type:"submit",size:"default",className:"text-xs",onClick:()=>{k({type:"add"})},disabled:f||!g,children:f&&(null==N?void 0:N.type)==="add"?(0,a.jsx)(D.Z,{className:"animate-spin"}):o("share.add_email")})]}),(0,a.jsx)("div",{className:"mt-4 text-sm text-gray-700 -mx-3 dark:text-gray-400",children:(0,a.jsx)("ul",{className:"flex flex-col max-h-80 min-h-40 gap-3 overflow-hidden overflow-y-auto felo--scrollbar px-3",children:(null==p?void 0:null===(s=p.access_emails)||void 0===s?void 0:s.length)||(null==p?void 0:null===(t=p.fail_emails)||void 0===t?void 0:t.length)?(0,a.jsxs)(a.Fragment,{children:[null==p?void 0:null===(r=p.fail_emails)||void 0===r?void 0:r.map((e,s)=>(0,a.jsxs)("li",{className:"flex w-full justify-between",children:[e,(0,a.jsx)(Z.z,{variant:"ghost",size:"sm",className:"text-sm font-normal h-4 px-1 text-red-500",disabled:!0,children:o("share.add_email_failure")})]},s)),null==p?void 0:null===(n=p.access_emails)||void 0===n?void 0:n.map((e,s)=>(0,a.jsxs)("li",{className:"flex w-full justify-between",children:[e,(0,a.jsx)(Z.z,{variant:"link",size:"sm",className:"text-sm font-normal h-4 px-1",onClick:()=>{k({type:"remove",email:e})},disabled:f,children:f&&(null==N?void 0:N.type)==="remove"&&(null==N?void 0:N.email)===e?(0,a.jsx)(D.Z,{className:"animate-spin"}):o("share.remove_email")})]},s))]}):(0,a.jsxs)("div",{className:"flex flex-col items-center min-h-40 justify-center text-base",children:[(0,a.jsx)("span",{className:"flex justify-center items-center w-16 h-16 rounded-full bg-[#EBEEF3] text-[#7F94B1] dark:bg-[#606B80]",children:(0,a.jsx)(S.Z,{size:30})}),(0,a.jsx)("p",{className:"pt-4 text-[#ABB9CD]",children:o("share.no_person_visible")})]})})})]})})]})},z=t(4814),R=e=>{let{template:s,open:t,onOpenChange:x}=e,{isMobile:u}=(0,c.b)(),h=(0,d.useTranslations)(),{shareStep:p,setShareStep:v}=(0,w.Z)(),[g,_]=(0,l.useState)(),f=()=>{let e=o.Z.getState().current,t="".concat(location.origin,"/search?").concat(y.Y,"=").concat(s.short_id),a=new URL("".concat(t));e&&a.searchParams.append("invite",e),m.toDataURL(a.toString(),{width:256,errorCorrectionLevel:"H",margin:0,color:{dark:"#0080ff00",light:"#F4F4F4FF"}}).then(e=>{_(e)}).catch(e=>{console.error(e)})};return((0,l.useEffect)(()=>{f()},[]),(0,l.useEffect)(()=>{t&&v(1)},[v,t]),u)?(0,a.jsx)(r.yo,{open:t,onOpenChange:x,children:(0,a.jsxs)(r.ue,{side:"bottom",className:"p-0",children:[(0,a.jsxs)("div",{className:(0,z.Z)(1===p?"":"hidden"),children:[(0,a.jsx)(r.Tu,{className:"p-6 flex justify-between items-center",children:(0,a.jsx)(r.bC,{className:"text-2xl w-full",children:h("enterprise.share_agent")})}),(0,a.jsx)("div",{className:(0,z.Z)("p-6"),children:(0,a.jsx)(k,{template:s,open:!0})})]}),(0,a.jsx)("div",{className:(0,z.Z)("p-6",2===p?"":"hidden"),children:(0,a.jsx)(I,{template:s})})]})}):(0,a.jsx)(i.Vq,{open:t,onOpenChange:x,children:(0,a.jsxs)(i.cZ,{className:(0,z.Z)("max-w-[396px] dark:bg-[#454E5D]"),"aria-describedby":void 0,children:[(0,a.jsxs)("div",{className:(0,z.Z)(1===p?"":"hidden"),children:[(0,a.jsx)(i.fK,{className:"flex justify-between items-center pb-3 border-b border-[#E4E7EC] dark:border-gray-500",children:(0,a.jsxs)(i.$N,{className:"flex items-center gap-2 text-lg w-full",children:[(0,a.jsx)("div",{className:"w-5",children:(0,a.jsx)(n.u_,{})}),h("enterprise.share_agent")]})}),(0,a.jsxs)("div",{className:"flex flex-col items-center w-full box-border shareContainer dark:border-[#2F333B] pb-6",children:[(0,a.jsx)("div",{className:"text-xl px-4 font-bold mt-6 mb-2 text-center",style:{wordBreak:"break-word",lineHeight:"28px",display:"block",overflowWrap:"break-word"},children:(null==s?void 0:s.title)||""}),(0,a.jsx)("div",{className:"text-slate-500 dark:text-[#F3F5F7] text-xs mb-4",children:h("agent.created_by",{name:(0,C.D)(s)})}),(0,a.jsx)("div",{className:"p-6 w-full",children:(0,a.jsx)(k,{template:s,open:t})})]})]}),(0,a.jsx)("div",{className:(0,z.Z)(2===p?"":"hidden"),children:(0,a.jsx)(I,{template:s})})]})})}},88844:function(e,s,t){var a=t(52676),i=t(81555),r=t(75271),l=t(43378),n=t(25010),d=t(25773),c=t(2348),o=t(35798),m=t(68644),x=t(60904),u=t(72696),h=t(77646),p=t(56984),v=t(7717),g=t(65819),_=t(17224),f=t.n(_),j=t(46571),b=t(2925),N=t(79187),F=t(19546),w=t(1167),k=t(87106),y=t(21133),C=t(67241),E=t(31063),D=t(60161),S=t(84706),A=t(8438),Z=t(95191),T=t(59892),B=t(15893),I=t(39109),z=t(53410),R=t(55480);s.Z=e=>{var s,t;let{template:_,defaultEdit:L=!1,open:P,onOpenChange:U,submitCallback:O}=e,V=(0,v.useTranslations)(),M=(0,I.Z)(),{userTemplates:H,addUserTemplate:W,addFavoriteTemplate:q,removeFavoriteTemplate:J,changeSystemTemplateFavorite:$,changeUserTemplateFavorite:Y,updateUserTemplate:G,removeUserTemplate:K,updateEnterpriseTemplate:X,addEnterpriseTemplate:Q,removeEnterpriseTemplate:ee,enterpriseTemplates:es,changeEnterpriseTemplateFavorite:et}=(0,F.Z)(),ea=(0,g.ZP)(e=>e.isLogin);(0,g.gQ)();let ei=(0,g.ZP)(e=>e.userInfo),{updatePinList:er}=(0,R.Z)(),[el,en]=(0,r.useState)(L),[ed,ec]=(0,r.useState)(!1),[eo,em]=(0,r.useState)(!1),[ex,eu]=(0,r.useState)(!1),[eh,ep]=(0,r.useState)(!1),ev=function(e){var s,t,a,i;let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];console.log("edit agent",_,e),(null==e?void 0:null===(s=e.org_sharing)||void 0===s?void 0:s.org_id)?X(e):G(e),r&&en(!1),null==O||O(e),(_.system||(null==_?void 0:null===(t=_.org_sharing)||void 0===t?void 0:t.org_id)!==(null==e?void 0:null===(a=e.org_sharing)||void 0===a?void 0:a.org_id))&&((null==e?void 0:null===(i=e.org_sharing)||void 0===i?void 0:i.org_id)?((null==H?void 0:H.length)&&K(e),(null==es?void 0:es.length)&&Q(e)):((null==H?void 0:H.length)&&W(e),(null==es?void 0:es.length)&&ee(null==e?void 0:e.short_id)))},eg=(0,r.useMemo)(()=>!0,[]),e_=(0,r.useMemo)(()=>!(null==_?void 0:_.system)&&(null==ei?void 0:ei.uid)===(null==_?void 0:_.uid),[null==_?void 0:_.system,null==_?void 0:_.uid,null==ei?void 0:ei.uid]),ef=(0,r.useMemo)(()=>eg||e_,[eg,e_]),ej=(0,r.useMemo)(()=>{var e;return!([i.W.CUSTOM,i.W.DIRECT_DUTY].includes(null==_?void 0:_.template_type)&&_.system)&&(null==_||null===(e=_.org_sharing)||void 0===e||!e.org_id||(null==ei?void 0:ei.uid)===(null==_?void 0:_.uid))},[null==_?void 0:_.uid,null==ei?void 0:ei.uid,_.template_type,null==_?void 0:null===(s=_.org_sharing)||void 0===s?void 0:s.org_id]),eb=(0,r.useMemo)(()=>{var e;return _.system||(null==_?void 0:null===(e=_.creator)||void 0===e?void 0:e.uid)!==(null==ei?void 0:ei.uid)?"create":"edit"},[_,null==ei?void 0:ei.uid]),eN=()=>{L?U(!1):en(!1)};(0,r.useEffect)(()=>{!P&&el&&setTimeout(()=>{en(!1)},500)},[P]);let eF=async()=>{U(!1);let e=await (0,Z.Y)(_.title),s=(0,T.b)(e),t="/agents/".concat(s,"-").concat(_.short_id);f().asPath!==t?f().push(t):window.location.reload()},ew=async()=>{var e,s;if(!_)return;ec(!0);let t=await (0,k.hX)([_.short_id]);if(!t.success){M.error((null==t?void 0:t.error)||V("delete_failed"));return}M.success(V("delete_success")),K(_),(null==_?void 0:null===(e=_.component)||void 0===e?void 0:e.component_key)&&J(_.short_id),(null==_?void 0:null===(s=_.org_sharing)||void 0===s?void 0:s.org_id)?F.Z.getState().removeEnterpriseTemplate(null==_?void 0:_.short_id):F.Z.getState().removeUserTemplate(_),ec(!1),eu(!1),U(!1)},ek=async()=>{var e,s;if(!ea){S.$.publish("showLogin",void 0);return}em(!0);let t=null==_?void 0:_.code,a=await (0,z.AA)({type:t?"agent_code":"agent",attributes:{agent_code:t,agent_id:null==_?void 0:_.short_id},priority:0,title:_.title});if(a.success){let s=null==a?void 0:a.data;er(s,!0),q(_),_.system?$(_.short_id,s):(null==_?void 0:null===(e=_.org_sharing)||void 0===e?void 0:e.org_id)?et(_.short_id,s):Y(_.short_id,s),M.success(V("agent.add_to_sidebar")),(0,E.fk)(D.U.SEARCH_AGENT_SIDEBAR_PING,{value:1},!0)}else{let e=(null==a?void 0:null===(s=a.error)||void 0===s?void 0:s.includes(z.nG))?V("agent.exceeding_quantity_limit",{count:8}):a.error||V("agent.add_failed");M.error(e)}em(!1)},ey=async()=>{var e,s,t;if(!(null==_?void 0:null===(e=_.component)||void 0===e?void 0:e.component_key)){M.error(V("agent.remove_failed"));return}em(!0);let a=await (0,z.sy)({key:null==_?void 0:null===(s=_.component)||void 0===s?void 0:s.component_key});a.success?(er(null==_?void 0:_.component,!1),J(_.short_id),_.system?$(_.short_id):(null==_?void 0:null===(t=_.org_sharing)||void 0===t?void 0:t.org_id)?et(_.short_id):Y(_.short_id),M.success(V("agent.remove_from_sidebar"))):M.error(a.error||V("agent.remove_failed")),em(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Vq,{open:P,onOpenChange:U,children:(0,a.jsxs)(l.cZ,{className:(0,j.cn)("transition-[width] duration-300 ease-in-out dark:bg-[#454E5D]",_.template_type===i.W.CUSTOM&&"w-[850px]",_.template_type===i.W.DEFAULT&&"w-[900px]",!el&&"w-[480px]","max-w-[95vw]"),hideCloseButton:!0,"aria-describedby":void 0,children:[(0,a.jsxs)(l.fK,{className:"flex flex-row items-center justify-between gap-4 space-y-0 pb-4 border-b border-border overflow-hidden",children:[(0,a.jsxs)("div",{className:"overflow-hidden",children:[(0,a.jsx)(l.$N,{className:"text-[#30394A] dark:text-white truncate",children:_.title}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground text-[#4B5F7E] dark:text-[#F3F5F7]",children:V("agent.created_by",{name:(0,B.D)(_)})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[!el&&(0,a.jsxs)(a.Fragment,{children:[(null==_?void 0:null===(t=_.component)||void 0===t?void 0:t.component_key)?(0,a.jsx)(w.pn,{children:(0,a.jsxs)(w.u,{delayDuration:300,children:[(0,a.jsx)(w.aJ,{asChild:!0,children:(0,a.jsx)(n.z,{variant:"ghost",size:"icon",onClick:ey,tabIndex:-1,disabled:eo,className:"dark:hover:bg-[#545D6F]",children:eo?(0,a.jsx)(d.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(c.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(w._v,{children:(0,a.jsx)("p",{children:V("agent.remove_sidebar")})})]})}):(0,a.jsx)(w.pn,{children:(0,a.jsxs)(w.u,{delayDuration:300,children:[(0,a.jsx)(w.aJ,{asChild:!0,children:(0,a.jsx)(n.z,{variant:"ghost",size:"icon",onClick:ek,tabIndex:-1,disabled:eo,className:"dark:hover:bg-[#545D6F]",children:eo?(0,a.jsx)(d.Z,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(w._v,{children:(0,a.jsx)("p",{children:V("agent.add_sidebar")})})]})}),ef?(0,a.jsxs)(u.h_,{children:[(0,a.jsx)(u.$F,{asChild:!0,children:(0,a.jsx)(n.z,{variant:"ghost",size:"icon",tabIndex:-1,className:"dark:hover:bg-[#545D6F]",children:(0,a.jsx)(m.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(u.AW,{align:"end",className:"border-[#EBEEF3] dark:bg-[#545D6F] dark:border-[#454E5D] p-3 rounded-lg",children:[eg?(0,a.jsxs)(u.Xi,{className:"dark:text-[#F3F5F7] dark:hover:bg-[#454E5D] cursor-pointer",onClick:e=>{e.stopPropagation(),ep(!0)},children:[(0,a.jsx)(y.FO,{className:"w-6 h-6"}),V("agent.share_agent")]}):null,e_?(0,a.jsxs)(u.Xi,{className:"dark:hover:bg-[#454E5D] cursor-pointer",onClick:()=>eu(!0),children:[(0,a.jsx)(C.vW,{className:"w-6 h-6 text-[#D14625] text-sm hover:text-[#D14625]"}),(0,a.jsx)("div",{className:"text-[#D14625] text-sm hover:text-[#D14625]",children:V("agent.delete_agent")})]}):null]})]}):null]}),(0,a.jsx)(n.z,{variant:"ghost",size:"icon",className:"dark:hover:bg-[#545D6F]",onClick:()=>U(!1),children:(0,a.jsx)(x.Z,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)(l.a7,{className:"w-full relative text-sm max-h-[calc(100vh-200px)] overflow-y-auto",children:[!el&&(_.template_type===i.W.CUSTOM||_.template_type===i.W.DIRECT_DUTY)&&(0,a.jsx)(h.Z,{template:_}),!el&&_.template_type===i.W.DEFAULT&&(0,a.jsx)(p.Z,{template:_}),el&&_.template_type===i.W.CUSTOM&&(0,a.jsx)(N.Z,{type:eb,template:_,onSubmit:ev,onCancel:eN}),el&&_.template_type===i.W.DEFAULT&&(0,a.jsx)(b.Z,{type:eb,template:_,onSubmit:ev,onCancel:eN})]}),!el&&(0,a.jsx)(l.cN,{children:(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[ea&&ej&&(0,a.jsx)(n.z,{variant:"outline",onClick:()=>en(!0),className:"border-[#0080FF] dark:border-[#0694FF] text-[#0080FF] dark:text-[#0694FF] hover:text-[#0080FF] bg-transparent hover:bg-transparent",children:V("agent.edit_agent")}),(0,a.jsx)(n.z,{onClick:eF,children:V("agent.apply_agent")})]})})]})}),(0,a.jsx)(l.Vq,{open:ex,onOpenChange:eu,children:(0,a.jsxs)(l.cZ,{children:[(0,a.jsxs)(l.fK,{children:[(0,a.jsx)(l.$N,{children:V("agent.delete_agent")}),(0,a.jsx)(l.Be,{children:V("agent.delete_agent_desc")})]}),(0,a.jsxs)(l.cN,{className:"gap-2",children:[(0,a.jsx)(n.z,{variant:"outline",onClick:()=>eu(!1),children:V("cancel")}),(0,a.jsxs)(n.z,{variant:"destructive",onClick:ew,disabled:ed,children:[ed?(0,a.jsx)(d.Z,{className:"w-4 h-4 animate-spin mr-2"}):null,ed?V("agent.deleting"):V("agent.confirm_delete")]})]})]})}),(0,a.jsx)(A.Z,{template:_,open:eh,onOpenChange:ep})]})}},56984:function(e,s,t){var a=t(52676),i=t(7717),r=t(75271);s.Z=e=>{let{template:s}=e,t=(0,i.useTranslations)(),l=(0,r.useMemo)(()=>s.sub_topics,[s]);return(0,a.jsxs)("div",{className:"space-y-6 pb-2",children:[s.introduction&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-[#5F7698] dark:text-[#D0D4DC]",children:t("agent.description")}),(0,a.jsx)("div",{className:"rounded-md bg-[#F6F7F9] dark:bg-[#353B46] p-3",children:s.introduction})]})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-[#5F7698] dark:text-[#D0D4DC]",children:t("agent.agent_query_steps")}),(0,a.jsx)("ol",{className:"bg-[#F6F7F9] dark:bg-[#353B46] p-4 rounded-md",children:l.map((e,s)=>(0,a.jsxs)("li",{className:"relative flex items-center",children:[s<l.length-1&&(0,a.jsx)("div",{className:"absolute left-[9px] top-[80%] h-[35%] w-px bg-border dark:bg-[#606B80]"}),(0,a.jsx)("div",{className:"flex h-5 w-5 bg-white border-[#D3D9E4] rounded-full dark:bg-[#454E5D] dark:border-[#606B80] items-center justify-center text-xs",children:s+1}),(0,a.jsx)("div",{className:"flex-1 rounded-md dark:bg-[#353B46] p-3",children:e.title})]},s))})]})]})}},77646:function(e,s,t){var a=t(52676),i=t(31022),r=t(14059),l=t(93734),n=t(7717),d=t(75271);s.Z=e=>{let{template:s}=e,t=(0,n.useTranslations)(),{agentModelList:c}=(0,i.Z)(),o=(0,d.useMemo)(()=>s.sub_topics[0],[s]);return(0,a.jsxs)("div",{className:"space-y-4 pb-2",children:[(0,a.jsxs)("div",{className:"flex flex-nowrap gap-8",children:[(0,a.jsxs)("div",{className:"min-w-[45%] space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-[#5F7698] dark:text-[#D0D4DC]",children:t("agent.model")}),(0,a.jsx)("div",{className:"rounded-md bg-[#F6F7F9] dark:bg-[#353B46] p-3",children:(0,r.y)(o.llm_model||"")||c[0].label})]}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-[#5F7698] dark:text-[#D0D4DC]",children:t("agent.sources")}),(0,a.jsx)("div",{className:"rounded-md bg-[#F6F7F9] dark:bg-[#353B46] p-3",children:t((0,l.Y)(o.source_type||""))})]})]}),s.introduction&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-[#5F7698] dark:text-[#D0D4DC]",children:t("agent.description")}),(0,a.jsx)("div",{className:"rounded-md bg-[#F6F7F9] dark:bg-[#353B46] p-3 truncate",children:s.introduction})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-[#5F7698] dark:text-[#D0D4DC]",children:t("agent.instructions")}),(0,a.jsx)("div",{className:"rounded-md bg-[#F6F7F9] dark:bg-[#353B46] p-3 truncate",children:s.hide_instructions?"*** ".concat(t("agent.unpublished")," ***"):o.instructions})]})]})}},2925:function(e,s,t){var a=t(52676),i=t(17112),r=t(26449),l=t(25010),n=t(5588),d=t(36551),c=t(25994),o=t(60161),m=t(81555),x=t(87106),u=t(31063),h=t(48117),p=t(25773),v=t(7717),g=t(75271),_=t(21133),f=t(15699),j=t(65819),b=t(53986),N=t(4814);s.Z=e=>{var s,t,F;let{type:w="create",onSubmit:k,onCancel:y,template:C}=e,E=(0,v.useTranslations)(),D=(0,v.useLocale)(),S=(0,j.gQ)(),A=(0,j.c0)(),Z=(0,j.ZP)(e=>e.userInfo),[T,B]=(0,g.useState)(!1),[I,z]=(0,g.useState)(""),[R,L]=(0,g.useState)({title:"",description:"",placeholder:"",steps:[{title:"",source_type:d.gl}],isSharedEnterprise:!1});(0,g.useEffect)(()=>{if(C){var e;L({title:C.title,description:C.introduction,placeholder:C.placeholder,steps:C.sub_topics,isSharedEnterprise:!!(null==C?void 0:null===(e=C.org_sharing)||void 0===e?void 0:e.org_id)})}},[C]);let P=(0,g.useMemo)(()=>{var e,s,t;return A&&(null==Z?void 0:null===(t=Z.user_org_member)||void 0===t?void 0:null===(s=t.org_settings)||void 0===s?void 0:null===(e=s.share_permission_config)||void 0===e?void 0:e.space_content_add_role.includes(A))},[A,null==Z?void 0:null===(F=Z.user_org_member)||void 0===F?void 0:null===(t=F.org_settings)||void 0===t?void 0:null===(s=t.share_permission_config)||void 0===s?void 0:s.space_content_add_role]),U=(e,s)=>{s.length>100||L(t=>({...t,steps:t.steps.map((t,a)=>a===e?{...t,title:s}:t)}))},O=(e,s)=>{L(t=>({...t,steps:t.steps.map((t,a)=>a===e?{...t,source_type:s.source_type,source_id:s.source_id,source_info:s.source_info,tools:s.tools}:t)}))},V=e=>{if(R.steps.length<=1){i.Z.warning(E("agent.min_one_step_required"));return}L(s=>({...s,steps:s.steps.filter((s,t)=>t!==e)}))},M=e=>{if(R.steps.length>=c.o2){i.Z.warning(E("agent.max_steps_reached",{count:c.o2}));return}L(s=>({...s,steps:[...s.steps.slice(0,e+1),{title:"",source_type:d.gl},...s.steps.slice(e+1)]}))},H=async()=>{B(!0);let e={introduction:R.description,title:R.title,placeholder:R.placeholder,sub_topics:R.steps,template_type:m.W.DEFAULT,params:null==C?void 0:C.params,lang:D},s=await (0,x.YX)(e);if(s.data){let e=s.data;if(null==R?void 0:R.isSharedEnterprise){var t;await (0,x.Ef)({topic_short_id:null===(t=s.data)||void 0===t?void 0:t.short_id}),e.org_sharing={org_id:"x"}}k(e)}B(!1),(0,u.fk)(o.U.SEARCH_AGENT_SIDEBAR_CREATE_SA,{value:1},!0)},W=async()=>{var e,s;B(!0);let t={short_id:(null==C?void 0:C.short_id)||"",introduction:R.description||"",title:R.title,placeholder:R.placeholder,sub_topics:R.steps,params:null==C?void 0:C.params,template_type:m.W.DEFAULT};(null==R?void 0:R.isSharedEnterprise)?(null==C?void 0:null===(e=C.org_sharing)||void 0===e?void 0:e.org_id)||await (0,x.Ef)({topic_short_id:null==t?void 0:t.short_id}):(null==C?void 0:null===(s=C.org_sharing)||void 0===s?void 0:s.org_id)&&await (0,x.ZR)({topic_short_id:null==t?void 0:t.short_id});let a=await (0,x._Z)(t);a.data&&k(a.data),B(!1)};return(0,a.jsxs)("div",{className:"flex flex-col h-full relative",children:[(0,a.jsxs)("div",{className:"flex gap-6 mb-4",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-0",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2",children:[E("agent.agent_name"),(0,a.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,a.jsxs)("div",{className:"text-xs text-[#7F94B1] dark:text-[#B9BFCA]",children:[R.title.length,"/70"]})]}),(0,a.jsx)(n.I,{value:R.title,className:"border-[#ACB9CD] focus-visible:ring-0 focus-visible:ring-offset-0 border dark:border-[#545D6F] dark:bg-[#202531]",onChange:e=>L(s=>({...s,title:e.target.value})),placeholder:E("agent.input_agent_name"),maxLength:70,autoFocus:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:E("agent.agent_description")}),(0,a.jsxs)("div",{className:"text-xs text-[#7F94B1] dark:text-[#B9BFCA]",children:[R.description.length,"/200"]})]}),(0,a.jsx)(h.g,{value:R.description,className:"custom-scrollbar border-[#ACB9CD] resize-none focus-visible:ring-0 focus-visible:ring-offset-0 border dark:border-[#545D6F] dark:bg-[#202531]",onChange:e=>L(s=>({...s,description:e.target.value})),placeholder:E("agent.input_agent_description"),maxLength:200})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:E("agent.template_placeholder")}),(0,a.jsxs)("div",{className:"text-xs text-[#7F94B1] dark:text-[#B9BFCA]",children:[R.placeholder.length,"/100"]})]}),(0,a.jsx)(h.g,{value:R.placeholder,onChange:e=>L(s=>({...s,placeholder:e.target.value})),className:"resize-none border-[#ACB9CD] focus-visible:ring-0 focus-visible:ring-offset-0 border dark:border-[#545D6F] dark:bg-[#202531]",placeholder:E("agent.input_template_placeholder"),maxLength:100})]})]}),I&&(0,a.jsx)("div",{className:"mt-4 text-sm text-red-500",children:I})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium",children:[E("agent.agent_steps"),(0,a.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,a.jsxs)(l.z,{size:"sm",variant:"ghost",onClick:()=>{if(R.steps.length>=c.o2){i.Z.warning(E("agent.max_steps_reached",{count:c.o2}));return}L(e=>({...e,steps:[...e.steps,{title:"",source_type:d.gl}]}))},children:["+ ",E("agent.add_step")]})]}),(0,a.jsx)("div",{className:"flex-1 space-y-2 rounded-lg p-4 min-h-0 bg-[#F6F7F9] dark:bg-[#353B46]",children:R.steps.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"flex-none flex items-center justify-center w-5 h-5  text-sm text-[#4B5F7E] rounded-2xl bg-[#EBEEF3] dark:bg-[#454E5D] dark:text-[#F3F5F7]",children:s+1}),(0,a.jsx)(n.I,{value:e.title,className:"h-8 border-[#ACB9CD] focus-visible:ring-0 focus-visible:ring-offset-0 border dark:border-[#545D6F] dark:bg-[#202531] rounded-md",onChange:e=>U(s,e.target.value),placeholder:E("agent.input_step_content"),maxLength:100}),(0,a.jsxs)("div",{className:"flex gap-1 items-center gap-2",children:[(0,a.jsx)(r.Z,{item:e,onChange:O,index:s}),(0,a.jsx)(_.N_,{onClick:()=>M(s),className:"cursor-pointer text-[#7F94B1]"}),(0,a.jsx)(_.Ur,{onClick:()=>V(s),className:"cursor-pointer text-[#7F94B1] dark:text-[#D0D4DC]"})]})]},s))})]})]}),(0,a.jsxs)("div",{className:"flex-none flex items-center justify-between gap-2 pt-4",children:[S?(0,a.jsx)(f.E,{value:(null==R?void 0:R.isSharedEnterprise)?"saveToEnterprise":"",className:(0,N.Z)("mb-2 md:mb-0 ",P?"":"pointer-events-none opacity-45"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-1 cursor-pointer",onClick:e=>{e.preventDefault(),e.stopPropagation(),L(e=>({...e,isSharedEnterprise:!(null==R?void 0:R.isSharedEnterprise)}))},children:[(0,a.jsx)(f.m,{value:"saveToEnterprise",id:"saveToEnterprise",className:"border-gray-300"}),(0,a.jsx)(b._,{htmlFor:"saveToEnterprise",className:"cursor-pointer font-normal",children:E("topic.save_to_enterprise_share")})]})}):null,(0,a.jsxs)("div",{className:"flex-1 flex justify-end space-x-2",children:[(0,a.jsx)(l.z,{variant:"outline",size:"sm",className:"border-[#0080FF] dark:border-[#0694FF] text-[#0080FF] dark:text-[#0694FF] hover:text-[#0080FF] bg-transparent hover:bg-transparent",onClick:y,children:E("cancel")}),(0,a.jsxs)(l.z,{size:"sm",onClick:"create"===w?H:W,disabled:T||!R.title,children:[E("confirm"),T&&(0,a.jsx)("div",{className:"flex justify-center items-center my-24",children:(0,a.jsx)(p.Z,{className:"w-4 h-4 animate-spin"})})]})]})]})]})}},79187:function(e,s,t){t.d(s,{Z:function(){return el}});var a=t(52676),i=t(25010),r=t(5588),l=t(36551),n=t(60161),d=t(81555),c=t(87106),o=t(31063),m=t(48117),x=t(25773),u=t(7717),h=t(75271),p=t(43378),v=t(67975),g=t(53986),_=t(15699),f=t(8096),j=t(32516),b=t(29764),N=t(34379),F=t(6428),w=t(80626),k=t(34073),y=t(69173),C=t(84375),E=t(92895),D=t(71686),S=t(35072),A=t(75307),Z=t(17436),T=t(67241),B=t(75963),I=t(42637),z=t(39071),R=t(59167),L=t(69047),P=t(57231),U=t(39109),O=t(37481),V=t(72070),M=t.n(V),H=t(91165),W=t(64171),q=t(40119),J=t(84593),$=t(1167),Y=t(15893),G=t(40203),K=t(62796),X=e=>{let{onSelectionChange:s,defaultSelectedServices:t}=e,r=(0,u.useTranslations)(),l=(0,U.Z)(),[n,d]=(0,h.useState)(t||[]),c=(0,Y.n)(r),[o,m]=(0,h.useState)(c),[v,f]=(0,h.useState)(null),[j,b]=(0,h.useState)(null),[N,F]=(0,h.useState)(!1),[w,k]=(0,h.useState)([]),[y,C]=(0,h.useState)(null),E=e=>{d(t=>{let a=o.find(s=>s.id===e);if(!a)return t;let i=t.some(s=>s.external_tool_id===e)?t.filter(s=>s.external_tool_id!==e):[...t,{external_tool_id:e,scope_auth:a.scope_auth,attribution:a.attribution,auth_status:a.auth_status,select_status:a.select_status}];return s&&s(i),i})},D=(e,s)=>{b({serviceId:e,scope_auth:s})},S=(e,s)=>{s.stopPropagation(),f(e);let t=n.find(s=>s.external_tool_id===e.id);b({serviceId:e.id,scope_auth:(null==t?void 0:t.scope_auth)||"personal"})},A=()=>{f(null),b(null)},Z=async()=>{if(v&&j){C(v.id);try{let{isAuthorized:e,data:t}=await (0,K.q)(v.id);e?(k(e=>[...e,v.id]),m(e=>e.map(e=>e.id===j.serviceId?{...e,scope_auth:j.scope_auth,auth_status:!0}:e)),d(e=>{let t=e.map(e=>e.external_tool_id===j.serviceId?{...e,scope_auth:j.scope_auth,auth_status:!0}:e);return s&&s(t),t}),l.success(r("agent.mcp_auth_success",{name:v.name}))):(T(),l.error(r("mcp.auth_failed")))}catch(e){T(),l.error(r("mcp.auth_failed"))}finally{C(null),F(!1),A()}}},T=()=>{v&&j&&(b({...j,scope_auth:"personal"}),F(!1))},B=async(e,t)=>{t.stopPropagation(),C(e);try{(await (0,K.c)(e)).success?(k(s=>s.filter(s=>s!==e)),m(s=>s.map(s=>s.id===e?{...s,scope_auth:"personal",auth_status:!1}:s)),d(t=>{let a=t.map(s=>s.external_tool_id===e?{...s,scope_auth:"personal",auth_status:!1}:s);return s&&s(a),a}),l.success(r("mcp.unlink_success"))):l.error(r("mcp.unlink_failed"))}catch(e){l.error(r("mcp.unlink_failed"))}finally{C(null)}},I=async()=>{if(j&&v){if("public"===j.scope_auth){C(v.id);try{let{isAuthorized:e,data:t}=await (0,K.q)(v.id);e?(k(e=>[...e,v.id]),m(e=>e.map(e=>e.id===j.serviceId?{...e,scope_auth:j.scope_auth,auth_status:!0}:e)),d(e=>{let t=e.map(e=>e.external_tool_id===j.serviceId?{...e,scope_auth:j.scope_auth,auth_status:!0}:e);return s&&s(t),t}),l.success(r("agent.mcp_auth_success",{name:v.name})),A()):t?(f({...v,redirect_uri:t.redirect_uri}),F(!0)):(l.error(r("mcp.auth_failed")),T())}catch(e){l.error(r("mcp.auth_failed")),T()}finally{C(null)}}else m(e=>e.map(e=>e.id===j.serviceId?{...e,scope_auth:j.scope_auth}:e)),d(e=>{let t=e.map(e=>e.external_tool_id===j.serviceId?{...e,scope_auth:j.scope_auth}:e);return s&&s(t),t}),A()}};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-2 gap-4 items-start",children:o.map(e=>{if(e.hidden)return null;let s=n.some(s=>s.external_tool_id===e.id),t=w.includes(e.id),l=y===e.id;return(0,a.jsx)(L.Zb,{className:(0,O.cn)("p-4",!e.disabled&&"cursor-pointer","hover:border-primary/50 hover:bg-primary/5 dark:hover:border-[#0694FF]","transition-all duration-300","space-y-4",s&&"border-primary bg-primary/5 dark:border-[#0694FF]",e.disabled&&"opacity-50 cursor-not-allowed hover:border-border hover:bg-transparent"),onClick:()=>!e.disabled&&E(e.id),children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"relative flex-none",children:[(0,a.jsx)(M(),{src:e.icon,alt:e.name,width:42,height:42,className:(0,O.cn)("Notion"===e.name&&"dark:invert")}),s&&(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 bg-primary text-white rounded-full p-1 flex items-center justify-center",style:{width:"20px",height:"20px"},children:(0,a.jsx)(H.Z,{size:12})})]}),(0,a.jsxs)("div",{className:"text-left flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between min-h-[32px]",children:[(0,a.jsx)("h3",{className:"font-medium text-sm",children:e.name}),(0,a.jsx)("div",{className:"w-8 h-8 flex items-center justify-center flex-shrink-0",children:s&&(t?(0,a.jsx)($.pn,{children:(0,a.jsxs)($.u,{children:[(0,a.jsx)($.aJ,{asChild:!0,children:(0,a.jsx)(i.z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:s=>B(e.id,s),disabled:l,children:l?(0,a.jsx)("div",{className:"animate-spin",children:(0,a.jsx)(x.Z,{className:"h-4 w-4"})}):(0,a.jsx)(W.Z,{className:"h-4 w-4"})})}),(0,a.jsx)($._v,{children:(0,a.jsx)("p",{children:r("mcp.remove_auth")})})]})}):(0,a.jsx)(i.z,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:s=>S(e,s),disabled:l,children:l?(0,a.jsx)("div",{className:"animate-spin",children:(0,a.jsx)(x.Z,{className:"h-4 w-4"})}):(0,a.jsx)(q.Z,{className:"h-4 w-4"})}))})]}),e.disabled?(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 line-clamp-1",children:r("coming_soon")}):(0,a.jsx)($.pn,{children:(0,a.jsxs)($.u,{children:[(0,a.jsx)($.aJ,{asChild:!0,children:(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 line-clamp-1",children:e.description})}),(0,a.jsx)($._v,{className:"max-w-[300px]",children:(0,a.jsx)("p",{children:e.description})})]})})]})]})},e.id)})}),(0,a.jsx)(p.Vq,{open:!!v,onOpenChange:A,children:(0,a.jsxs)(p.cZ,{className:"sm:max-w-[500px]",children:[(0,a.jsx)(p.fK,{children:(0,a.jsx)(p.$N,{className:"flex items-center space-x-2",children:v&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(M(),{src:v.icon,alt:v.name,width:24,height:24,className:(0,O.cn)("Notion"===v.name&&"dark:invert")}),(0,a.jsx)("span",{children:v.name})]})})}),(0,a.jsx)(p.a7,{className:"pt-0 mt-0",children:v&&(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h4",{className:"text-base mb-4 font-medium",children:r("mcp.auth_setting_title")}),(0,a.jsx)("p",{className:"text-sm",children:r("mcp.auth_setting_description")}),(0,a.jsx)("p",{className:"text-sm",children:r("mcp.auth_setting_prompt")}),(0,a.jsxs)(_.E,{value:(null==j?void 0:j.scope_auth)||"personal",onValueChange:e=>D(v.id,e),className:"gap-3 pt-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(_.m,{value:"personal",id:"r1-".concat(v.id)}),(0,a.jsxs)(g._,{className:"cursor-pointer",htmlFor:"r1-".concat(v.id),children:[r("mcp.individual_auth_option"),(0,a.jsx)($.pn,{delayDuration:0,children:(0,a.jsxs)($.u,{children:[(0,a.jsx)($.aJ,{asChild:!0,children:(0,a.jsx)(J.Z,{size:14,className:"ml-1 inline-flex cursor-pointer text-[#ACB9CD] dark:text-[#737F96]"})}),(0,a.jsx)($._v,{side:"top",align:"end",sideOffset:8,className:"bg-[#353B46] text-white dark:bg-[#353B46] dark:text-white max-w-[260px] whitespace-normal break-words",children:r("mcp.individual_auth_description",{name:v.name})})]})})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(_.m,{value:"public",id:"r2-".concat(v.id)}),(0,a.jsxs)(g._,{className:"cursor-pointer flex items-center",htmlFor:"r2-".concat(v.id),children:[r("mcp.shared_auth_option"),(0,a.jsx)($.pn,{delayDuration:0,children:(0,a.jsxs)($.u,{children:[(0,a.jsx)($.aJ,{asChild:!0,children:(0,a.jsx)(J.Z,{size:14,className:"ml-1 inline-flex cursor-pointer text-[#ACB9CD] dark:text-[#737F96]"})}),(0,a.jsx)($._v,{side:"top",align:"end",sideOffset:8,className:"bg-[#353B46] text-white dark:bg-[#353B46] dark:text-white max-w-[260px] whitespace-normal break-words",children:r("mcp.shared_auth_description",{name:v.name})})]})})]})]})]})]})})}),(0,a.jsxs)(p.cN,{children:[(0,a.jsx)(i.z,{variant:"outline",onClick:A,children:r("cancel")}),(0,a.jsx)(i.z,{onClick:I,disabled:y===(null==v?void 0:v.id),children:y===(null==v?void 0:v.id)?(0,a.jsx)("div",{className:"animate-spin",children:(0,a.jsx)(x.Z,{className:"h-4 w-4"})}):(null==j?void 0:j.scope_auth)==="public"?r("agent.mcp_authorize"):r("save")})]})]})}),v&&(0,a.jsx)(G.Z,{serviceName:v.name,serviceId:v.id,serviceUrl:v.redirect_uri||"",isOpen:N,onClose:()=>{F(!1),T()},onSuccess:Z})]})},Q=t(28818),ee=e=>{let{servers:s=[],onSubmit:t,selectedServices:r,onSelectedServicesChange:l}=e,n=(0,u.useTranslations)(),d=(0,U.Z)(),[c,o]=(0,h.useState)(null),[m,x]=(0,h.useState)(""),[p,v]=(0,h.useState)(""),[g,_]=(0,h.useState)(""),[f,j]=(0,h.useState)(!1),[b,N]=(0,h.useState)(null),[F,w]=(0,h.useState)(!1),k=()=>{x(""),v(""),_(""),N(null),j(!1),w(!1),o(null)},y=()=>{let e={};try{return g&&""!==g.trim()&&(e=JSON.parse(g)),{header:e,isValid:!0}}catch(e){return d.error(n("agent.mcp_servers_header_error")),{header:{},isValid:!1}}},C=async()=>{if(N(null),w(!0),!p){d.error(n("agent.mcp_servers_url_error"));return}let{header:e,isValid:s}=y();if(!s){w(!1);return}let t=await (0,P.TN)({url:p,header:e});if("ok"!==t.status){N(!1),w(!1);return}N(t),w(!1)},E=(e,s)=>{o(s),x(e.title),v(e.url),_(0===Object.keys((null==e?void 0:e.header)||{}).length?"":JSON.stringify(e.header)),j(!0)},D=e=>{t(s.filter((s,t)=>t!==e))};return(0,a.jsxs)("div",{className:"flex flex-col gap-4 w-full",children:[(0,a.jsx)(X,{defaultSelectedServices:r,onSelectionChange:e=>{l(e)}}),s.map((e,s)=>(0,a.jsx)(L.Zb,{className:"p-3",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex flex-col flex-1 min-w-0",children:[(0,a.jsx)("span",{className:"font-medium truncate max-w-full",children:e.title}),(0,a.jsx)("span",{className:"text-sm text-gray-500 truncate max-w-full",children:e.url})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.z,{variant:"ghost",size:"icon",onClick:()=>E(e,s),className:"h-8 w-8",children:(0,a.jsx)(I.Z,{className:"h-4 w-4"})}),(0,a.jsx)(i.z,{variant:"ghost",size:"icon",onClick:()=>D(s),className:"h-8 w-8 text-destructive",children:(0,a.jsx)(z.Z,{className:"h-4 w-4"})})]})]})},e.title)),(0,a.jsx)(Q.Z,{isOpen:f,onOpenChange:e=>{j(e),e||k()},serverTitle:m,onServerTitleChange:x,serverUrl:p,onServerUrlChange:v,serverHeader:g,onServerHeaderChange:_,testStatus:b,testLoading:F,onTest:C,onSubmit:()=>{let{header:e,isValid:a}=y();if(!a)return;let i=m.trim(),r=p.trim();if(null!==c){let a=[...s];a[c]={title:i,url:r,header:e,select_status:!0,attribution:"isa",scope_auth:"public"},t(a)}else t([...s,{title:i,url:r,header:e,select_status:!0,attribution:"isa",scope_auth:"public"}]);k()}}),(0,a.jsxs)(i.z,{onClick:()=>j(!0),className:"w-full dark:bg-[#09090b]",variant:"secondary",children:[(0,a.jsx)(R.Z,{className:"mr-2 h-4 w-4"}),n("agent.mcp_servers_add")]})]})},es=t(27976),et=e=>{let{open:s,onOpenChange:t,defaultData:l,onChange:n}=e,d=(0,u.useTranslations)(),c=(0,B.useRouter)(),{inited:o,list:m,getList:x}=(0,Z.Z)(),[I,z]=(0,h.useState)(!1),[R,L]=(0,h.useState)(!1),[P,U]=(0,h.useState)(!1),[O,V]=(0,h.useState)(!1),[M,H]=(0,h.useState)(!1),[W,q]=(0,h.useState)(!1),[J,$]=(0,h.useState)(!1),[Y,G]=(0,h.useState)(!1),[K,X]=(0,h.useState)(!1),[Q,et]=(0,h.useState)(!1),[ea,ei]=(0,h.useState)(""),[er,el]=(0,h.useState)(""),[en,ed]=(0,h.useState)([]),[ec,eo]=(0,h.useState)([]),[em,ex]=(0,h.useState)(!1),eu=m.filter(e=>e.name.toLowerCase().includes(er.toLowerCase()));(0,h.useEffect)(()=>{s&&eh()},[s]),(0,h.useEffect)(()=>{s&&n(ep())},[I,R,ea,P,O,M,W,J,en,Y,K,Q,ec]),(0,h.useEffect)(()=>{o||m.length||x()},[]);let eh=()=>{if(!l)return;let{tools:e,source_id:s}=l;if(e){z(!!e.find(e=>"web_search"===e.name)),U(!!e.find(e=>"ppt_render"===e.name)),V(!!e.find(e=>"ppt_render_v2"===e.name)),H(!!e.find(e=>"sandbox"===e.name)),q(!!e.find(e=>"web_scraper"===e.name)),G(!!e.find(e=>"think"===e.name)),X(!!e.find(e=>"image_search"===e.name)),et(!!e.find(e=>"image_generation"===e.name));let s=e.find(e=>"mcp_services"===e.name);s&&($(!!s),ed(s.config.list||[]));let t=e.find(e=>"external_tool_services"===e.name);t&&eo(t.config.list.map(e=>({external_tool_id:e.external_tool_id,scope_auth:e.scope_auth||"",auth_status:e.auth_status||!1}))||[])}s&&(L(!0),ei(s),ex(!m.find(e=>e.short_id===s)))},ep=()=>{let e=[];return I&&e.push({name:"web_search"}),P&&e.push({name:"ppt_render"}),O&&e.push({name:"ppt_render_v2"}),M&&e.push({name:"sandbox"}),W&&e.push({name:"web_scraper"}),Y&&e.push({name:"think"}),K&&e.push({name:"image_search"}),Q&&e.push({name:"image_generation"}),J&&e.push({name:"mcp_services",config:{list:en,status:!!en.length}}),ec.length&&e.push({name:"external_tool_services",config:{list:ec.map(e=>({external_tool_id:e.external_tool_id,scope_auth:e.scope_auth,attribution:"isa",select_status:!0,auth_status:e.auth_status||!1}))}}),{...l||{},title:(null==l?void 0:l.title)||"",tools:e,source_id:R?ea:""}};return(0,a.jsx)(p.Vq,{open:s,onOpenChange:t,children:(0,a.jsxs)(p.cZ,{className:"max-w-md sm:max-w-lg md:max-w-xl dark:bg-[#454E5D]","aria-describedby":void 0,children:[(0,a.jsxs)(p.fK,{className:"border-b pb-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(p.$N,{className:"text-xl font-medium",children:d("agent.manage_sources")}),(0,a.jsx)(p.GG,{className:"h-6 w-6 rounded-sm opacity-70 hover:opacity-100 transition-opacity",tabIndex:-1})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:d("agent.sources_config_desc")})]}),(0,a.jsxs)("div",{className:"space-y-5 py-8 px-5 max-h-[calc(100vh-200px)] overflow-y-auto",children:[(0,a.jsx)("div",{className:"rounded-lg border bg-card p-4 shadow-sm transition-all hover:shadow-md dark:border-[#545D6F] dark:bg-[#202531]",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(f.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g._,{htmlFor:"internet-search",className:"text-sm font-medium",children:d("agent.search_internet")}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:d("agent.search_internet_desc")})]})]}),(0,a.jsx)(v.r,{id:"internet-search",checked:I,onCheckedChange:z,className:"data-[state=checked]:bg-primary"})]})}),(0,a.jsxs)("div",{className:"rounded-lg border bg-card p-4 shadow-sm transition-all hover:shadow-md dark:border-[#545D6F] dark:bg-[#202531]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(T.tJ,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g._,{htmlFor:"knowledge-search",className:"text-sm font-medium",children:d("agent.search_knowledge")}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:d("agent.search_knowledge_desc")})]})]}),(0,a.jsx)(v.r,{id:"knowledge-search",checked:R,onCheckedChange:e=>{L(e),ei(e&&m.length?eu[0].short_id:"")},className:"data-[state=checked]:bg-primary"})]}),em?(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4 mt-5 p-4 rounded-lg bg-muted/40 border border-border/40 dark:border-[#545D6F]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-1.5 rounded-full",children:(0,a.jsx)(j.Z,{className:"h-4 w-4 text-primary"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-foreground/90",children:null==l?void 0:l.title}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:d("agent.reset_tip")})]})]}),(0,a.jsx)(i.z,{variant:"outline",size:"sm",className:"gap-1",onClick:()=>{ex(!1),R||(L(!0),ei(m[0].short_id))},children:d("agent.reset")})]}):R&&(0,a.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(b.Z,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(r.I,{type:"text",placeholder:d("agent.search_knowledge_placeholder"),className:"pl-9",value:er,onChange:e=>el(e.target.value)})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)(i.z,{size:"sm",variant:"outline",className:"gap-1",onClick:()=>{c.push("/topic")},children:[(0,a.jsx)(N.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:d("agent.create_knowledge")})]})})]}),eu.length>0?(0,a.jsx)("div",{className:"h-[220px] rounded-md border overflow-y-auto dark:border-[#333741] dark:bg-[#09090B]",children:(0,a.jsx)(_.E,{value:ea,onValueChange:ei,className:"space-y-1 p-1",children:eu.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-3 rounded-md px-3 py-2.5 transition-colors ".concat(ea===e.short_id?"bg-primary/10":"hover:bg-accent"),children:[(0,a.jsx)(_.m,{value:e.short_id,id:e.short_id,className:"border-primary"}),(0,a.jsx)(g._,{htmlFor:e.short_id,className:"flex-1 cursor-pointer",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsxs)("div",{className:"flex-none flex items-center gap-2 mt-1",children:[e.resource_group.file&&(0,a.jsxs)(A.C,{variant:"outline",className:"text-xs font-normal space-x-1",children:[(0,a.jsx)(F.Z,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:d("agent.document")}),(0,a.jsx)("span",{children:e.resource_group.file})]}),e.resource_group.website&&(0,a.jsxs)(A.C,{variant:"outline",className:"text-xs font-normal space-x-1",children:[(0,a.jsx)(w.Z,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:d("agent.link")}),(0,a.jsx)("span",{children:e.resource_group.website})]})]})]})})]},e.short_id))})}):(0,a.jsx)("div",{className:"h-[220px] flex items-center justify-center border rounded-md",children:(0,a.jsx)("div",{className:"text-center p-4",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:d("agent.no_matching_knowledge")})})})]})]}),(0,a.jsx)("div",{className:"rounded-lg border bg-card p-4 shadow-sm transition-all hover:shadow-md dark:border-[#545D6F] dark:bg-[#202531]",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(F.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g._,{htmlFor:"ppt-render",className:"text-sm font-medium",children:d("agent.ppt_render")}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:d("agent.ppt_render_desc")})]})]}),(0,a.jsx)(v.r,{id:"ppt-render",checked:P,onCheckedChange:U,className:"data-[state=checked]:bg-primary"})]})}),(0,a.jsx)("div",{className:"rounded-lg border bg-card p-4 shadow-sm transition-all hover:shadow-md dark:border-[#545D6F] dark:bg-[#202531]",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(F.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g._,{htmlFor:"ppt-render-v2",className:"text-sm font-medium",children:d("agent.ppt_render_v2")}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:d("agent.ppt_render_v2_desc")})]})]}),(0,a.jsx)(v.r,{id:"ppt-render-v2",checked:O,onCheckedChange:V,className:"data-[state=checked]:bg-primary"})]})}),(0,a.jsx)("div",{className:"rounded-lg border bg-card p-4 shadow-sm transition-all hover:shadow-md dark:border-[#545D6F] dark:bg-[#202531]",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(k.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g._,{htmlFor:"code-sandbox",className:"text-sm font-medium",children:d("agent.code_sandbox")}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:d("agent.code_sandbox_desc")})]})]}),(0,a.jsx)(v.r,{id:"code-sandbox",checked:M,onCheckedChange:H,className:"data-[state=checked]:bg-primary"})]})}),(0,a.jsxs)("div",{className:"rounded-lg border bg-card p-4 shadow-sm transition-all hover:shadow-md dark:border-[#545D6F] dark:bg-[#202531]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(y.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g._,{htmlFor:"mcp-services",className:"text-sm font-medium",children:d("agent.mcp_servers")}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:d("agent.mcp_servers_desc")})]})]}),(0,a.jsx)(v.r,{id:"mcp-services",checked:J,onCheckedChange:$,className:"data-[state=checked]:bg-primary"})]}),J&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(ee,{servers:en,onSubmit:e=>{ed(e)},selectedServices:ec,onSelectedServicesChange:e=>{eo(e)}})})]}),(0,a.jsx)("div",{className:"rounded-lg border bg-card p-4 shadow-sm transition-all hover:shadow-md dark:border-[#545D6F] dark:bg-[#202531]",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(C.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g._,{htmlFor:"web-reader",className:"text-sm font-medium",children:d("agent.web_reader")}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:d("agent.web_reader_desc")})]})]}),(0,a.jsx)(v.r,{id:"web-reader",checked:W,onCheckedChange:q,className:"data-[state=checked]:bg-primary"})]})}),es.r8&&(0,a.jsx)("div",{className:"rounded-lg border bg-card p-4 shadow-sm transition-all hover:shadow-md dark:border-[#545D6F] dark:bg-[#202531]",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(E.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g._,{htmlFor:"think-tool",className:"text-sm font-medium",children:d("agent.think_tool")}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:d("agent.think_tool_desc")})]})]}),(0,a.jsx)(v.r,{id:"think-tool",checked:Y,onCheckedChange:G,className:"data-[state=checked]:bg-primary"})]})}),(0,a.jsx)("div",{className:"rounded-lg border bg-card p-4 shadow-sm transition-all hover:shadow-md dark:border-[#545D6F] dark:bg-[#202531]",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(D.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g._,{htmlFor:"image-search",className:"text-sm font-medium",children:d("agent.image_search")}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:d("agent.image_search_desc")})]})]}),(0,a.jsx)(v.r,{id:"image-search",checked:K,onCheckedChange:X,className:"data-[state=checked]:bg-primary"})]})}),(0,a.jsx)("div",{className:"rounded-lg border bg-card p-4 shadow-sm transition-all hover:shadow-md dark:border-[#545D6F] dark:bg-[#202531]",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)(S.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g._,{htmlFor:"image-generation",className:"text-sm font-medium",children:d("agent.image_generation")}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:d("agent.image_generation_desc")})]})]}),(0,a.jsx)(v.r,{id:"image-generation",checked:Q,onCheckedChange:et,className:"data-[state=checked]:bg-primary"})]})})]})]})})},ea=t(65819),ei=t(4814),er=t(31022),el=e=>{var s,t,p,f,j,b,N,F;let{type:w="create",onSubmit:k,onCancel:y,template:C}=e,E=(0,u.useTranslations)(),D=(0,u.useLocale)(),S=(0,ea.gQ)(),A=(0,ea.c0)(),Z=(0,ea.ZP)(e=>e.userInfo),{agentModelList:T}=(0,er.Z)(),[B,I]=(0,h.useState)(!1),[z,R]=(0,h.useState)(""),[L,P]=(0,h.useState)({title:(null==C?void 0:C.title)||"",description:(null==C?void 0:C.introduction)||"",placeholder:(null==C?void 0:C.placeholder)||"",instructions:(null==C?void 0:null===(s=C.sub_topics[0])||void 0===s?void 0:s.instructions)||"",model:(null==C?void 0:null===(t=C.sub_topics[0])||void 0===t?void 0:t.llm_model)||"",sourceType:(null==C?void 0:null===(p=C.sub_topics[0])||void 0===p?void 0:p.source_type)||l.gl,topicInfo:{title:(null==C?void 0:null===(f=C.sub_topics[0])||void 0===f?void 0:f.title)||"",source_id:(null==C?void 0:null===(j=C.sub_topics[0])||void 0===j?void 0:j.source_id)||""},tools:[],isSharedEnterprise:!1}),[U,O]=(0,h.useState)(!1),V=(0,h.useMemo)(()=>({title:L.title,source_type:L.sourceType,source_id:L.topicInfo.source_id,llm_model:L.model,instructions:L.instructions,tools:L.tools}),[L]);(0,h.useEffect)(()=>{if(C){var e;P({title:C.title,description:C.introduction,placeholder:C.placeholder||"",instructions:C.sub_topics[0].instructions||"",model:C.sub_topics[0].llm_model||"",sourceType:C.sub_topics[0].source_type||l.gl,topicInfo:{title:C.sub_topics[0].title,source_id:C.sub_topics[0].source_id||""},tools:C.sub_topics[0].tools||[],isSharedEnterprise:!!(null==C?void 0:null===(e=C.org_sharing)||void 0===e?void 0:e.org_id)})}},[C]);let M=(0,h.useMemo)(()=>{var e,s,t;return A&&(null==Z?void 0:null===(t=Z.user_org_member)||void 0===t?void 0:null===(s=t.org_settings)||void 0===s?void 0:null===(e=s.share_permission_config)||void 0===e?void 0:e.space_content_add_role.includes(A))},[A,null==Z?void 0:null===(F=Z.user_org_member)||void 0===F?void 0:null===(N=F.org_settings)||void 0===N?void 0:null===(b=N.share_permission_config)||void 0===b?void 0:b.space_content_add_role]),H=()=>({introduction:L.description,title:L.title,placeholder:L.placeholder,sub_topics:[{title:L.title,source_type:L.sourceType,source_id:L.topicInfo.source_id,llm_model:L.model,instructions:L.instructions,tools:L.tools}],template_type:d.W.CUSTOM,isSharedEnterprise:null==L?void 0:L.isSharedEnterprise,lang:D}),W=async()=>{I(!0);let e=H(),s=await (0,c.YX)(e);if(s.data){let a=s.data;if(null==e?void 0:e.isSharedEnterprise){var t;await (0,c.Ef)({topic_short_id:null===(t=s.data)||void 0===t?void 0:t.short_id}),a.org_sharing={org_id:"x"}}k(a)}I(!1),(0,o.fk)(n.U.SEARCH_AGENT_SIDEBAR_CREATE_ISA,{value:1},!0)},q=async()=>{var e,s,t;I(!0);let a={...H(),short_id:(null==C?void 0:C.short_id)||""};(null==a?void 0:a.isSharedEnterprise)?(null==C?void 0:null===(e=C.org_sharing)||void 0===e?void 0:e.org_id)||await (0,c.Ef)({topic_short_id:null==a?void 0:a.short_id}):(null==C?void 0:null===(s=C.org_sharing)||void 0===s?void 0:s.org_id)&&await (0,c.ZR)({topic_short_id:null==a?void 0:a.short_id});let i=await (0,c._Z)(a);if(i.data){let e=i.data;(null==a?void 0:a.isSharedEnterprise)?(null==e?void 0:null===(t=e.org_sharing)||void 0===t?void 0:t.org_id)||(e.org_sharing={org_id:"x"}):(null==e?void 0:e.org_sharing)&&(null==e||delete e.org_sharing),k(e)}I(!1)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex gap-6 mb-4",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col p-1",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium mb-2",children:[E("agent.agent_name"),(0,a.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,a.jsxs)("div",{className:"text-xs text-[#7F94B1] dark:text-[#B9BFCA]",children:[L.title.length,"/",70]})]}),(0,a.jsx)(r.I,{value:L.title,onChange:e=>P(s=>({...s,title:e.target.value})),className:"border-[#ACB9CD] focus-visible:ring-0 focus-visible:ring-offset-0 border dark:border-[#545D6F] dark:bg-[#202531]",placeholder:E("agent.input_agent_name"),maxLength:70,autoFocus:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:E("agent.agent_description")}),(0,a.jsxs)("div",{className:"text-xs text-[#7F94B1] dark:text-[#B9BFCA]",children:[L.description.length,"/",500]})]}),(0,a.jsx)(m.g,{value:L.description,className:"border-[#ACB9CD] custom-scrollbar resize-none focus-visible:ring-0 focus-visible:ring-offset-0 border dark:border-[#545D6F] dark:bg-[#202531]",onChange:e=>P(s=>({...s,description:e.target.value})),placeholder:E("agent.input_agent_description"),maxLength:500})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:E("agent.template_placeholder")}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[L.placeholder.length,"/",500]})]}),(0,a.jsx)(m.g,{className:"border-[#ACB9CD] custom-scrollbar resize-none focus-visible:ring-0 focus-visible:ring-offset-0 border dark:border-[#545D6F] dark:bg-[#202531]",value:L.placeholder,onChange:e=>P(s=>({...s,placeholder:e.target.value})),placeholder:E("agent.input_template_placeholder"),maxLength:500})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-2 flex items-center justify-between",children:(0,a.jsx)("label",{className:"block text-sm font-medium",children:E("agent.model")})}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 border rounded-md px-3 py-2 dark:border-[#545D6F] dark:bg-[#202531]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm",children:E("agent.reasoning_model")}),(0,a.jsx)("span",{className:"rounded-xl text-[#0080FF] bg-[#D6F3FF] dark:bg-[#889cbc] dark:text-[#EDF3FC] px-2 py-0.5 text-xs",children:"Pro"})]}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)($.pn,{children:(0,a.jsxs)($.u,{delayDuration:200,children:[(0,a.jsx)($.aJ,{asChild:!0,children:(0,a.jsx)(v.r,{id:"agent-model",className:"bg-[#0080FF] dark:bg-[#0694FF]",defaultChecked:!0,disabled:!0})}),(0,a.jsx)($._v,{children:(0,a.jsx)("p",{children:E("agent.reasoning_model_tooltip")})})]})})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,a.jsx)("label",{className:"block text-sm font-medium",children:E("agent.sources")})}),(0,a.jsx)(i.z,{variant:"outline",className:"w-full mt-2 border-[#EBEEF3] dark:border-[#545D6F] dark:bg-[#202531] hover:bg-gray-50 text-left justify-start font-normal",onClick:()=>{O(!0)},children:E("agent.manage_sources")}),(0,a.jsx)("div",{})]})]}),z&&(0,a.jsx)("div",{className:"mt-4 text-sm text-red-500",children:z})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium",children:[E("agent.instructions"),(0,a.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,a.jsxs)("div",{className:"text-xs text-[#7F94B1] dark:text-[#B9BFCA]",children:[L.instructions.length,"/",1e4]})]}),(0,a.jsx)(m.g,{value:L.instructions,onChange:e=>P(s=>({...s,instructions:e.target.value})),className:"border-[#ACB9CD] custom-scrollbar resize-none flex-1 focus-visible:ring-0 focus-visible:ring-offset-0 border dark:border-[#545D6F] dark:bg-[#202531]",placeholder:E("agent.input_agent_prompt"),maxLength:1e4})]})]}),(0,a.jsxs)("div",{className:"flex-none flex items-center justify-between gap-2 px-0 py-4",children:[S?(0,a.jsx)(_.E,{value:(null==L?void 0:L.isSharedEnterprise)?"saveToEnterprise":"",className:(0,ei.Z)("mb-2 md:mb-0 ",M?"":"pointer-events-none opacity-45"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-1 cursor-pointer",onClick:e=>{e.preventDefault(),e.stopPropagation(),P(e=>({...e,isSharedEnterprise:!(null==L?void 0:L.isSharedEnterprise)}))},children:[(0,a.jsx)(_.m,{value:"saveToEnterprise",id:"saveToEnterprise",className:"border-gray-300"}),(0,a.jsx)(g._,{htmlFor:"saveToEnterprise",className:"cursor-pointer font-normal",children:E("topic.save_to_enterprise_share")})]})}):null,(0,a.jsxs)("div",{className:"flex-1 flex justify-end space-x-2",children:[(0,a.jsx)(i.z,{variant:"outline",size:"sm",className:"border-[#0080FF] dark:border-[#0694FF] text-[#0080FF] dark:text-[#0694FF] hover:text-[#0080FF] bg-transparent hover:bg-transparent",onClick:y,children:E("cancel")}),(0,a.jsxs)(i.z,{size:"sm",onClick:"create"===w?W:q,disabled:B||!L.title||!L.instructions,children:[E("confirm"),B&&(0,a.jsx)("div",{className:"flex justify-center items-center my-24",children:(0,a.jsx)(x.Z,{className:"w-4 h-4 animate-spin"})})]})]})]})]}),(0,a.jsx)(et,{open:U,onOpenChange:O,defaultData:V,onChange:e=>{P(s=>({...s,topicInfo:{title:e.title,source_id:e.source_id||""},tools:e.tools||[]}))}})]})}},69047:function(e,s,t){t.d(s,{Ol:function(){return n},Zb:function(){return l},aY:function(){return c},ll:function(){return d}});var a=t(52676),i=t(75271),r=t(37481);let l=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...i})});l.displayName="Card";let n=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",t),...i})});n.displayName="CardHeader";let d=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",t),...i})});d.displayName="CardTitle",i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("text-sm text-muted-foreground",t),...i})}).displayName="CardDescription";let c=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("p-6 pt-0",t),...i})});c.displayName="CardContent",i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)("div",{ref:s,className:(0,r.cn)("flex items-center p-6 pt-0",t),...i})}).displayName="CardFooter"},15699:function(e,s,t){t.d(s,{E:function(){return d},m:function(){return c}});var a=t(52676),i=t(75271),r=t(82788),l=t(68752),n=t(37481);let d=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(r.fC,{className:(0,n.cn)("grid gap-2",t),...i,ref:s})});d.displayName=r.fC.displayName;let c=i.forwardRef((e,s)=>{let{className:t,...i}=e;return(0,a.jsx)(r.ck,{ref:s,className:(0,n.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...i,children:(0,a.jsx)(r.z$,{className:"flex items-center justify-center",children:(0,a.jsx)(l.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});c.displayName=r.ck.displayName},14059:function(e,s,t){t.d(s,{y:function(){return i}});var a=t(31022);let i=e=>{var s;return"gpt-4o-mini"===e?"Felo Basic":(null===(s=a.Z.getState().allModelList.find(s=>s.value===e))||void 0===s?void 0:s.label)||e}},3574:function(e,s,t){t.d(s,{O:function(){return r},v:function(){return i}});let a=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,i=e=>!!e&&a.test(e.trim()),r=e=>e.match(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g)}}]);