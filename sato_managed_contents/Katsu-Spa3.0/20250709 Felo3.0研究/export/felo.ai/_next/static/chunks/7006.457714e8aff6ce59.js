"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7006],{87006:function(e,t,r){r.r(t),r.d(t,{default:function(){return y}});var a=r(52676),i=r(75271),s=r(26595),l=r(7717),o=r(57546),n=r(48958),d=r(81492),c=r(65819),u=r(25794),m=r(78423),g=r(71299),_=r(41847),v=r(31063),p=r(60161),x=r(77844),f=function(e){let{email:t,onSucceed:r}=e,[a,s]=(0,i.useState)(""),[o,n]=(0,i.useState)(""),[f,b]=(0,i.useState)(!1),[h,w]=(0,i.useState)(!1),[y,N]=(0,i.useState)("email"),[k,j]=(0,i.useState)(!1),C=(0,l.useTranslations)(),[E,S]=(0,i.useState)(!1),[F,A]=(0,i.useState)(""),[B,D]=(0,i.useState)(0),[R,Z]=(0,i.useState)(!1),[L,I]=(0,i.useState)("");(0,i.useEffect)(()=>{let e;return B>0?e=setTimeout(()=>{D(B-1)},1e3):0===B&&E&&Z(!0),()=>clearTimeout(e)},[B,E]);let O=async e=>{let t=x.Z.getState().firstFrom,{anonymousToken:a}=c.ZP.getState(),i=null==e?void 0:e.callbackUri;return s("email"),(0,d.xJ)({...e,password:await (0,g.k)(e.password),app_id:"glaritySearch",client_type:"WEB",device_id:a,invitation_code:t}).then(e=>{var a,s;if(200!==e.status){n("server.".concat(e.code));return}r(),(0,u.F_)(e.data.token.token_value),(0,m.bf)(),(0,v.fk)(p.U.LOGIN,{uid:(null==e?void 0:null===(s=e.data)||void 0===s?void 0:null===(a=s.user)||void 0===a?void 0:a.uid)||"",inviteCode:t}),i&&(window.location.href=i)}).finally(()=>{s("")})},U=async()=>{if(t){s("sendCode"),n("");try{let e=await (0,d.O8)(t);200===e.status?(S(!0),w(!1),D(60),Z(!1)):n("server.".concat(e.code))}catch(e){n(e.message)}finally{s("")}}},z=async()=>{if(!F){n(C("login.please_enter_verify_code"));return}if(6!==F.length||!/^\d{6}$/.test(F)){n(C("login.please_enter_6_digit_verify_code"));return}n(""),s("verifyCode");let e=x.Z.getState().firstFrom,{anonymousToken:r}=c.ZP.getState();try{var a,i,l,o;let s=await (0,d.IU)({email:t,password:await (0,g.k)(L),app_id:"glaritySearch",device_id:r,client_type:"WEB",invitation_code:e,verify_code:F});200===s.status&&(null==s?void 0:null===(a=s.data)||void 0===a?void 0:a.uid)?await O({email:t,password:L,callbackUri:void 0}):"EMAIL_VERIFY_CODE_ERROR"===s.code||"VERIFY_CODE_ERROR"===s.code?n(C("login.email_verify_code_error")):n("server.".concat(s.code)),(0,v.fk)(p.U.REGISTER,{uid:(null==s?void 0:null===(i=s.data)||void 0===i?void 0:i.uid)||"",inviteCode:e}),(0,_.I)({eventName:"user_register_success",eventParams:{event_category:"customEvent",event_label:"user_register_success",value:1}}),null===(l=(o=window).clarity)||void 0===l||l.call(o,"event","felo_search_register")}catch(e){n(e.message)}finally{s("")}};return{loading:a,register:async e=>{let{email:t,password:r,verifyCode:a}=e;if(!a){I(r),await U();return}s("email");let i=x.Z.getState().firstFrom,{anonymousToken:l}=c.ZP.getState();return(0,d.IU)({email:t,password:await (0,g.k)(r),app_id:"glaritySearch",device_id:l,client_type:"WEB",invitation_code:i,verify_code:a}).then(e=>{var a,s,l,o;200===e.status&&(null==e?void 0:null===(a=e.data)||void 0===a?void 0:a.uid)?O({email:t,password:r,callbackUri:void 0}):"EMAIL_VERIFY_CODE_ERROR"===e.code||"VERIFY_CODE_ERROR"===e.code?n(C("login.email_verify_code_error")):n("server.".concat(e.code)),(0,v.fk)(p.U.REGISTER,{uid:(null==e?void 0:null===(s=e.data)||void 0===s?void 0:s.uid)||"",inviteCode:i}),(0,_.I)({eventName:"user_register_success",eventParams:{event_category:"customEvent",event_label:"user_register_success",value:1}}),null===(l=(o=window).clarity)||void 0===l||l.call(o,"event","felo_search_register")}).catch(e=>{n(e.message)}).finally(()=>{s("")})},login:O,loginByApple:e=>{s("apple"),(0,d.Zf)({clientType:"WEB",appId:"glaritySearch",redirectUri:"".concat(window.location.origin,"/callback"),state:e?"redirect=".concat(e):void 0}).then(e=>{let{location:t}=e.data;t&&(window.location.href=t)}).finally(()=>{s("")})},loginByGoogle:e=>{s("google"),(0,d.u9)({clientType:"WEB",appId:"glaritySearch",redirectUri:"".concat(window.location.origin,"/callback"),state:e?"redirect=".concat(e):void 0}).then(e=>{let{location:t}=e.data;t&&(window.location.href=t)}).finally(()=>{s("")})},validateEmail:()=>{t&&(n(""),s("validate"),(0,d.ri)(t).then(e=>{if("USER_NOT_FOUND"===e.code){b(!0),w(!0);return}if(e.data.is_sso){j(!0);return}b(!1),w(!0)}).catch(e=>{n(e.message)}).finally(()=>{s("")}))},isSSOLoginError:k,setIsSSOLoginError:j,reset:()=>{n(""),b(!1),w(!1),S(!1),A(""),D(0),Z(!1),I("")},error:o,setError:n,isRegisterMode:f,showPasswordInput:h,loginType:y,setLoginType:N,showVerificationCode:E,verificationCode:F,setVerificationCode:A,countdown:B,canResend:R,sendVerificationCode:U,resendVerificationCode:()=>{R&&U()},verifyCode:z}},b=r(5311),h=r(67241),w=r(43378),y=()=>{let e=(0,l.useTranslations)(),t=(0,o.Z)(e=>e.loginModalVisible),r=async()=>{o.Z.getState().setLoginModalVisible(!1),await new Promise(e=>setTimeout(e,300)),o.Z.getState().setIsEnterpriseLogin(!1)},c=(0,o.Z)(e=>e.callbackUri),u=(0,o.Z)(e=>e.isEnterpriseLogin),[m,g]=(0,i.useState)(""),[_,v]=(0,i.useState)(""),[p,x]=(0,i.useState)(""),y=(0,i.useRef)(null),N=(0,i.useRef)(null);(0,i.useEffect)(()=>{t&&(g(""),v(""),Z())},[t]);let{error:k,setError:j,loading:C,isRegisterMode:E,showPasswordInput:S,validateEmail:F,register:A,login:B,loginByGoogle:D,loginByApple:R,reset:Z,loginType:L,setLoginType:I,isSSOLoginError:O,setIsSSOLoginError:U,showVerificationCode:z,verificationCode:T,setVerificationCode:V,countdown:W,canResend:Y,resendVerificationCode:$,verifyCode:M}=f({email:m,onSucceed:()=>{g(""),v(""),r()}});(0,i.useEffect)(()=>{var e;S&&(null===(e=N.current)||void 0===e||e.focus())},[S]);let P=(0,i.useMemo)(()=>"sso"!==L?e("enterprise.ssoLogin.title"):e("login.email_login_register"),[L,e]),q=(0,i.useMemo)(()=>z&&!S?"verifyCode"===C?e("login.verifying"):e("login.verify_email"):S?"sso"===L?e("enterprise.ssoLogin.use_sso_continue"):E?e("login.register_and_verify_email"):e("login.email_login"):"sso"===L?e("enterprise.ssoLogin.use_sso_continue"):e("login.use_email_login"),[S,z,E,L,C,e]),G=()=>{x(""),j(""),U(!1),"sso"===L?I("email"):I("sso")},J=async t=>{var r,a;if(t.preventDefault(),m&&!C){if(x(""),j(""),U(!1),!(null===(r=y.current)||void 0===r?void 0:r.validity.valid)){j("login.email_incorrect");return}if("sso"===L){let t=await (0,d.ri)(m);if("USER_NOT_FOUND"===t.code){x(e("enterprise.ssoLogin.error_not_have"));return}t.data.is_sso?window.location.href="".concat("https://account.felo.ai","/api/sso/authorize?email=").concat(m):x(e("enterprise.ssoLogin.error_not_have"));return}if(z&&!S){M();return}if(!S){F();return}if(!(null===(a=N.current)||void 0===a?void 0:a.validity.valid)){j("login.password_incorrect");return}if(E){A({email:m,password:_,verifyCode:z?T:void 0});return}B({email:m,password:_,callbackUri:c})}},K=()=>{S&&F()};return(0,a.jsx)(w.Vq,{open:t,onOpenChange:r,children:(0,a.jsxs)(w.cZ,{className:"max-w-md py-3 !rounded-2xl",children:[(0,a.jsxs)(w.fK,{children:[(0,a.jsx)(w.$N,{className:"text-3xl mb-2 text-[#30394a] dark:text-white",children:E?e("login.register_felo"):u?e("enterprise.welcome_to_felo_enterprise"):e("login.welcome_to_felo")}),(0,a.jsx)(w.Be,{className:"text-lg text-[#30394a] dark:text-white",children:E?e("login.register_felo_desc"):u?e("enterprise.welcome_to_felo_enterprise_desc"):e("login.unlock_all_features")})]}),(0,a.jsx)(w.a7,{className:"w-full pt-2 max-w-md mx-auto text-[#30394a] dark:text-white",children:z&&!S?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("form",{onSubmit:J,noValidate:!0,children:[(0,a.jsx)(n.Y,{ref:y,className:"mb-4",classNames:{inputWrapper:"border-1 border-[#ACB9CD] dark:border-[#545D6F]"},type:"email",value:m,onChange:e=>{g(e.target.value.replace(/[^a-zA-Z0-9@._+%-]/g,""))},variant:"bordered",required:!0,pattern:"^[a-zA-Z0-9._%+\\-]+@[a-zA-Z0-9.\\-]+\\.[a-zA-Z]{2,}$",onBlur:K,placeholder:e("login.enter_email"),disabled:z}),(0,a.jsx)(n.Y,{className:"mb-4",classNames:{inputWrapper:"border-1 border-[#ACB9CD] dark:border-[#545D6F]"},type:"text",value:T,onChange:e=>{V(e.target.value.replace(/[^0-9]/g,""))},variant:"bordered",required:!0,maxLength:6,placeholder:e("login.enter_verification_code_from_email"),endContent:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"h-4 self-center border-l border-divider mx-2"}),W>0?(0,a.jsx)("span",{className:"text-sm text-blue-500",children:W}):(0,a.jsx)("button",{type:"button",className:"text-sm min-w-10 w-fit text-blue-600 hover:text-blue-800 ".concat(Y?"":"opacity-50 cursor-not-allowed"),disabled:!Y||"sendCode"===C,onClick:$,children:"sendCode"===C?e("login.sending"):e("login.resend_code")})]})}),k&&(0,a.jsx)("p",{className:"text-sm text-red-500 mb-4",children:e(k)}),(0,a.jsx)(s.A,{className:"w-full mb-4",type:"submit",variant:"solid",color:"primary",isLoading:"verifyCode"===C,isDisabled:!m||!T,children:q}),p&&(0,a.jsx)("div",{className:"text-red-600 text-center mb-4 text-sm",children:p}),O&&(0,a.jsx)("p",{className:"text-red-600 text-center mb-4 text-s",children:e("enterprise.ssoLogin.error_have")}),!z&&(0,a.jsx)("div",{className:"cursor-pointer text-[#4B5F7F] dark:text-[#9295A1] mb-4 text-center text-sm",onClick:G,children:P})]}),(0,a.jsx)("div",{className:"text-center mb-4 text-sm",children:e("login.or")}),(0,a.jsxs)(s.A,{className:"w-full rounded-lg mb-4 border-1 border-[#ACB9CD] dark:border-[#545D6F] text-[#4B5F7F] dark:text-[#9295A1] font-bold",variant:"bordered",disabled:!!C,isLoading:"google"===C,onClick:()=>D(u?c||"/enterprise":void 0),children:[(0,a.jsx)(h._$,{className:"w-6 h-6"}),e("login.use_google_register")]}),(0,a.jsxs)(s.A,{className:"w-full rounded-lg border-1 border-[#ACB9CD] dark:border-[#545D6F] text-[#4B5F7F] dark:text-[#9295A1] font-bold",variant:"bordered",disabled:!!C,isLoading:"apple"===C,onClick:()=>R(u?c||"/enterprise":void 0),children:[(0,a.jsx)(h.nz,{className:"w-6 h-6"}),e("login.use_apple_register")]}),(0,a.jsxs)("div",{className:"cursor-pointer text-[#4B5F7F] dark:text-[#9295A1] mt-4 text-center text-sm flex justify-center items-center",children:[e("login.already_have_account"),(0,a.jsx)("span",{className:"text-blue-500 ml-1",onClick:()=>{x(""),j(""),U(!1),Z()},children:e("login.login")})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(s.A,{className:"w-full rounded-lg mb-4 border-1 border-[#ACB9CD] dark:border-[#545D6F] text-[#4B5F7F] dark:text-[#9295A1] font-bold",variant:"bordered",disabled:!!C,isLoading:"google"===C,onClick:()=>D(u?c||"/enterprise":void 0),children:[(0,a.jsx)(h._$,{className:"w-6 h-6"}),e("login.use_google_login")]}),(0,a.jsxs)(s.A,{className:"w-full rounded-lg mb-4 border-1 border-[#ACB9CD] dark:border-[#545D6F] text-[#4B5F7F] dark:text-[#9295A1] font-bold",variant:"bordered",disabled:!!C,isLoading:"apple"===C,onClick:()=>R(u?c||"/enterprise":void 0),children:[(0,a.jsx)(h.nz,{className:"w-6 h-6"}),e("login.use_apple_login")]}),(0,a.jsx)("div",{className:"text-center mb-4 text-sm",children:e("login.or")}),(0,a.jsxs)("form",{onSubmit:J,noValidate:!0,children:[(0,a.jsx)(n.Y,{ref:y,className:"mb-4",classNames:{inputWrapper:"border-1 border-[#ACB9CD] dark:border-[#545D6F]"},type:"email",value:m,onChange:e=>{g(e.target.value.replace(/[^a-zA-Z0-9@._+%-]/g,""))},variant:"bordered",required:!0,pattern:"^[a-zA-Z0-9._%+\\-]+@[a-zA-Z0-9.\\-]+\\.[a-zA-Z]{2,}$",onBlur:K,placeholder:e("login.enter_email"),disabled:z}),S&&"sso"!==L&&(0,a.jsx)(n.Y,{ref:N,className:"mb-4",type:"password",value:_,onChange:e=>v(e.target.value),variant:"bordered",required:!0,pattern:E?"^(?=.*[a-zA-Z]).{8,}$":void 0,placeholder:e("login.enter_password"),disabled:z}),k&&(0,a.jsx)("p",{className:"text-sm text-red-500 mb-4",children:e(k)}),S&&!E&&"sso"!==L&&(0,a.jsx)("p",{className:"text-sm opacity-60 text-right mb-4",children:(0,a.jsx)("a",{href:"".concat(b.I2,"/account/reset-password"),target:"_blank",onClick:e=>{e.preventDefault(),window.open("".concat(b.I2,"/account/reset-password?email=").concat(m))},children:e("login.forgot_password")})}),(0,a.jsx)(s.A,{className:"w-full mb-4",type:"submit",variant:"solid",color:"primary",isLoading:"email"===C||"validate"===C,isDisabled:!m||S&&E&&!_||S&&!E&&!_,children:q}),p&&(0,a.jsx)("div",{className:"text-red-600 text-center mb-4 text-sm",children:p}),O&&(0,a.jsx)("p",{className:"text-red-600 text-center mb-4 text-s",children:e("enterprise.ssoLogin.error_have")}),!z&&(0,a.jsx)("div",{className:"cursor-pointer text-[#4B5F7F] dark:text-[#9295A1] text-center text-sm",onClick:G,children:P})]})]})})]})})}}}]);