"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[999],{7543:function(e,t,s){s.d(t,{Z:function(){return a}});let a=(0,s(41650).Z)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},80999:function(e,t,s){s.r(t),s.d(t,{default:function(){return D}});var a=s(52676),o=s(75271),l=s(43378),r=s(74926),i=s(31022),n=s(36551),c=s(38188),d=s(65819),u=s(87106),m=s(17112),h=s(25010),p=s(59167),v=s(7543);let g=(0,s(41650).Z)("play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);var _=s(65550),f=s(48958),x=s(37639),y=s(37766),b=s(17224),j=s(25994),N=s(52166),w=s(27976),Z=s(5517);let T=async e=>{try{let t=(0,N.a1)(),s=await (0,Z.Z)("".concat(w.XJ,"/threads/research/step"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"".concat(t)},body:JSON.stringify(e)});if(!s.ok){let e=await s.json().catch(()=>({}));if(422===s.status)return{success:!1,error:e.message||"failed to validate params",code:s.status};return{success:!1,error:e.message||"failed to get research step",code:s.status}}let a=await s.json();return{success:!0,data:a}}catch(e){return{success:!1,error:e instanceof Error?e.message:"failed to get research step",code:500}}};var k=s(7717),S=s(52090),C=s(26152),E=s(26449),z=s(48518),A=s(31063),q=s(60161),D=()=>{let e=(0,k.useTranslations)(),{template:t,templateQuery:s,isAgentPlanModalOpen:N,setAgentPlanModalOpen:w,closeAgentPlanModal:Z}=(0,r.Z)(),{setTemplateData:D}=(0,z.Z)(),I=(0,i.Z)(e=>e.endSearch),G=y.Z.getState().homeFiles,V=(0,i.Z)(e=>e.isTopicReply),O=(0,i.Z)(e=>e.extensionSelected),R=(0,b.useRouter)(),U=y.Z.getState().homeImages;(0,k.useLocale)();let[J,M]=(0,o.useState)(!1),[X,F]=(0,o.useState)([]),[P,Y]=(0,o.useState)(!1);(0,o.useEffect)(()=>{try{var e;M(!!((null==t?void 0:t.params)&&(null==t?void 0:null===(e=t.params[0])||void 0===e?void 0:e.type)==="file"))}catch(e){console.log(e),M(!1)}},[t]);let Q=(0,o.useMemo)(()=>!!t||O===n.Wh,[O,t]),B=(0,o.useMemo)(()=>y.Z.getState().homeFiles,[G]);(0,o.useEffect)(()=>{N&&(F([]),Q?K():L())},[N]);let K=async()=>{if(!t)return;if(!s.replace(/[\r\n]+/g," ").trim()){F(t.sub_topics.map(e=>({content:e.title,source_type:e.source_type,source_id:e.source_id,source_info:e.source_info})));return}let{proSelected:a}=i.Z.getState(),o=a?n.NY:n.R_,l=localStorage.getItem(c.J.GTAG_EVENT_ACTIVATION)||d.ZP.getState().anonymousToken;Y(!0);let r=await (0,u.GK)(t.short_id,{query:s,mode:o,device_id:l});if(!r||!r.data||!r.success){m.Z.error((null==r?void 0:r.error)||e("agent.load_template_failed")),Y(!1);return}F(r.data.sub_queries.map((e,s)=>{var a,o,l,r,i,n;return{content:e,source_type:(null===(o=t.sub_topics)||void 0===o?void 0:null===(a=o[s])||void 0===a?void 0:a.source_type)||"google",source_id:(null===(r=t.sub_topics)||void 0===r?void 0:null===(l=r[s])||void 0===l?void 0:l.source_id)||"",source_info:(null===(n=t.sub_topics)||void 0===n?void 0:null===(i=n[s])||void 0===i?void 0:i.source_info)||void 0}})),Y(!1)},L=async()=>{if(!s)return;let{proSelected:t}=i.Z.getState(),a=t?n.NY:n.R_,o=localStorage.getItem(c.J.GTAG_EVENT_ACTIVATION)||d.ZP.getState().anonymousToken;Y(!0);let l=await T({query:s,mode:a,device_id:o});if(!l||!l.data||!l.success){m.Z.error((null==l?void 0:l.error)||e("error.research_failed")),Y(!1);return}F(l.data.steps.map(e=>({content:e,source_type:n.gl,source_id:""}))),Y(!1)},W=(e,t)=>{F(X.map((s,a)=>a===e?{...s,content:t}:s))},$=(e,t)=>{F(X.map((s,a)=>a===e?{...s,source_type:t.source_type,source_id:t.source_id,source_info:t.source_info}:s))},H=e=>{X.length<=1||F(X.filter((t,s)=>s!==e))},ee=t=>{if(X.length>=j.o2){m.Z.warning(e("agent.max_steps_reached",{count:j.o2}));return}let s=[...X];s.splice(t+1,0,{content:"",source_type:n.gl,source_id:""}),F(s)},et=()=>{Z(),I(),F([]),y.Z.getState().setIsGoToSearch(!1)},es=()=>{var e,a,o,l,i,c,d;let u={query:"",multiQuery:X.map(e=>({query:e.content,category:J?"chat_with_document":e.source_type||n.gl,source_id:e.source_id})),templateId:null===(e=r.Z.getState().template)||void 0===e?void 0:e.id};(null==B?void 0:null===(a=B.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===a?void 0:a.length)&&(u.category="chat_with_document",u.documents=null==B?void 0:null===(i=B.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===i?void 0:null===(l=i.map(e=>null==e?void 0:e.id))||void 0===l?void 0:l.join(",")),(null==U?void 0:null===(o=U.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===o?void 0:o.length)&&(u.category="chat_with_document",u.documents=null==U?void 0:null===(d=U.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===d?void 0:null===(c=d.map(e=>null==e?void 0:e.id))||void 0===c?void 0:c.join(",")),V&&(u.topicSource="topic"),D({templateQuery:s,template:t});let m=(0,x.MD)(u);R.push(m),et(),(0,A.fk)((null==t?void 0:t.system)?q.U.AGENT_EXECUTE:q.U.AGENT_CREATE_EXECUTE,{value:1},!0)};return(0,a.jsx)(l.Vq,{open:N,onOpenChange:e=>{e&&w(e),e||et()},children:(0,a.jsxs)(l.cZ,{className:"max-w-3xl w-full p-0 overflow-visible",hideCloseButton:!0,"aria-describedby":void 0,children:[(0,a.jsx)(C.T,{children:(0,a.jsx)(S.$N,{children:e("agent.agent_query_steps")})}),(0,a.jsxs)("div",{className:"p-8 relative max-h-[90vh] overflow-y-auto scrollbar",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-8",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold bg-gradient-to-r from-blue-600 to-blue-400 bg-clip-text text-transparent",children:e("agent.agent_query_steps")}),(0,a.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:e("agent.agent_query_steps_tip")})]}),(0,a.jsxs)(h.z,{size:"sm",variant:"outline",disabled:P,onClick:()=>{if(X.length>=j.o2){m.Z.warning(e("agent.max_steps_reached",{count:j.o2}));return}F([...X,{content:"",source_type:n.gl,source_id:""}])},className:"hover:bg-blue-50 dark:hover:bg-gray-600 transition-colors",children:[(0,a.jsx)(p.Z,{className:"w-4 h-4 mr-2"}),e("agent.add_step")]})]}),P&&(0,a.jsx)("div",{className:"space-y-6",children:Array((null==t?void 0:t.sub_topics.length)||3).fill(0).map((e,t)=>(0,a.jsx)(_.X,{className:"rounded-lg",children:(0,a.jsx)("div",{className:"h-10 rounded-lg bg-default-300"})},t))}),(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)("div",{className:"space-y-6 relative",children:X.map((t,s)=>(0,a.jsxs)("div",{className:"flex items-center relative",children:[(0,a.jsx)("div",{className:"shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-medium shadow-md shadow-blue-100 dark:shadow-blue-600 transition-transform relative z-10",children:s+1}),s<X.length-1&&(0,a.jsx)("div",{className:"absolute left-4 top-8 w-[2px] h-[calc(100%+1rem)] bg-gradient-to-b from-blue-200 to-transparent -z-0"}),(0,a.jsxs)("div",{className:"ml-4 flex-1 flex items-center gap-2",children:[(0,a.jsx)(f.Y,{value:t.content,onValueChange:e=>W(s,e),placeholder:e("agent.input_step_content"),variant:"flat"}),(0,a.jsxs)("div",{className:"flex gap-1",children:[!J&&(0,a.jsx)(E.Z,{item:{title:t.content,source_type:t.source_type,source_id:t.source_id,source_info:t.source_info},onChange:$,index:s}),(0,a.jsx)(h.z,{size:"sm",variant:"ghost",onClick:()=>ee(s),className:"hover:bg-blue-50 dark:hover:bg-gray-600",disabled:X.length>=j.o2,children:(0,a.jsx)(p.Z,{className:"w-4 h-4 text-blue-500"})}),X.length>1&&(0,a.jsx)(h.z,{size:"sm",variant:"ghost",onClick:()=>H(s),className:"hover:bg-red-50 dark:hover:bg-gray-600",children:(0,a.jsx)(v.Z,{className:"w-4 h-4 text-red-500"})})]})]})]},s))})}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,a.jsx)(h.z,{variant:"outline",className:"px-4 py-2 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors duration-200",onClick:et,children:e("cancel")}),(0,a.jsxs)(h.z,{className:"px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-md hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>{P||es()},disabled:P||X.some(e=>!e.content.trim()),autoFocus:!0,children:[(0,a.jsx)(g,{className:"w-4 h-4 mr-1"}),e("execute")]})]})]})]})})}},48518:function(e,t,s){let a=(0,s(75910).Ue)(e=>({currentData:void 0,templateData:void 0,setCurrentData:t=>e({currentData:t}),setTemplateData:t=>e({templateData:t}),clearCurrentData:()=>e({currentData:void 0}),clearTemplateData:()=>e({templateData:void 0})}));t.Z=a}}]);