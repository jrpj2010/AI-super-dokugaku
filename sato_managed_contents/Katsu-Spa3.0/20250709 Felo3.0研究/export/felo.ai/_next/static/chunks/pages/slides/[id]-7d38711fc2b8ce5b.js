(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6390],{12737:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/slides/[id]",function(){return l(19894)}])},8289:function(e,t,l){"use strict";l.d(t,{Z:function(){return s}});let s=(0,l(41650).Z)("lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]])},19894:function(e,t,l){"use strict";l.r(t),l.d(t,{__N_SSP:function(){return eY},default:function(){return eJ}});var s=l(52676),a=l(93992),r=l.n(a),n=l(87582),i=l(16023),d=l(7717),o=l(17224),c=l(75271);l(85625);var u=l(65819),m=l(21516),h=l(37588),x=l(95174),p=l(62208),g=l(94572);class v{add(e){this.queue.push(e)}clear(){this.isCleared=!0,this.queue=[]}async start(){let e=this.queue.length;this.isCleared=!1;let t=0;return new Promise(l=>{let s=()=>{(t===e||this.isCleared)&&l(this.results)},a=async(e,l)=>{if(console.log("runTask index",l),!this.isCleared){this.running++;try{let t=await e();this.results[l]=t}catch(e){this.results[l]=e}this.running--,t++,r(),s()}},r=()=>{if(0===this.queue.length||this.isCleared)return;let l=Math.min((t<2?1:this.concurrency)-this.running,this.queue.length);for(let t=0;t<l;t++){let t=this.queue.shift();t&&a(t,e-this.queue.length-1)}};if(this.queue.length>0){let e=this.queue.shift();e&&a(e,0)}})}constructor(e=3){this.concurrency=e,this.running=0,this.queue=[],this.results=[],this.isCleared=!1}}let f=(e,t)=>{let l=Array(e-1).fill(void 0);return t.forEach(e=>{l[e.page-1]={page:e.page,url:e.path,html:"",status:2,time:""}}),l},b=e=>Array(e).fill(void 0);var j=l(31063),y=l(60161),w=l(63023),S=e=>{var t;let{onUpdateTitle:l,onGenerateSucceed:s,modelType:a,businessType:r="AGENT_THREAD",ssrDetail:n}=e,i=(0,o.useRouter)(),u=(0,d.useTranslations)(),S=(0,p.Z)(e=>e.setSortSlidesId),k=(0,c.useRef)(),[_,C]=(0,c.useState)((null==n?void 0:null===(t=n.data)||void 0===t?void 0:t.plan)?"succeed":"waiting"),N=(0,c.useRef)((0,w.s)()||(Array.isArray(i.query.id)?i.query.id[0]:i.query.id)),Z=(0,c.useRef)(new AbortController),E=()=>(Z.current&&Z.current.abort(),Z.current=new AbortController,Z.current),F=e=>{e<=0||h.Z.getState().updateChatList({content:u("generateSlides.generated_plan",{count:e,minutes:Math.ceil(e/("PRO"===a?1:3)*("PRO"===a?1:1.5))}),id:"plan",type:"default",role:"system"})},T=async(e,t)=>{let{updateChatList:l}=h.Z.getState();1===e&&(l({content:u("generateSlides.generating_slide_page",{page:t}),id:"page_".concat(t,"_status"),type:"status",role:"system",data:{variant:"loading"}}),await (0,g.gw)(300)),2===e&&(l({content:u("generateSlides.generated_slide_page_success",{page:t}),id:"page_".concat(t,"_status"),type:"status",role:"system",data:{variant:"succeed"}}),await (0,g.gw)(300)),-1===e&&(l({content:u("generateSlides.generated_slide_page_failure",{page:t}),id:"page_".concat(t,"_status"),type:"status",role:"system",data:{variant:"warning"}}),await (0,g.gw)(300))},I=async()=>{let e=N.current;if(e)try{let t=E();return"PRO"===a?await (0,m.sh)({business_id:e,business_type:r||"MESSAGE",model_type:"PRO"},t):await (0,m.F1)({business_id:e,business_type:r||"MESSAGE"},t)}catch(e){C("failed"),h.Z.getState().setIsGenerating(!1),console.log("generatePlan failed",e)}},A=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=N.current;if(!l)return{page:e,success:!1,code:-1};try{let t=E(),s="PRO"===a?await (0,m.A7)({business_id:l,business_type:r||"MESSAGE",page:e,model_type:"PRO"}):await (0,m._Q)({business_id:l,business_type:r||"MESSAGE",page:e},t);if(console.log("generateSlideRes",s),!(null==s?void 0:s.ok)){if((null==s?void 0:s.status)===402)return{page:e,success:!1,code:402};throw Error("Request for generating slides failed: ".concat(e))}let n=(0,x.U)(s),i="",d=!1;try{for await(let t of n)try{let l=JSON.parse((null==t?void 0:t.data)||"{}");if(l&&"streaming"===l.status)i+=l.delta,h.Z.getState().updateHtmlItem(e,{html:i,status:1});else if(l&&"evaluate"===l.status){console.log("jsonData?.evaluate",null==l?void 0:l.evaluate);try{let t=null==l?void 0:l.evaluate;t&&h.Z.getState().updateHtmlItem(e,{evaluate:t.result,reason:null==t?void 0:t.reason})}catch(e){console.log("\uD83D\uDE80 ~ forawait ~ error:",e)}}else l&&"done"===l.status&&l.path&&(i+=l.delta,d=!0,h.Z.getState().updateHtmlItem(e,{html:i,status:2,url:l.path}))}catch(t){throw console.error("Failed to parse event data (page: ".concat(e,"):"),t),h.Z.getState().updateHtmlItem(e,{status:-1}),t}if(!d)throw Error("Generating slides failed: ".concat(e," done message not received"));return{page:e,success:!0,code:200}}catch(t){throw console.error("Failed to process the streaming data (page: ".concat(e,"):"),t),h.Z.getState().updateHtmlItem(e,{status:-1}),t}}catch(l){if(console.error("Failed to generate the slide presentation. (page: ".concat(e,", retry: ").concat(t,"):"),l),l instanceof Error&&"AbortError"===l.name)return console.log("Request aborted for page ".concat(e,". This is normal when starting new requests.")),{page:e,success:!1,code:-1};if(0===t)return console.log("Failed to generate the slides. Please try to retry generating the slides. (page: ".concat(e,")...")),await (0,g.gw)(3e3),A(e,t+1);return h.Z.getState().updateHtmlItem(e,{status:-1}),{page:e,success:!1,code:-1}}},D=async e=>{let{html:t,element_id:l,ai_input:s,page:a,retryCount:r=0}=e,n=N.current;if(!n)return{page:a,success:!1};h.Z.getState().updateHtmlItem(a,{status:0});try{let e=E(),r=await (0,m.rO)({html:t,element_id:l,ai_input:s},e);if(!(null==r?void 0:r.ok))throw Error("Request for generating slides failed");let i=(0,x.U)(r),d="",o=!1;try{for await(let e of i)try{let t=JSON.parse((null==e?void 0:e.data)||"{}");if(t&&"streaming"===t.status)d+=t.delta,h.Z.getState().updateHtmlItem(a,{html:d,status:1});else if(t&&"done"===t.status){o=!0;let e=await (0,m.ZN)({business_id:n,business_type:"AGENT_THREAD",page:a,content:d,model_type:"PRO"});h.Z.getState().updateHtmlItem(a,{status:2,url:null==e?void 0:e.path})}}catch(e){throw console.error("Failed to parse event data (page: ".concat(a,"):"),e),h.Z.getState().updateHtmlItem(a,{status:-1}),e}if(!o)throw Error("Generating slides failed: ".concat(a," done message not received"));return{page:a,success:!0}}catch(e){throw console.error("Failed to process the streaming data (page: ".concat(a,"):"),e),h.Z.getState().updateHtmlItem(a,{status:-1}),e}}catch(e){if(console.error("Failed to generate the slide presentation. (page: ".concat(a,", retry: ").concat(r,"):"),e),e instanceof Error&&"AbortError"===e.name)return console.log("Edit request aborted for page ".concat(a,". This is normal when starting new requests.")),{page:a,success:!1};if(0===r)return console.log("Failed to generate the slides. Please try to retry generating the slides. (page: ".concat(a,")...")),await (0,g.gw)(3e3),D({html:t,element_id:l,ai_input:s,page:a,retryCount:r+1});return h.Z.getState().updateHtmlItem(a,{status:-1}),{page:a,success:!1}}},R=(0,c.useRef)(),P=()=>{window.clearInterval(R.current),R.current=void 0},L=async e=>{let{detail:t,onUpdateTitle:l}=e,s=N.current;if(s){h.Z.getState().setSlidesPlan([]),h.Z.getState().setInitialSlidesPlan([]),h.Z.getState().setHtmlList([]),C("getOutline"),S(s),h.Z.getState().setIsGenerating(!0);try{var a,r,n,i;let e,s;(null==t?void 0:null===(a=t.data)||void 0===a?void 0:a.plan)||h.Z.getState().updateChatList({id:"generate_outline",type:"status",role:"system",data:{variant:"loading"},content:u("generateSlides.plan_generating")}),(0,j.fk)(y.U.CREATE_SLIDES_PPT_PLAN,{value:"create_slides_ppt_plan"},!0);let d=await I();if((null==d?void 0:d.ok)&&200===d.status){let a;for await(let t of(0,x.U)(d))try{let s=JSON.parse((null==t?void 0:t.data)||"{}");s&&"start"===s.status&&s.title?null==l||l(s.title):s&&"done"===s.status&&(e=a=s.result)}catch(e){console.log(e)}if(a&&a.slides)null==(s=a)||null===(r=s.slides)||void 0===r||r.length,F(s.slides.length);else{k.current&&(window.clearTimeout(k.current),k.current=void 0),C("failed"),h.Z.getState().setIsGenerating(!1),(null==t?void 0:null===(n=t.data)||void 0===n?void 0:n.plan)||h.Z.getState().updateChatList({id:"generate_outline",type:"status",role:"system",data:{variant:"warning"},content:u("generateSlides.plan_generated_failure")});return}}else{C("failed"),(null==t?void 0:null===(i=t.data)||void 0===i?void 0:i.plan)||h.Z.getState().updateChatList({id:"generate_outline",type:"status",role:"system",data:{variant:"warning"},content:u("generateSlides.plan_generated_failure")}),h.Z.getState().setIsGenerating(!1);return}if(null==e?void 0:e.slides)for(let t of e.slides)try{h.Z.getState().updateSlidesPlanItem(t.page,t),await (0,g.gw)(1e3)}catch(e){console.error(e)}return C("getOutlineSuccess"),s}catch(e){if(e instanceof Error){if("AbortError"===e.name){console.log("Generate outline request aborted. This is normal when starting new requests.");return}console.error("Failed in generateOutline process:",e)}return}}},O=async e=>{var t,l,r,n,i,d,o,c;let m,{plan:x,slidesRes:p,startPage:g,isRetry:j}=e;if(!x)return;let y=null!==(o=null==x?void 0:null===(t=x.slides)||void 0===t?void 0:t.length)&&void 0!==o?o:0;(null==p?void 0:null===(l=p.data)||void 0===l?void 0:l.plan)||h.Z.getState().updateChatList({id:"generate_outline",type:"status",role:"system",data:{variant:"succeed"},content:u("generateSlides.plan_generated_success")}),C("succeed"),k.current&&(window.clearTimeout(k.current),k.current=void 0),m=p&&(null==p?void 0:p.status)===200&&(null==p?void 0:null===(r=p.data)||void 0===r?void 0:r.slides)&&(null==p?void 0:null===(i=p.data)||void 0===i?void 0:null===(n=i.slides)||void 0===n?void 0:n.length)?f(y,null==p?void 0:null===(c=p.data)||void 0===c?void 0:c.slides):b(y),x.background&&h.Z.getState().setWrapperBackground(x.background),h.Z.getState().setHtmlList(m);let w="PRO"===a&&g&&g>0?null===(d=h.Z.getState().htmlList)||void 0===d?void 0:d.filter((e,t)=>t+1===g||(null==e?void 0:e.status)===-1&&t+1>g):m,S=new v("PRO"===a?2:3);w.forEach((e,t)=>{var l;if(!g&&!j&&(null==e?void 0:e.status)===2)return;let s=null!==(l=null==e?void 0:e.page)&&void 0!==l?l:t+1;S.add(async()=>(h.Z.getState().updateHtmlItem(s,{status:0}),T(1,s),A(s).then(e=>{let t=null==e?void 0:e.page;if(e.success)T(2,t);else if(!(null==e?void 0:e.success)&&t){if(h.Z.getState().updateHtmlItem(t,{status:-1,code:null==e?void 0:e.code}),T(-1,t),!g)for(let l=t+1;l<=m.length;l++)h.Z.getState().updateHtmlItem(l,{status:-1,code:null==e?void 0:e.code}),T(-1,l);S.clear()}return e})))}),await S.start(),null==s||s()},M=async e=>{var t,s,a,r,n,i;let{detail:d,startPage:o,isRetry:c,retryOutline:u}=e;if(C("init"),u){let e=await L({detail:d,onUpdateTitle:l});h.Z.getState().setInitialSlidesPlan(null!==(i=null==e?void 0:e.slides)&&void 0!==i?i:[]);return}(null==d?void 0:null===(s=d.data)||void 0===s?void 0:null===(t=s.slides)||void 0===t?void 0:t.length)&&d.data.plan?(h.Z.getState().setSlidesPlan(d.data.plan.slides),await O({plan:d.data.plan,slidesRes:d,startPage:o,isRetry:c})):(null==d?void 0:null===(n=d.data)||void 0===n?void 0:null===(r=n.plan)||void 0===r?void 0:null===(a=r.slides)||void 0===a?void 0:a.length)&&(h.Z.getState().setSlidesPlan(d.data.plan.slides),h.Z.getState().setInitialSlidesPlan(d.data.plan.slides),C("getOutlineSuccess"))};return(0,c.useEffect)(()=>()=>{var e;k.current&&window.clearTimeout(k.current),P(),null==Z||null===(e=Z.current)||void 0===e||e.abort()},[]),{status:_,setStatus:C,init:M,generateSlide:A,editSlideHtml:D,updateMessageId:e=>{N.current=e},generateOutline:L,generateSlides:O,addGeneratePlanNotice:F}},k=l(4814),_=l(39109),C=l(83438),N=l(25010),Z=l(55986),E=l(67415),F=l(27976),T=l(25773),I=l(59470),A=l(37892),D=l(1167),R=e=>{let{icon:t,onClick:l,disabled:a,className:r}=e;return(0,s.jsx)(N.z,{variant:"ghost",size:"icon",className:(0,k.Z)("rounded-md w-6 h-6 p-0 bg-white dark:bg-slate-600",r||""),onClick:l,disabled:a,children:t})},P=l(58014),L=l(67508),O=l(97382),M=l(60904),H=l(48117);let B=e=>{let{page:t,messageId:l,modelType:a,setUnlike:r}=e,n=(0,d.useTranslations)(),i=(0,_.Z)(),o=(0,h.Z)(e=>e.sidebarType),u=(0,h.Z)(e=>e.setIsOpenFeedbackForm),x=(0,h.Z)(e=>e.setIsShowFeedback),[p,g]=(0,c.useState)(""),[v,f]=(0,c.useState)(!1),[b,j]=(0,c.useState)([]),y=async()=>{let e=(null==b?void 0:b.length)>0;if(console.log("\uD83D\uDE80 ~ handleSubmit ~ otherComments:",e,p,b),!e&&!p.trim()){i.default(n("feedbackSlides.feedback_required"));return}f(!0);let s=await (0,m.$Y)({business_id:l,model_type:a,page:t,score:"TERRIBLE",type:b||[],content:p});f(!1),(null==s?void 0:s.code)==="OK"&&(u(t,!1),x(t,!1),null==r||r(!0))},w=e=>{j(t=>{let l=t||[];return[...(null==l?void 0:l.includes(e))?l.filter(t=>t!==e):[...l,e]]})};return(0,s.jsxs)("div",{className:(0,k.Z)(-1===t?"shadow-sm":"absolute top-0 z-50 shadow-lg",o?"left-0":"right-0","bg-white p-5 min-w-56 min-h-36 rounded-xl  mx-auto text-[#5F7698]","transition-all duration-300 ease-in-out","animate-in slide-in-from-right-5 fade-in-0","data-[state=closed]:animate-out data-[state=closed]:slide-out-to-right-5 data-[state=closed]:fade-out-0","dark:bg-slate-600 dark:text-slate-200"),children:[(0,s.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-sm font-bold",children:n("feedbackSlides.feedback_title")}),(0,s.jsx)("div",{className:"flex items-center justify-center cursor-pointer w-6 h-6 bg-[#EFF4F8] rounded-full p-[4px] dark:bg-slate-400",onClick:()=>{u(t,!1)},children:(0,s.jsx)(M.Z,{className:"w-3.5 h-3.5"})})]}),(0,s.jsxs)("div",{className:"space-y-3 text-xs",children:[(0,s.jsx)("div",{className:(0,k.Z)("py-1.5 px-3 rounded-full border  transition-colors cursor-pointer","hover:bg-slate-50 dark:hover:bg-slate-700",b.includes("STYLE")?"border-primary text-[#0080FF] dark:border-primary":"border-gray-200 dark:border-slate-400"),onClick:()=>w("STYLE"),children:(0,s.jsxs)("p",{children:[" ",n("feedbackSlides.feedback_issue_design")]})}),(0,s.jsx)("div",{className:(0,k.Z)("py-1.5 px-3 rounded-full border  transition-colors cursor-pointer","hover:bg-slate-50 dark:hover:bg-slate-700",b.includes("COLOR")?"border-primary text-[#0080FF] dark:border-primary":"border-gray-200 dark:border-slate-400"),onClick:()=>w("COLOR"),children:(0,s.jsxs)("p",{children:[" ",n("feedbackSlides.feedback_issue_color")]})}),(0,s.jsx)("div",{className:(0,k.Z)("py-1.5 px-3 rounded-full border  transition-colors cursor-pointer","hover:bg-slate-50 dark:hover:bg-slate-700",b.includes("CONTENT_LAYOUT")?"border-primary text-[#0080FF] dark:border-primary":"border-gray-200 dark:border-slate-400"),onClick:()=>w("CONTENT_LAYOUT"),children:(0,s.jsxs)("p",{children:[" ",n("feedbackSlides.feedback_issue_layout")]})}),(0,s.jsx)("div",{className:"mt-5",children:(0,s.jsx)(H.g,{placeholder:n("feedbackSlides.feedback_input_placeholder"),rows:2,className:(0,k.Z)("focus-visible:ring-0 focus-visible:ring-offset-0","w-full h-20 p-2 border-0 border-gray-200 rounded-md text-xs md:text-xs bg-[#F2F5F9]","dark:bg-slate-500 dark:border-slate-400"),value:p,onChange:e=>g(e.target.value)})})]}),(0,s.jsx)("div",{className:"mt-2.5",children:(0,s.jsxs)(N.z,{className:"w-full",onClick:y,disabled:v,children:[v&&(0,s.jsx)(T.Z,{className:"animate-spin size-4"}),n("feedbackSlides.feedback_btn")]})})]})};var z=e=>{let{page:t,onRegenerate:l,messageId:a,modelType:r}=e,n=(0,d.useTranslations)(),i=(0,h.Z)(e=>e.setIsOpenFeedbackForm),o=(0,h.Z)(e=>e.isOpenFeedbackForm[t]),[u,x]=(0,c.useState)(!1),[p,g]=(0,c.useState)(!1),[v,f]=(0,c.useState)(!1),[b,j]=(0,c.useState)(!1),[y,w]=(0,c.useState)(!1),S=async()=>{b||(j(!0),(0,m.$Y)({business_id:a,model_type:r,page:t,score:"AMAZING"}))},_=async()=>{y||(i(t,!0),f(!1))};return(0,c.useEffect)(()=>{},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(D.pn,{delayDuration:0,children:(0,s.jsxs)(D.u,{open:u,children:[(0,s.jsx)(D.aJ,{asChild:!0,children:(0,s.jsx)("div",{onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:(0,s.jsx)(R,{onClick:()=>null==l?void 0:l(!0),icon:(0,s.jsx)(P.Z,{className:(0,k.Z)("size-3 text-slate-500 dark:text-slate-200")})})})}),(0,s.jsxs)(D._v,{side:"right",className:"bg-[#1e293b] border-[#1e293b] text-gray-200",children:[(0,s.jsx)(D.Ce,{}),n("editSlides.regenerate")]})]})}),y?null:(0,s.jsx)(D.pn,{delayDuration:0,children:(0,s.jsxs)(D.u,{open:p,children:[(0,s.jsx)(D.aJ,{asChild:!0,children:(0,s.jsx)("div",{onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:(0,s.jsx)(R,{onClick:S,className:(0,k.Z)(b?"cursor-default pointer-events-none":""),icon:(0,s.jsx)(L.Z,{className:(0,k.Z)("size-3 ",b?"text-primary dark:text-primary":"text-slate-500 dark:text-slate-200")})})})}),(0,s.jsxs)(D._v,{side:"right",className:"bg-[#1e293b] border-[#1e293b] text-gray-200",children:[(0,s.jsx)(D.Ce,{}),n("feedbackSlides.like")]})]})}),b?null:o?(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)(B,{page:t,messageId:a,modelType:r,setUnlike:w})}):(0,s.jsx)(D.pn,{delayDuration:0,children:(0,s.jsxs)(D.u,{open:v,children:[(0,s.jsx)(D.aJ,{asChild:!0,children:(0,s.jsx)("div",{onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:(0,s.jsx)(R,{onClick:_,className:(0,k.Z)(y?"cursor-default pointer-events-none":""),icon:(0,s.jsx)(O.Z,{className:(0,k.Z)("size-3 ",y?"text-primary dark:text-primary":"text-slate-500 dark:text-slate-200")})})})}),(0,s.jsxs)(D._v,{side:"right",className:"bg-[#1e293b] border-[#1e293b] text-gray-200",children:[(0,s.jsx)(D.Ce,{}),n("feedbackSlides.dislike")]})]})})]})},q=l(89146);let U=e=>null==e?void 0:e.replaceAll(F.q1,"/ppt-html"),G=(0,c.forwardRef)((e,t)=>{var l;let{page:a,item:r,regenerateSlide:n,isSelf:i,isShowHeadHandle:o=!0,messageId:u,modelType:m,totalCount:x}=e,p=(0,d.useTranslations)(),[g,v]=(0,c.useState)(!0),f=(0,c.useRef)(null),b=(0,c.useRef)(null);(0,_.Z)();let j=(0,I.Z)(r),y=(0,c.useRef)(1),w=(0,c.useRef)(null),S=(0,c.useRef)(),F=(0,h.Z)(e=>e.isOpenFeedbackForm[a]),R=(0,h.Z)(e=>e.isShowFeedback[a]),P=(0,h.Z)(e=>e.setIsShowFeedback),{setInited:L,isEditing:O}=(0,C.ZP)({slideIndex:a,scaling:()=>y.current,canEdit:i,iframeRef:b,saveType:"slide"});(0,c.useImperativeHandle)(t,()=>({setInited:L}),[L]);let M=(null==r?void 0:r.status)||0;null==r||r.code,(0,c.useEffect)(()=>{let e=()=>{let{undoStack:e}=q.Z.getState(),t=e.at(-1);if(console.log("[SlideItem-".concat(a,"] Global undo event, lastOp:"),t),t&&t.slideIndex===a){var s;if(console.log("[SlideItem-".concat(a,"] Processing undo for current slide")),!(null===(s=b.current)||void 0===s?void 0:s.contentDocument)){console.log("[SlideItem-".concat(a,"] No iframe document available"));return}if("complete"!==b.current.contentDocument.readyState){console.log("[SlideItem-".concat(a,"] Iframe not ready, waiting..."));let e=setInterval(()=>{var t,s;(null===(s=b.current)||void 0===s?void 0:null===(t=s.contentDocument)||void 0===t?void 0:t.readyState)==="complete"&&(clearInterval(e),l())},100);return}l()}else console.log("[SlideItem-".concat(a,"] Skipping undo - not for this slide (").concat(null==t?void 0:t.slideIndex,")"))},t=()=>{let{redoStack:e}=q.Z.getState(),t=e.at(-1);if(console.log("[SlideItem-".concat(a,"] Global redo event, lastOp:"),t),t&&t.slideIndex===a){var l;if(console.log("[SlideItem-".concat(a,"] Processing redo for current slide")),!(null===(l=b.current)||void 0===l?void 0:l.contentDocument)){console.log("[SlideItem-".concat(a,"] No iframe document available"));return}if("complete"!==b.current.contentDocument.readyState){console.log("[SlideItem-".concat(a,"] Iframe not ready, waiting..."));let e=setInterval(()=>{var t,l;(null===(l=b.current)||void 0===l?void 0:null===(t=l.contentDocument)||void 0===t?void 0:t.readyState)==="complete"&&(clearInterval(e),s())},100);return}s()}else console.log("[SlideItem-".concat(a,"] Skipping redo - not for this slide (").concat(null==t?void 0:t.slideIndex,")"))},l=()=>{var e,t;let l=new CustomEvent("slide:undo",{bubbles:!0,cancelable:!0});null===(t=b.current)||void 0===t||null===(e=t.contentDocument)||void 0===e||e.dispatchEvent(l)},s=()=>{var e,t;let l=new CustomEvent("slide:redo",{bubbles:!0,cancelable:!0});null===(t=b.current)||void 0===t||null===(e=t.contentDocument)||void 0===e||e.dispatchEvent(l)};return window.addEventListener("global-undo",e),window.addEventListener("global-redo",t),()=>{window.removeEventListener("global-undo",e),window.removeEventListener("global-redo",t)}},[a]),(0,c.useEffect)(()=>{f.current&&f.current.scrollTo({top:f.current.scrollHeight,behavior:"smooth"})},[r]);let H=()=>{var e,t;if(!w.current||!b.current)return;let l=null===(e=j.current)||void 0===e?void 0:e.width;if(!l)return;let s=(null===(t=w.current)||void 0===t?void 0:t.clientWidth)/l;y.current=s,b.current.style.transform="scale(".concat(s,")")},B=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(t){var l,s,a;let t=(null===(l=b.current)||void 0===l?void 0:l.contentDocument)||(null===(a=b.current)||void 0===a?void 0:null===(s=a.contentWindow)||void 0===s?void 0:s.document);t&&q.Z.getState().saveSnapshotForOperation(e,"before-regenerate",t);let r=setInterval(()=>{var t,l,s;let a=(null===(t=b.current)||void 0===t?void 0:t.contentDocument)||(null===(s=b.current)||void 0===s?void 0:null===(l=s.contentWindow)||void 0===l?void 0:l.document);a&&"complete"===a.readyState&&(clearInterval(r),q.Z.getState().saveSnapshotForOperation(e,"after-regenerate",a),setTimeout(()=>{console.log("[SlideItem-".concat(e,"] Re-enabling edit after regeneration")),L(!0)},1e3))},100)}L(!1),n(e)};(0,c.useEffect)(()=>{if(2===M){let e=setTimeout(()=>{v(!1)},1e3);return()=>clearTimeout(e)}v(!0)},[M]),(0,c.useEffect)(()=>{function e(e){var t,l,s,r,n,i;let d=e.data;if(e.origin!==location.origin||!(null===(t=j.current)||void 0===t?void 0:t.url))return;let o=(0,Z.yY)(j.current.url),c=(0,Z.yY)(null==d?void 0:d.pathname);if((null==d?void 0:d.type)==="felo.ai.iframe.size"&&o===c&&w.current){let e=null!==(s=null==d?void 0:d.width)&&void 0!==s?s:0,t=null!==(r=null==d?void 0:d.height)&&void 0!==r?r:0,o=(null===(l=w.current)||void 0===l?void 0:l.clientWidth)/e;if(y.current=o,b.current&&t){h.Z.getState().updateHtmlItem(a,{height:t,width:e}),b.current.style.height="".concat(t,"px"),b.current.style.width="".concat(e,"px"),b.current.style.transform="scale(".concat(o,")");let l=null==b?void 0:null===(i=b.current)||void 0===i?void 0:null===(n=i.parentElement)||void 0===n?void 0:n.parentElement;l&&(l.style.aspectRatio="".concat(e," / ").concat(t)),setTimeout(()=>{L(!0)},2e3)}}}return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[]),(0,c.useEffect)(()=>{let e=()=>{window.requestAnimationFrame(H)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]);let G=(0,h.Z)(e=>e.sidebarType);(0,c.useEffect)(()=>{H()},[G]);let V=()=>{S.current&&clearTimeout(S.current),P(a,!0)};return(0,c.useEffect)(()=>()=>{S.current&&clearTimeout(S.current)},[]),(0,c.useEffect)(()=>{F||(S.current=setTimeout(()=>{P(a,!1)},2e3))},[F,a,P]),(0,s.jsx)("div",{ref:w,id:"slide-item-".concat(a),children:(0,s.jsxs)("div",{className:(0,k.Z)("rounded-[18px] bg-white dark:bg-gray-600 relative","shadow-[0_4px_10px_0_rgba(0,0,0,.04)]","aspect-video",O&&i&&"shadow-[0_0_0_4px] shadow-theme-blue-500/15"),onMouseEnter:V,onMouseLeave:()=>{if(F){S.current&&clearTimeout(S.current);return}S.current=setTimeout(()=>{P(a,!1)},2e3)},children:[o&&(0,s.jsx)("div",{className:"flex p-3 justify-between dark:bg-gray-800/20 rounded-tr-xl absolute top-0 right-0 z-20",children:(0,s.jsx)("div",{className:"flex gap-4 items-center",children:[0,1].includes(null!==(l=null==r?void 0:r.evaluate)&&void 0!==l?l:-1)?(0,s.jsx)(D.pn,{delayDuration:0,children:(0,s.jsxs)(D.u,{children:[(0,s.jsx)(D.aJ,{asChild:!0,children:(0,s.jsx)(N.z,{size:"sm",variant:"secondary",className:"rounded-full w-6 h-6 p-0",children:null==r?void 0:r.evaluate})}),(0,s.jsx)(D._v,{className:"w-60",children:null==r?void 0:r.reason})]})}):null})}),(0,s.jsxs)("div",{className:"flex p-1.5 justify-between text-xs text-white  bg-gray-800/15 rounded-br-[18px] rounded-tl-[18px] absolute bottom-0 right-0 z-20 scale-80",children:[a," / ",x]}),i&&2===M&&(0,s.jsx)("div",{className:(0,k.Z)("absolute -right-8 top-1 z-30 flex gap-2 flex-col transition-opacity duration-200",R?"opacity-100":"opacity-0 pointer-events-none"),onMouseEnter:V,onMouseLeave:()=>{F||P(a,!1)},children:(0,s.jsx)(z,{page:a,messageId:u,modelType:m,onRegenerate:e=>{B(a,e)}})}),-1===M?(0,s.jsxs)("div",{className:"flex flex-col gap-5 items-center h-full justify-center",children:[(0,s.jsxs)("h3",{className:"text-xl",children:[" ",p("generateSlides.generate_failure")]}),(0,s.jsx)("div",{className:"w-full mt-4 text-center",children:(0,s.jsx)(N.z,{className:"px-6",onClick:()=>{B(a)},children:p("generateSlides.generate_retry_btn")})})]}):0===M?(0,s.jsx)("div",{className:"h-full flex flex-col px-10 py-5 overflow-hidden rounded-[18px]",children:(0,s.jsx)("div",{className:"absolute z-10 inset-0 flex w-full h-full bg-white justify-center items-center dark:bg-slate-400 rounded-[18px]",children:(0,s.jsx)(T.Z,{className:"animate-spin size-20 stroke-theme-blue-500"})})}):1===M?(0,s.jsxs)("div",{className:"flex flex-col px-10 py-5 overflow-hidden h-full",children:[(0,s.jsxs)("header",{className:"flex gap-4 items-center duration mb-5 text-[#5f7698] font-medium dark:text-slate-200",children:[(0,s.jsx)(A.Z,{iconClassName:"animate-pulse duration-500",autoIncrement:!0}),p("generateSlides.generating_slides")]}),(0,s.jsxs)("main",{className:"relative flex-1 min-h-0",children:[(0,s.jsxs)("div",{className:"relative whitespace-pre-wrap text-[#8896aa] h-full overflow-hidden",ref:f,children:[null==r?void 0:r.html,(0,s.jsx)("span",{className:"absolute pointer-events-none w-40 -ml-40 bg-gradient-to-r from-transparent to-white dark:to-gray-600",children:"\xa0"}),(0,s.jsx)("span",{className:"inline-block pointer-events-none animate-pulse",children:(0,s.jsx)(E.FZ,{className:"-mb-2 w-5 h-5 text-blue-500"})})]}),(0,s.jsx)("span",{className:"absolute pointer-events-none top-0 left-0 right-0 h-5 bg-gradient-to-t from-transparent to-white dark:to-gray-600"})]})]}):2===M?(0,s.jsxs)("div",{className:"relative h-full rounded-[18px] overflow-hidden",children:[g&&(0,s.jsx)("div",{className:"absolute z-10 inset-0 flex w-full h-full bg-white justify-center items-center dark:bg-slate-400",children:(0,s.jsx)(T.Z,{className:"animate-spin size-20 stroke-theme-blue-500"})}),(0,s.jsx)("iframe",{"data-slide-iframe":"slide-iframe-".concat(a),onClick:()=>{console.log("iframe")},className:(0,k.Z)("w-full h-full rounded-b-xl"),src:U((null==r?void 0:r.url)||""),referrerPolicy:"origin",frameBorder:"0",ref:b,style:{width:"1280px",transform:"scale(0.625)",transformOrigin:"left top",height:"720px",overflow:"hidden"},allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",sandbox:"allow-same-origin allow-scripts allow-popups allow-forms"})]}):null]})},a)});var V=l(14972),W=l(43378),Y=l(86811),J=l(14386),K=l(44342),$=l(70017),X=l(77844),Q=l(4590),ee=l(96164),et=l(26595),el=l(19073);let es=e=>{var t,l;let a=(0,u.ZP)(e=>e.isLogin),{message_id:r,is_self_message:n,shareSlidesStatus:i,setSlidesStatus:o,showSlidesModel:m}=(0,p.Z)();console.log("\uD83D\uDE80 ~ ShareSlidesBody ~ message_id:",r);let h=(0,$.V)(),[x,g]=(0,c.useState)(!1),{isApp:v}=(0,K.b)(),f=(0,u.gQ)(),b=(0,u.ZP)(e=>e.userInfo),S=null==b?void 0:null===(l=b.user_org_member)||void 0===l?void 0:null===(t=l.org_settings)||void 0===t?void 0:t.share_permission_config.personal_thread_share,k=(0,d.useTranslations)(),_=r||(0,w.s)();(0,c.useEffect)(()=>{m&&Z()},[m]);let C=e=>{(0,Q.eW)(e,"".concat(k("shareTip"),": ").concat(document.title,"\n").concat(window.location.href)),"whatsapp"===e?(0,j.fk)(y.U.SLIDES_SHARE_SHARE_WHATSAPP,{id:_},!0):"twitter"===e?(0,j.fk)(y.U.SLIDES_SHARE_SHARE_X,{id:_},!0):"facebook"===e?(0,j.fk)(y.U.SLIDES_SHARE_SHARE_FACEBOOK,{id:_},!0):"line"===e&&(0,j.fk)(y.U.SLIDES_SHARE_SHARE_LINE,{id:_},!0)},N=t=>{n&&o(t,e.modelType)},Z=()=>{g(!0);let t=X.Z.getState().current,l=new URL("".concat(location.origin,"/slides/").concat(r));e.modelType&&l.searchParams.append("modelType",e.modelType),t&&l.searchParams.append("invite",t),h.copy(l.toString()),(0,j.fk)(y.U.SLIDES_SHARE_SHARE_COPYLINK,{id:r},!0),setTimeout(()=>{g(!1)},3e3)};return(0,s.jsxs)(s.Fragment,{children:[n&&a&&(0,s.jsx)("div",{className:"w-full cursor-pointer border rounded-[12px] p-[8px] [padding-left:24px] [padding-right:24px] box-border mb-[16px] ".concat("PRIVATE"===i?"border-[#0080FF]":"border-[#E4E7EC]"),onClick:()=>N("PRIVATE"),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-[16px]",children:[(0,s.jsx)("div",{className:"w-[32px] text-[#475467] dark:text-white",children:(0,s.jsx)(J.aL,{})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-[16px] font-bold text-[#344054] dark:text-white",children:k("shareThread.secret")}),(0,s.jsx)("div",{className:"text-[12px] text-[#98A2B3]",style:{lineHeight:"18px"},children:k("shareThread.onlyAuthorCanView")})]})]}),(0,s.jsx)("div",{children:"PRIVATE"===i&&(0,s.jsx)(J.gw,{})})]})}),f&&(0,s.jsx)("div",{className:"w-full cursor-pointer border rounded-[12px] p-[8px] [padding-left:24px] [padding-right:24px] mb-[16px] box-border ".concat("PARTIAL_PUBLIC"===i?"border-[#0080FF]":"border-[#E4E7EC]"),onClick:()=>N("PARTIAL_PUBLIC"),style:{opacity:n?1:.3,cursor:n?"pointer":"not-allowed"},children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-[16px]",children:[(0,s.jsx)("div",{className:"w-[32px] text-[#475467] dark:text-white",children:(0,s.jsx)(el.Z,{size:28})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-[16px] font-bold text-[#344054] dark:text-white",children:k("shareThread.enterprise_title")}),(0,s.jsx)("div",{className:"text-[12px] text-[#98A2B3] ",style:{lineHeight:"18px"},children:k("shareThread.enterprise_desc")})]})]}),(0,s.jsx)("div",{children:"PARTIAL_PUBLIC"===i&&(0,s.jsx)(J.gw,{})})]})}),(a&&n&&!f||a&&f&&S||"PUBLIC"===i)&&(0,s.jsx)("div",{className:"w-full cursor-pointer border rounded-[12px] p-[8px] [padding-left:24px] [padding-right:24px] box-border ".concat("PUBLIC"===i?"border-[#0080FF]":"border-[#E4E7EC]"),onClick:()=>N("PUBLIC"),style:{opacity:n?1:.3,cursor:n?"pointer":"not-allowed"},children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-[16px]",children:[(0,s.jsx)("div",{className:"w-[32px] text-[#475467] dark:text-white",children:(0,s.jsx)(J.u_,{})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-[16px] font-bold text-[#344054] dark:text-white",children:k("shareThread.shareable")}),(0,s.jsx)("div",{className:"text-[12px] text-[#98A2B3] ",style:{lineHeight:"18px"},children:k("shareThread.anyoneWithLinkCanView")})]})]}),(0,s.jsx)("div",{children:"PUBLIC"===i&&(0,s.jsx)(J.gw,{})})]})}),"PRIVATE"!==i&&(0,s.jsxs)(s.Fragment,{children:[!v&&(0,s.jsxs)("div",{className:"flex items-center justify-between w-full mt-8 mb-8 mx-2 shareSites",children:[(0,s.jsxs)("div",{onClick:()=>C("line"),className:"cursor-pointer flex flex-col items-center gap-2",children:[(0,s.jsx)("img",{className:"w-[48px]",src:"/shareThreadImg/line.png",alt:""}),(0,s.jsx)("div",{className:"text-[12px] text-[#98A2B3] dark:text-white",children:"LINE"})]}),(0,s.jsxs)("div",{onClick:()=>C("twitter"),className:"cursor-pointer flex flex-col items-center gap-2",children:[(0,s.jsx)("img",{className:"w-[48px]",src:"/shareThreadImg/twiterlogo.png",alt:""}),(0,s.jsx)("div",{className:"text-[12px] text-[#98A2B3] dark:text-white",children:"X/Twitter"})]}),(0,s.jsxs)("div",{onClick:()=>C("facebook"),className:"cursor-pointer flex flex-col items-center gap-2",children:[(0,s.jsx)("img",{className:"w-[48px]",src:"/shareThreadImg/fblogo.png",alt:""}),(0,s.jsx)("div",{className:"text-[12px] text-[#98A2B3] dark:text-white",children:"Facebook"})]}),(0,s.jsxs)("div",{onClick:()=>C("whatsapp"),className:"cursor-pointer flex flex-col items-center gap-2",children:[(0,s.jsx)("img",{className:"w-[48px]",src:"/shareThreadImg/whatsapp.png",alt:""}),(0,s.jsx)("div",{className:"text-[12px] text-[#98A2B3] dark:text-white",children:"WhatsApp"})]})]}),(null==e?void 0:e.loading)?null:(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)(ee.e,{isOpen:x,content:(0,s.jsx)("div",{className:"p-2 bg-black bg-opacity-70 text-white rounded-lg dark:bg-white dark:text-black",children:k("shareThread.copySuccess")}),classNames:{content:["p-0"]},children:(0,s.jsx)(et.A,{className:"w-full h-[48px] rounded-[12px] text-[14px]",color:"primary",onClick:Z,disabled:x,children:k("shareThread.copyLink")})})})]})]})};var ea=l(20061),er=l(30674),en=()=>{let e=(0,d.useTranslations)(),t=(0,o.useRouter)();(0,w.s)()||(Array.isArray(t.query.id)?t.query.id[0]:t.query.id);let l=Array.isArray(t.query.modelType)?t.query.modelType[0]:t.query.modelType||"PRO",{showSlidesModel:a,setShowSlidesModel:r,setSlidesStatus:n,shareSlidesStatus:i,message_id:h,messageDetail:x,is_self_message:g,setSlidesDetail:v,setIsSelfSlides:f}=(0,p.Z)();(0,u.ZP)(e=>e.userInfo);let{isMobile:b}=(0,K.b)(),j=(0,u.gQ)(),[y,S]=(0,c.useState)(),[_,C]=(0,c.useState)(!1);(0,c.useEffect)(()=>{console.log("\uD83D\uDE80 ~ useEffect ~ showSlidesModel:",a),a&&N()},[a]);let N=async()=>{C(!0);let e=h||(0,w.s)();console.log("\uD83D\uDE80 ~ getShareData ~ threadId:",e);try{let a=await (0,m.VU)({business_id:e,business_type:"AGENT_THREAD",model_type:l||"PRO"}),r=null==a?void 0:a.data;if(r){var t,s;v(r),f(null==r?void 0:r.permission.is_self),n(null==r?void 0:r.permission.read_permission,l,!1);let e=null==r?void 0:null===(t=r.permission)||void 0===t?void 0:t.is_self,a=null==r?void 0:null===(s=r.permission)||void 0===s?void 0:s.is_change;e&&!a&&(j?n("PARTIAL_PUBLIC",l):n("PUBLIC",l))}C(!1)}catch(e){C(!1)}},Z=()=>{let e=h||(0,w.s)(),t=X.Z.getState().current,l=new URL("".concat(location.origin,"/page/").concat(e));t&&l.searchParams.append("invite",t),ea.toDataURL(l.toString(),{width:256,errorCorrectionLevel:"H",margin:0,color:{dark:"#0080ff00",light:"#F4F4F4FF"}}).then(e=>{S(e)}).catch(e=>{console.error(e)})};return((0,c.useEffect)(()=>{Z()},[]),b)?(0,s.jsx)(Y.yo,{open:a,onOpenChange:r,children:(0,s.jsxs)(Y.ue,{side:"bottom",className:"p-0",children:[(0,s.jsx)(Y.Tu,{className:"p-6 flex justify-between items-center",children:(0,s.jsx)(Y.bC,{className:"text-2xl",children:e("generateSlides.shareTitle")})}),(0,s.jsxs)("div",{className:"py-6 px-6",children:[_?(0,s.jsxs)("div",{className:"flex justify-center items-center ",children:[" ",(0,s.jsx)(er.c,{})," "]}):null,(0,s.jsx)("div",{className:(0,k.Z)(_?"hidden":""),children:(0,s.jsx)(es,{loading:_,modelType:l||"PRO"})})]})]})}):(0,s.jsx)(W.Vq,{open:a,onOpenChange:r,children:(0,s.jsxs)(W.cZ,{className:"max-w-[396px]","aria-describedby":void 0,children:[(0,s.jsx)(W.fK,{className:"flex justify-between items-center pb-0",children:(0,s.jsxs)(W.$N,{className:"flex items-center gap-2 text-lg w-full",children:[(0,s.jsx)("div",{className:"w-5",children:(0,s.jsx)(J.u_,{})}),e("generateSlides.shareTitle")]})}),(0,s.jsxs)("div",{className:"flex flex-col items-center w-full box-border shareContainer dark:border-[#2F333B] pb-6",style:{minHeight:g?"460px":"auto"},children:[(0,s.jsx)("div",{className:(0,k.Z)("text-[20px] font-bold mb-6 text-[#475467] overflow-hidden overflow-ellipsis line-clamp-2 dark:text-white px-6",(null==x?void 0:x.title)?"mt-8":"mt-2"),style:{wordBreak:"keep-all",lineHeight:"28px",height:(null==x?void 0:x.title)?"56px":"1px",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,overflow:"hidden",textOverflow:"ellipsis",overflowWrap:"anywhere"},children:(null==x?void 0:x.title)||""}),(0,s.jsxs)("div",{className:"px-6 w-full",children:[_?(0,s.jsx)("div",{className:"flex justify-center items-center min-h-60",children:(0,s.jsx)(er.c,{})}):null,(0,s.jsx)("div",{className:(0,k.Z)(_?"hidden":""),children:(0,s.jsx)(es,{loading:_,modelType:l||"PRO"})})]})]})]})})};let ei=e=>{let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!t)return[0,0,0];let l=parseInt(t[1],16)/255,s=parseInt(t[2],16)/255,a=parseInt(t[3],16)/255,r=Math.max(l,s,a),n=Math.min(l,s,a),i=0,d=0,o=(r+n)/2;if(r!==n){let e=r-n;switch(d=o>.5?e/(2-r-n):e/(r+n),r){case l:i=(s-a)/e+(s<a?6:0);break;case s:i=(a-l)/e+2;break;case a:i=(l-s)/e+4}i/=6}return[360*i,100*d,100*o]},ed=()=>{let e=(0,h.Z)(e=>e.wrapperBackground);return(0,c.useMemo)(()=>{if(!e||!e.length)return;let[,,t]=ei(e[0]);return t>80?"rgba(240, 240, 240, .45)":"rgba(255, 255, 255, .75)"},[e])};var eo=l(542),ec=l(37481),eu=function(e){let{className:t,value:l}=e,a=(0,d.useTranslations)();return l>=100?null:(0,s.jsxs)("div",{className:(0,ec.cn)("rounded-2xl shadow-[0_4px_40px_0_rgba(0,0,0,.25)] px-9 py-6 bg-white","dark:bg-slate-600",t),children:[(0,s.jsx)("p",{className:"font-medium text-center mb-4",children:a("generateSlides.generating_AI")}),(0,s.jsx)(eo.E,{indicatorClassName:"bg-gradient-to-br from-[#0080FF] to-[#9A4DFF]",value:l<5?5:l,className:"h-2"})]})};let em=()=>{let e=(0,h.Z)(e=>e.wrapperBackground);return(0,c.useMemo)(()=>{if(!e||!e.length)return;let[t,l,s]=ei(e[0]),a=Math.max(50,s),r="hsl(".concat((t+30)%360,", ").concat(l,"%, ").concat(a,"%)"),n="hsl(".concat(t,", ").concat(l,"%, ").concat(a,"%)"),i="hsl(".concat((t-30+360)%360,", ").concat(l,"%, ").concat(a,"%)");return"linear-gradient(130deg, ".concat(r," 0%, ").concat(n," 50%, ").concat(i," 100%)")},[e])};var eh=l(46571),ex=l(20995),ep=l(92540),eg=e=>{let{item:t,handleRating:l,ratingValue:a}=e;return(0,s.jsxs)("div",{className:(0,k.Z)("w-14 h-14  rounded-lg flex flex-col items-center justify-center text-sm border",a===t.value?"border-primary text-primary bg-primary-50 dark:bg-[#2C3F5D] dark:border-[#0080FF]":"border-white bg-white dark:bg-[#23293C] dark:border-[#23293C] hover:bg-slate-50  dark:hover:bg-slate-600",a?"cursor-default pointer-events-none":"cursor-pointer"),onClick:()=>{l(t.value===a?"":t.value)},children:[(0,s.jsx)("span",{className:"text-base",children:t.emoji}),(0,s.jsx)("p",{className:"text-xs font-medium",children:t.text})]})},ev=l(28946),ef=e=>{let{id:t,modelType:l,score:a,isFeedback:r,setIsFeedback:n,handleRetry:i}=e,o=(0,d.useTranslations)(),u=(0,_.Z)(),[h,x]=(0,c.useState)(""),[p,g]=(0,c.useState)(!1),[v,f]=(0,c.useState)(!1),[b,j]=(0,c.useState)(!1),y=async()=>{if(!h.trim()){u.default(o("feedbackSlides.feedback_required"));return}f(!0);let e=await (0,m.$Y)({business_id:t,model_type:l,score:a,content:h});f(!1),(null==e?void 0:e.code)==="OK"?(u.success(o("feedbackSlides.feedback_success")),n(!0),g(!1)):u.error(o("feedbackSlides.feedback_failure"))};return(0,s.jsxs)("div",{className:"flex flex-col my-2.5 gap-2",children:[p?(0,s.jsxs)("div",{className:"relative mt-3",children:[(0,s.jsx)(H.g,{placeholder:o("feedbackSlides.feedback_input_placeholder"),rows:6,className:(0,k.Z)("focus-visible:ring-0 focus-visible:ring-offset-0 h-28 text-xs md:text-xs","w-full p-2 border border-gray-200 rounded-md text-xs bg-slate-0","dark:bg-[#22293C] dark:border-[#22293C] hover:border-primary dark:hover:border-primary"),value:h,onChange:e=>x(e.target.value)}),(0,s.jsxs)(N.z,{className:"absolute right-1.5 bottom-1.5 text-xs px-5",onClick:y,disabled:v||r,children:[v&&(0,s.jsx)(T.Z,{className:"animate-spin size-4"}),o("feedbackSlides.feedback_btn")]})]}):null,(0,s.jsxs)("div",{className:"flex justify-between mt-3 gap-2",children:[(0,s.jsxs)(N.z,{className:(0,k.Z)("w-1/2 text-xs hover:border-primary hover:text-primary rounded-lg h-[34px] gap-1","dark:bg-[#22293C] dark:border-[#22293C]","hover:bg-primary-50 dark:hover:bg-[#22293C] dark:hover:border-[#0080FF] dark:hover:text-[#0080FF]"),variant:"outline",onClick:()=>{g(!p)},disabled:v||r,children:[(0,s.jsx)(ev.Z,{}),r?o("feedbackSlides.side_feedback_done_btn"):o("feedbackSlides.side_feedback_btn")]}),(0,s.jsxs)(N.z,{className:(0,k.Z)("w-1/2 text-xs hover:border-primary hover:text-primary rounded-lg h-[34px] gap-1","dark:bg-[#22293C] dark:border-[#22293C]","hover:bg-primary-50 dark:hover:bg-[#22293C] dark:hover:border-[#0080FF] dark:hover:text-[#0080FF]"),variant:"outline",onClick:()=>{j(!0),i(!0)},disabled:b,children:[(0,s.jsx)(P.Z,{}),o("feedbackSlides.side_retry_btn")]})]})]})},eb=e=>{let{id:t,modelType:l,handleRetry:a,business_type:r,feedbackType:n}=e,i=(0,d.useTranslations)(),o=(0,_.Z)(),u=[{emoji:"\uD83D\uDE29",text:i("feedbackSlides.terrible"),value:"TERRIBLE"},{emoji:"\uD83D\uDE41",text:i("feedbackSlides.poor"),value:"BAD"},{emoji:"\uD83D\uDE10",text:i("feedbackSlides.neutral"),value:"AVERAGE"},{emoji:"\uD83D\uDE0A",text:i("feedbackSlides.good"),value:"GOOD"},{emoji:"\uD83E\uDD29",text:i("feedbackSlides.excellent"),value:"AMAZING"}],[h,x]=(0,c.useState)(""),[p,g]=(0,c.useState)(!1),[v,f]=(0,c.useState)(!1),b=(0,c.useMemo)(()=>["TERRIBLE","BAD"].includes(h),[h]),j=async e=>{if(e){if(x(e),["TERRIBLE","BAD"].includes(e)){g(!0);return}try{"webpage"===n?await (0,m.nD)({business_id:t,business_type:r||"MESSAGE",score:e}):await (0,m.$Y)({business_id:t,model_type:l,score:e}),o.success(i("feedbackSlides.feedback_success"))}catch(e){o.error(i("feedbackSlides.feedback_fail"))}f(!0)}};return(0,s.jsxs)("div",{className:(0,k.Z)("bg-slate-100 rounded-xl p-4",v?"dark:bg-[#30394B]/40":"dark:bg-[#30394B]"),children:[(0,s.jsx)("div",{className:(0,k.Z)("mb-5",v&&"opacity-40"),children:v?i("feedbackSlides.feedback_good_title"):b?i("feedbackSlides.feedback_bad_title"):i("feedbackSlides.feedback_side_title")}),(0,s.jsx)("div",{className:(0,k.Z)("flex gap-2  rounded-lg",v&&"opacity-40"),children:u.map((e,t)=>(0,s.jsx)(eg,{item:e,handleRating:j,ratingValue:h},t))}),p?(0,s.jsx)(ef,{id:t,modelType:l,score:h,setIsFeedback:f,isFeedback:v,handleRetry:a}):null]})},ej=l(91165),ey=l(8521),ew=l(8289),eS=l(39071),ek=l(34379),e_=l(71691),eC=l(78434),eN=l(57207),eZ=l(72070),eE=l.n(eZ);let eF=[{name:"generateSlides.mental_model.swot",value:"SWOT",image:"/resources/slides/swot.webp",desc:"generateSlides.mental_model.swot_desc",example:"generateSlides.mental_model.swot_example"},{name:"generateSlides.mental_model.smart",value:"SMART",image:"/resources/slides/smart.webp",desc:"generateSlides.mental_model.smart_desc",example:"generateSlides.mental_model.smart_example"},{name:"generateSlides.mental_model.5w2h",value:"FIVE_W_TWO_H",image:"/resources/slides/5w2h.webp",desc:"generateSlides.mental_model.5w2h_desc",example:"generateSlides.mental_model.5w2h_example"}];var eT=function(e){let{slideTitle:t,title:l,description:s,onStart:a,onSuccess:r,onCancel:n,onError:i}=e,d=(0,c.useRef)(),[o,u]=(0,c.useState)();return{selectedMentalModel:o,handleSelectMentalModel:e=>{d.current&&d.current.abort(),d.current=new AbortController,u(e),null==a||a(),(0,m.Vs)({model_type:e,title:l,description:s,slide_title:t,signal:d.current.signal}).then(async t=>{if(200===t.status){let l={title:t.data.title,theme:t.data.description,model_type:e};null==r||r(l)}else 404===t.status?(u(void 0),null==i||i("not_suitable")):(u(void 0),null==i||i())}).catch(e=>{"AbortError"!==e.name&&(console.error("Error: ",e),u(void 0),null==i||i())})},resetSelection:()=>{d.current&&d.current.abort(),u(void 0),null==n||n()}}},eI=function(e){let{children:t,selectedMentalModel:l,onSelectMentalModel:a}=e,r=(0,d.useTranslations)();return(0,s.jsxs)(eN.J2,{children:[(0,s.jsx)(eN.xo,{asChild:!0,children:t}),(0,s.jsx)(eN.yk,{className:"w-[488px] rounded-2xl border-[#D3D9E4] dark:border-[#606B80] select-none",align:"start",children:(0,s.jsx)("div",{className:"grid gap-3",children:(0,s.jsxs)(D.pn,{disableHoverableContent:!0,delayDuration:0,children:[(0,s.jsx)("h4",{className:"text-sm text-[#5F7698] dark:text-[#D0D4DC] font-medium",children:r("generateSlides.mental_model.use_mental_model")}),(0,s.jsx)("div",{className:"space-y-2",children:eF.map(e=>(0,s.jsxs)("div",{className:(0,eh.cn)("flex items-center gap-3 relative overflow-hidden","border border-transparent rounded-lg p-2 cursor-pointer",l===e.value&&"border-theme-blue-500 bg-theme-blue-50 dark:bg-[#25364D]/80"),onClick:()=>a(e.value),children:[l===e.value&&(0,s.jsx)(ej.Z,{className:"absolute top-0 right-0 p-1 rounded-bl-lg text-white bg-theme-blue-500"}),(0,s.jsx)("div",{className:"flex-shrink-0 w-[150px] h-[85px] rounded border border-[#E6E9EF] bg-[#E6E9EF]/20",children:(0,s.jsx)(eE(),{src:e.image,alt:e.name,width:150,height:85})}),(0,s.jsxs)(D.u,{children:[(0,s.jsx)(D.aJ,{asChild:!0,children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-bold mb-0.5",children:r(e.name)}),(0,s.jsx)("p",{className:"text-sm text-[#30394A] dark:text-inherit line-clamp-3",children:r(e.desc)})]})}),(0,s.jsxs)(D._v,{side:"bottom",className:"rounded-2xl p-4 max-w-xs pointer-events-none",children:[(0,s.jsx)("p",{className:"font-bold mb-2",children:r(e.name)}),(0,s.jsx)("p",{className:"text-sm",children:r(e.desc)})]})]})]},e.value))})]})})})]})},eA=l(50656),eD=function(e){let{selectedMentalModel:t,onSelectMentalModel:l}=e,a=(0,d.useTranslations)();return(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("h4",{className:"flex items-center gap-1 text-sm mb-3",children:[(0,s.jsx)(ew.Z,{className:"w-4 h-4"}),a("generateSlides.mental_model.choose_template")]}),(0,s.jsx)("div",{className:"flex gap-2",children:eF.map(e=>(0,s.jsxs)("div",{className:(0,eh.cn)("relative text-xs text-center","border border-transparent rounded-lg cursor-pointer",t===e.value&&"text-theme-blue-500"),onClick:()=>{l(e.value,a.raw(e.example).replaceAll("<b>","").replaceAll("</b>",""))},children:[(0,s.jsx)("div",{className:(0,eh.cn)("overflow-hidden w-20 h-11 mb-1 rounded","border border-[#E6E9EF] bg-[#E6E9EF]/20",t===e.value&&"font-bold border-theme-blue-500"),children:(0,s.jsx)(eE(),{src:e.image,alt:e.name,width:120,height:68})}),(0,s.jsx)("p",{children:a(e.name)})]},e.value))})]})},eR=l(75307),eP=l(3295),eL=e=>{let{id:t,page:l,title:a,theme:r,mental_model:n,onAdd:i,editable:o=!1,onTitleChange:u,onThemeChange:m,onDelete:x,onMentalModelChange:p,canUseMentalModel:g,isDeletable:v=!0,mentalModelTipsVisible:f}=e,b=(0,d.useTranslations)(),j=(0,_.Z)(),y=eP.Z.getState().setSlidesMentalModelFirstShow,[w,S]=(0,c.useState)(t.includes("new")),[C,N]=(0,c.useState)(a),[Z,E]=(0,c.useState)(r),[F,T]=(0,c.useState)(!1),[I,A]=(0,c.useState)(t.includes("new")),R=(0,c.useRef)({title:a,theme:r,mental_model:n}),[P,L]=(0,c.useState)(!1),O=(0,c.useRef)(null),{selectedMentalModel:B,handleSelectMentalModel:z,resetSelection:q}=eT({slideTitle:(0,h.Z)(e=>e.title||""),title:C,description:Z,onStart:()=>T(!0),onSuccess:e=>{T(!1),(e.title||e.theme)&&(R.current={title:C,theme:Z,mental_model:e.model_type},e.title&&N(e.title),e.theme&&E(e.theme),L(!0))},onCancel:()=>{T(!1)},onError:e=>{"not_suitable"===e?j.error(b("generateSlides.not_suitable_error")):j.error(b("generateSlides.network_error")),T(!1)}});(0,c.useEffect)(()=>{N(a),R.current.title=a},[a]),(0,c.useEffect)(()=>{E(r),R.current.theme=r},[r]);let{attributes:U,listeners:G,setNodeRef:V,transform:W,transition:Y,isDragging:J}=(0,e_.nB)({id:t}),K={transform:eC.ux.Transform.toString(W),transition:Y},$=()=>{O.current&&clearTimeout(O.current),O.current=setTimeout(()=>{O.current=null,""!==C&&""!==Z&&S(!1)},100)},X=()=>{O.current&&(clearTimeout(O.current),O.current=null),S(!0)};(0,c.useEffect)(()=>()=>{O.current&&clearTimeout(O.current)},[]);let Q=()=>{let e=C.length>200?C.slice(0,200):C;N(e),u&&e!==a&&u(e),$()},ee=e=>{N(e.target.value)},et=()=>{h.Z.getState().updateSlidesPlanItemPartial(l,{mental_model:void 0}),q()},el=()=>{u&&C!==R.current.title&&u(C),m&&Z!==R.current.theme&&m(Z),R.current.mental_model&&(null==p||p(R.current.mental_model)),R.current={title:C,theme:Z,mental_model:R.current.mental_model},L(!1)},es=()=>{N(R.current.title),E(R.current.theme),L(!1),q()};return(0,s.jsxs)("div",{ref:V,style:K,className:(0,k.Z)("relative w-full group transition-all duration-200",J&&"opacity-50 z-50 scale-105 shadow-lg"),children:[(0,s.jsxs)("div",{className:(0,k.Z)("rounded-[12px] relative bg-[#F7F9FE] border border-[#E6F3FF] w-full p-4 text-[#4B5F7E] text-[16px]","dark:bg-[#313747] dark:border-[#474E5C] dark:text-white","transition-all duration-200",J&&"border-[#0080FF] shadow-lg"),children:[(0,s.jsxs)("div",{className:"flex gap-[10px]",children:[(0,s.jsxs)("div",{className:"flex items-center flex-col gap-2",children:[(0,s.jsx)("div",{className:(0,k.Z)("p-[10px] w-[30px] h-[30px] rounded-[8px] flex items-center justify-center bg-[#D7E1F9] font-bold text-[#4B5F7E]","dark:bg-[#465579] dark:text-white"),children:l}),o&&!F&&(0,s.jsx)("div",{className:"drag-handle cursor-move select-none",...U,...G,children:(0,s.jsx)("div",{className:(0,k.Z)("w-[24px] h-[24px] rounded-[6px] flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"),children:(0,s.jsx)(ey.Z,{className:"w-[18px] text-[#4B5F7E] dark:text-white"})})})]}),(0,s.jsxs)("div",{className:"flex-1 text-[16px]",children:[(()=>{var e;if(F)return(0,s.jsx)(eA.Z,{className:"h-8 rounded-lg mb-2"});let t=null===(e=eF.find(e=>e.value===n))||void 0===e?void 0:e.name,l=P?(0,s.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,s.jsxs)("button",{onClick:el,className:"flex items-center gap-1 px-3 py-1.5 bg-[#0080FF] text-white rounded-md hover:bg-[#0066CC] transition-colors text-sm",children:[(0,s.jsx)(ej.Z,{className:"w-4 h-4"}),b("apply")]}),(0,s.jsxs)("button",{onClick:es,className:"flex items-center gap-1 px-3 py-1.5 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors text-sm dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500",children:[(0,s.jsx)(M.Z,{className:"w-4 h-4"}),b("cancel")]})]}):n?(0,s.jsxs)(eR.C,{variant:"outline",className:(0,eh.cn)("ml-auto bg-[#E6F3FF] dark:bg-[#243347] border-[#CBE9FF] dark:border-[#0694FF]/20","text-theme-blue-500 dark:text-[#83E2FF]","rounded-[4px] px-2 py-1 whitespace-nowrap group/badge"),children:[b(t),(0,s.jsx)(M.Z,{className:"ml-2 w-4 h-4 cursor-pointer group-hover/badge:block hidden",onClick:et})]}):void 0;return o&&w?(0,s.jsxs)("div",{className:"flex gap-2 items-center mb-1",children:[(0,s.jsx)(H.g,{autoFocus:!0,className:(0,k.Z)("font-bold min-h-[30px] resize-none flex-1",C.length>200&&"border-red-500 focus:border-red-500"),value:C,placeholder:b("editSlides.new_title"),onChange:ee,onBlur:Q,onFocus:e=>{X();let t=e.target;setTimeout(()=>{t.setSelectionRange(t.value.length,t.value.length)},0)}}),l]}):(0,s.jsxs)("div",{className:"flex gap-2 items-center mb-1",children:[(0,s.jsx)("div",{className:(0,k.Z)("font-bold hover:text-[#0080FF] transition-colors break-all",o&&"cursor-text min-h-[30px] flex-1"),onClick:o?()=>S(!0):void 0,children:C}),l]})})(),F?(0,s.jsx)(eA.Z,{className:"h-20 rounded-lg"}):o&&w?(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)(H.g,{className:(0,k.Z)("leading-7 min-h-[28px] resize-none pr-20",Z.length>2e3&&"border-red-500 focus:border-red-500"),value:Z,placeholder:b("editSlides.new_description"),onChange:e=>{E(e.target.value)},onBlur:()=>{let e=Z.length>2e3?Z.slice(0,2e3):Z;E(e),m&&e!==r&&m(e),e.trim()&&I&&A(!1),$()},onFocus:e=>{X();let t=e.target;setTimeout(()=>{t.setSelectionRange(t.value.length,t.value.length)},0)}})}):(0,s.jsx)("div",{className:(0,k.Z)("leading-7 hover:text-[#0080FF] transition-colors",o&&"cursor-text"),onClick:o?()=>S(!0):void 0,children:Z}),I&&(0,s.jsx)(eD,{selectedMentalModel:n,onSelectMentalModel:(e,t)=>{h.Z.getState().updateSlidesPlanItemPartial(l,{mental_model:e}),E(t),null==m||m(t)}})]})]}),o&&v&&(0,s.jsxs)("div",{className:(0,eh.cn)("absolute top-0 bottom-0 -right-7","w-5 flex flex-col items-center justify-center gap-4","opacity-0 group-hover:opacity-100 transition-opacity"),children:[!I&&g&&(0,s.jsx)(eI,{selectedMentalModel:B,onSelectMentalModel:e=>{B===e?P?es():et():z(e)},children:(0,s.jsx)("div",{children:(0,s.jsx)(D.pn,{children:(0,s.jsxs)(D.u,{delayDuration:0,open:f,children:[(0,s.jsx)(D.aJ,{asChild:!0,children:(0,s.jsx)("button",{className:"hover:text-red-500",onClick:()=>y(!1),children:(0,s.jsx)(ew.Z,{className:"w-5 h-5"})})}),(0,s.jsxs)(D._v,{align:"start",className:"px-3 py-2 text-white bg-gradient-to-br from-[#0080ff] to-[#9a4dff] rounded-md border-none",sideOffset:5,children:[b("generateSlides.mental_model.try_mental_model"),(0,s.jsx)(D.Ce,{className:"fill-[#0080ff]"})]})]})})})}),(0,s.jsx)("button",{className:"hover:text-red-500",onClick:x,children:(0,s.jsx)(eS.Z,{className:"w-5 h-5"})})]})]}),(0,s.jsx)("div",{className:"w-full flex items-center justify-center text-[#0080FF] transition-opacity opacity-0 hover:opacity-100",children:o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex-1 h-[2px] bg-[#0080FF]"}),(0,s.jsx)(ek.Z,{className:"w-[20px] h-[20px] text-[#0080FF] cursor-pointer",onClick:i}),(0,s.jsx)("div",{className:"flex-1 h-[2px] bg-[#0080FF]"})]}):(0,s.jsx)("div",{className:"h-[24px]"})})]})},eO=l(64155),eM=l(43183),eH=l(85724),eB=e=>{let{status:t,onRetry:l,onGenerateSlides:a,generateSlides:r,addGeneratePlanNotice:n}=e,i=(0,d.useTranslations)(),o=(0,_.Z)(),u=(0,c.useRef)(null),m=(0,eP.Z)(e=>e.slidesMentalModelFirstShow),x=(0,h.Z)(e=>e.slidesPlan),p=(0,h.Z)(e=>e.setSlidesPlan),g=(0,c.useRef)(null),v=(0,c.useRef)(null),[f,b]=(0,c.useState)(null),[j,y]=(0,c.useState)(!1),w=(0,eM.Dy)((0,eM.VT)(eM.we,{activationConstraint:{distance:8}}),(0,eM.VT)(eM.Lg,{coordinateGetter:e_.is}));(0,eM.Ai)({styles:{active:{opacity:"0.5"}}}),(0,c.useEffect)(()=>{if("getOutlineSuccess"===t&&x.length>0&&n(x.length),"getOutlineSuccess"===t&&!g.current&&x&&x.length>0){let e=h.Z.getState().initialSlidesPlan;v.current=e;let t=x.map(e=>({...e,id:e.id||(0,eO.Z)()}));g.current=t,x.some(e=>!e.id)&&h.Z.getState().setSlidesPlan(t)}},[t,x]),(0,c.useEffect)(()=>{u.current&&u.current.scrollTo({top:u.current.scrollHeight,behavior:"smooth"})},[x]);let S=e=>{p([...x.filter(t=>t.page!==e).map((e,t)=>({...e,page:t+1}))])},C=e=>{let t={id:"new-".concat((0,eO.Z)()),page:0,title:"",theme:"",content:"",status:0};p([...x.slice(0,e+1),t,...x.slice(e+1)].map((e,t)=>({...e,page:t+1,id:e.id||(0,eO.Z)()})))},Z=(e,t)=>{h.Z.getState().updateSlidesPlanItemPartial(e,{title:t})},F=(e,t)=>{h.Z.getState().updateSlidesPlanItemPartial(e,{theme:t})},I=(e,t)=>{h.Z.getState().updateSlidesPlanItemPartial(e,{content:"",mental_model:t})},A=f?x.find(e=>e.id===f):null,D="getOutline"!==t,R="failed"===t;return(0,s.jsx)("div",{ref:u,className:(0,k.Z)("relative rounded-3xl py-12  bg-white dark:bg-[#474F5C]   h-[calc(100dvh-160px)]","mx-auto space-y-1 z-10 max-w-[800px]","dark:bg-[#474F5C]",(null==x?void 0:x.length)>0||R?"gap-2 justify-start":"justify-start gap-4"),children:(null==x?void 0:x.length)>0?(0,s.jsxs)(s.Fragment,{children:[D?(0,s.jsxs)(eM.LB,{sensors:w,collisionDetection:eM.Xo,onDragStart:e=>{b(e.active.id)},onDragEnd:e=>{let{active:t,over:l}=e;if(b(null),!l||t.id===l.id)return;let s=x.findIndex(e=>e.id===t.id),a=x.findIndex(e=>e.id===l.id);if(-1===s||-1===a)return;let r=[...x],[n]=r.splice(s,1);r.splice(a,0,n),p(r.map((e,t)=>({...e,page:t+1})))},children:[(0,s.jsx)("div",{className:"flex px-12 flex-col items-start h-[calc(100dvh-300px)]  overflow-hidden overflow-y-auto custom-scrollbar",children:(0,s.jsx)(e_.Fo,{items:x.map(e=>e.id||""),strategy:e_.qw,children:x.map((e,t)=>(0,s.jsx)(eL,{mentalModelTipsVisible:m,...e,id:e.id||"",editable:D,isDeletable:x.length>1,onDelete:()=>S(e.page),onAdd:()=>C(t),onTitleChange:t=>Z(e.page,t),onThemeChange:t=>F(e.page,t),onMentalModelChange:t=>I(e.page,t),canUseMentalModel:t>0},e.id||t))})}),(0,s.jsx)(eM.y9,{dropAnimation:null,children:A&&(0,s.jsx)("div",{className:"opacity-90",children:(0,s.jsx)(eL,{...A,id:A.id||"",editable:!1,onDelete:()=>{},onAdd:()=>{},onTitleChange:()=>{},onThemeChange:()=>{}})})})]}):(0,s.jsx)("div",{className:"flex px-12 flex-col items-start h-[calc(100dvh-300px)]  overflow-hidden overflow-y-auto custom-scrollbar",children:x.map((e,t)=>(0,s.jsx)(eL,{...e,id:e.id||"",editable:D,onDelete:()=>{},onAdd:()=>{},onTitleChange:()=>{},onThemeChange:()=>{}},e.id||e.page+e.title))}),(null==x?void 0:x.length)>0&&"getOutlineSuccess"===t&&(0,s.jsx)("div",{className:"absolute bottom-8 right-[50px] flex items-center gap-4",children:(0,s.jsxs)(N.z,{className:"flex cursor-pointer items-center justify-center gap-2 min-w-[188px] h-12 px-6 bg-[#0080FF] text-white rounded-xl text-base font-medium shadow-lg hover:bg-[#0066cc] hover:shadow-xl transition-all duration-200 border-0",onClick:()=>{if(!g.current||!v.current)return;let e=x.find(e=>{var t,l;return!(null===(t=e.title)||void 0===t?void 0:t.trim())||!(null===(l=e.theme)||void 0===l?void 0:l.trim())});if(e){o.error(i("generateSlides.missing_title_or_description",{page:e.page}));return}y(!0);let t=!1;if(x.length!==g.current.length)t=!0;else{let e=new Map(g.current.map(e=>[e.id,e]));for(let l=0;l<x.length;l++){let s=x[l];if(s.id.startsWith("new-")){t=!0;break}let a=e.get(s.id);if(!a||s.id!==g.current[l].id||s.title!==a.title||s.theme!==a.theme){t=!0;break}}}a({hasChange:t,oldPlan:g.current,newPlan:x})},disabled:j,children:[j?(0,s.jsx)(T.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[(0,s.jsx)("path",{d:"M7.29892 19.1663H12.7011C13.3719 19.1663 13.9255 19.1664 14.3765 19.1295C14.8449 19.0912 15.2755 19.0091 15.68 18.803C16.3072 18.4834 16.8171 17.9735 17.1367 17.3463C17.3428 16.9419 17.4249 16.5113 17.4632 16.0429C17.5 15.5919 17.5 15.0382 17.5 14.3674V11.2497C17.5 10.7894 17.1269 10.4163 16.6667 10.4163C16.2064 10.4163 15.8333 10.7894 15.8333 11.2497V14.333C15.8333 15.0468 15.8327 15.5321 15.802 15.9071C15.7722 16.2725 15.7181 16.4593 15.6517 16.5897C15.4919 16.9033 15.2369 17.1582 14.9233 17.318C14.793 17.3844 14.6061 17.4385 14.2408 17.4684C13.8657 17.499 13.3805 17.4997 12.6667 17.4997H7.33333C6.61952 17.4997 6.13427 17.499 5.7592 17.4684C5.39385 17.4385 5.20702 17.3844 5.07668 17.318C4.76308 17.1582 4.50811 16.9033 4.34832 16.5897C4.28192 16.4593 4.22781 16.2725 4.19796 15.9071C4.16732 15.5321 4.16667 15.0468 4.16667 14.333V5.66634C4.16667 4.95252 4.16732 4.46728 4.19796 4.09221C4.22781 3.72686 4.28192 3.54002 4.34832 3.40969C4.50811 3.09609 4.76308 2.84112 5.07668 2.68133C5.20702 2.61492 5.39385 2.56082 5.7592 2.53097C6.13427 2.50032 6.61952 2.49967 7.33333 2.49967H9.58333C10.0436 2.49967 10.4167 2.12658 10.4167 1.66634C10.4167 1.2061 10.0436 0.833008 9.58333 0.833008H7.2989C6.6281 0.832997 6.07447 0.832989 5.62348 0.869836C5.15507 0.908107 4.72448 0.990244 4.32003 1.19632C3.69283 1.5159 3.18289 2.02583 2.86331 2.65304C2.65724 3.05749 2.5751 3.48807 2.53683 3.95649C2.49998 4.40748 2.49999 4.96111 2.5 5.63191V14.3674C2.49999 15.0382 2.49998 15.5919 2.53683 16.0429C2.5751 16.5113 2.65724 16.9419 2.86331 17.3463C3.18289 17.9735 3.69283 18.4834 4.32003 18.803C4.72448 19.0091 5.15507 19.0912 5.62348 19.1295C6.07446 19.1664 6.62815 19.1663 7.29892 19.1663Z",fill:"currentColor"}),(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.0051 12.0955H8.60842V14.2265C8.60842 14.5312 8.53653 14.7622 8.39275 14.9197C8.24897 15.0772 8.06754 15.1559 7.84844 15.1559C7.61908 15.1559 7.43422 15.0789 7.29387 14.9248C7.15351 14.7674 7.08333 14.538 7.08333 14.2368V8.43424C7.08333 8.09875 7.16036 7.85912 7.31441 7.71534C7.46846 7.57156 7.71322 7.49967 8.04871 7.49967H10.0051C10.5837 7.49967 11.0287 7.54418 11.3402 7.63318C11.6483 7.71877 11.9136 7.86083 12.1362 8.05939C12.3621 8.25794 12.5333 8.50099 12.6496 8.78855C12.766 9.07611 12.8242 9.39961 12.8242 9.75906C12.8242 10.5259 12.588 11.1079 12.1156 11.505C11.6432 11.8986 10.9397 12.0955 10.0051 12.0955ZM9.63542 8.64477H8.60842V10.9452H9.63542C9.99486 10.9452 10.2944 10.9076 10.534 10.8323C10.7771 10.757 10.962 10.6337 11.0886 10.4626C11.2153 10.2914 11.2786 10.0672 11.2786 9.78987C11.2786 9.45781 11.181 9.18737 10.9859 8.97855C10.7668 8.75603 10.3167 8.64477 9.63542 8.64477Z",fill:"currentColor"}),(0,s.jsx)("path",{d:"M14.9977 9.16621C14.8715 9.16621 14.7608 9.12336 14.6655 9.03766V9.03647C14.5727 8.94997 14.5151 8.84087 14.4929 8.70914C14.4024 8.2005 14.3112 7.7724 14.2191 7.42484C14.127 7.08204 14.0132 6.80114 13.8774 6.58213C13.7449 6.36391 13.5715 6.18894 13.3572 6.05722C13.1413 5.92549 12.8668 5.81996 12.5334 5.74061C12.2033 5.66046 11.7918 5.58428 11.2989 5.51207C11.164 5.49224 11.0517 5.43431 10.962 5.33829C10.8763 5.24307 10.8335 5.1292 10.8335 4.99669C10.832 4.93376 10.843 4.87117 10.8659 4.81253C10.8888 4.7539 10.9231 4.70038 10.9668 4.65508C11.0537 4.55686 11.1744 4.49485 11.3049 4.4813C11.7977 4.42496 12.212 4.3587 12.5477 4.28252C12.8401 4.22272 13.1212 4.1175 13.381 3.97067C13.598 3.83677 13.78 3.65317 13.912 3.43505C14.0681 3.16859 14.1817 2.87947 14.2489 2.57805C14.3495 2.15231 14.4306 1.72217 14.4917 1.28899C14.5066 1.16301 14.5666 1.04671 14.6608 0.961666C14.7516 0.876607 14.8721 0.830466 14.9965 0.833117C15.1201 0.831089 15.2396 0.877187 15.3298 0.961666C15.4266 1.04587 15.49 1.16202 15.5084 1.28899C15.598 1.79843 15.6873 2.22653 15.7762 2.57329C15.8496 2.86897 15.9646 3.15271 16.1179 3.41601C16.2491 3.62982 16.429 3.80967 16.6429 3.94092C16.8976 4.08791 17.1734 4.1947 17.4607 4.25753C17.7956 4.33767 18.2071 4.41226 18.6952 4.4813C18.8254 4.49927 18.9451 4.56248 19.0333 4.65984C19.1204 4.75017 19.1683 4.87122 19.1666 4.99669C19.1684 5.12724 19.12 5.2535 19.0314 5.34941C18.9428 5.44532 18.8207 5.50354 18.6904 5.51207C18.2737 5.55603 17.8599 5.62439 17.4512 5.7168C17.1147 5.79298 16.8353 5.89693 16.6131 6.02865C16.3948 6.16037 16.2183 6.33892 16.0834 6.56427C15.9306 6.83182 15.8186 7.12067 15.7512 7.42127C15.6655 7.77121 15.5846 8.2009 15.5084 8.71033C15.4912 8.83664 15.4296 8.9527 15.3346 9.03766C15.2435 9.12301 15.1225 9.16917 14.9977 9.16621Z",fill:"currentColor"})]}),(0,s.jsx)("span",{children:j?i("step.tool.generating"):i("step.tool.confirmGenerate")})]})})]}):(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"px-12 gap-4 flex flex-col justify-center",children:[" ",(0,s.jsxs)("div",{className:(0,k.Z)("text-base font-bold text-[#4B5F7E] flex items-center gap-2 dark:text-slate-50 mb-4",R?"":"animate-pulse"),children:[(0,s.jsx)(E.GK,{className:(0,k.Z)("size-4")}),R?i("generateSlides.plan_generated_failure"):i("generateSlides.plan_loading_title")]}),R?(0,s.jsx)("div",{className:"flex ",children:(0,s.jsxs)(N.z,{type:"button",variant:"outline",className:"min-w-[160px] ml-4 h-10 flex items-center gap-2 border-[#0080FF] text-[#0080FF] hover:bg-[#0080FF] hover:text-white transition-all duration-200",onClick:l,children:[(0,s.jsx)(eH.Z,{})," ",i("editSlides.regenerate")]})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eA.Z,{className:"h-20 w-1/2 "}),(0,s.jsx)(eA.Z,{className:"h-20 w-11/12 "}),(0,s.jsx)(eA.Z,{className:"h-20 w-full"})]})]})})})},ez=l(50342),eq=e=>{let{handleRetry:t}=e,l=(0,d.useTranslations)(),[a,r]=(0,c.useState)(!1);return(0,s.jsxs)("div",{className:"bg-slate-100 rounded-lg p-4 dark:bg-[#31374B]",children:[(0,s.jsx)("div",{className:"mb-5",children:l("generateSlides.plan_generated_failure_chat")}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)(N.z,{className:(0,k.Z)("w-1/2 text-xs hover:border-primary hover:text-primary rounded-lg h-[34px] gap-1","dark:bg-[#22293C] dark:border-[#22293C]","hover:bg-primary-50 dark:hover:bg-[#22293C] dark:hover:border-[#0080FF] dark:hover:text-[#0080FF]"),variant:"outline",onClick:()=>{t(!0),r(!0)},disabled:a,children:[(0,s.jsx)(P.Z,{}),l("feedbackSlides.side_retry_btn")]})})]})},eU=l(41223),eG=l(78017),eV=l(84706),eW=l(33451),eY=!0,eJ=e=>{var t,l,a,m,x,g,v,f,b,k,_;let{detail:C,url:N,id:Z,modelType:E}=e,F=(0,h.Z)(e=>e.title),[T,I]=(0,c.useState)(Z),A=(0,d.useTranslations)(),D=(0,d.useLocale)(),R=(0,o.useRouter)(),{updateChatList:P}=h.Z.getState(),L=(0,h.Z)(e=>e.htmlList);console.log("\uD83D\uDE80 ~ htmlList:",L);let O=(0,u.ZP)(e=>e.isLogin),M=(0,c.useRef)([]),{status:H,init:B,generateSlide:z,setStatus:U,editSlideHtml:W,updateMessageId:Y,generateSlides:J,addGeneratePlanNotice:K}=S({onUpdateTitle:e=>{h.Z.getState().setTitle(e)},onGenerateSucceed:()=>{console.log("onGenerateSucceed",h.Z.getState().htmlList),(0,j.fk)(y.U.CREATE_SLIDES_PPT_SUCCESS,{value:"create_slides_ppt_success"},!0),h.Z.getState().htmlList.filter(e=>(null==e?void 0:e.status)===2).length>0&&eW.Z.getState().getPointsByDeductionItem("SLIDES_ADVANCED");let e=h.Z.getState().htmlList.some(e=>(null==e?void 0:e.status)!==2);console.log("\uD83D\uDE80 ~ hasNoSuccess:",e),e||P({role:"system",content:(0,s.jsx)(eb,{id:T,modelType:E,handleRetry:eo}),id:Date.now().toString(),type:"feedback"})},modelType:E,ssrDetail:C}),{executeUndo:$,executeRedo:X}=(0,q.Z)(),Q=(0,c.useCallback)(e=>{if(!et)return;let t=/Mac|iPod|iPhone|iPad/.test(window.navigator.platform),l=e.key.toLowerCase(),s=e.shiftKey,a=!1,r=!1;if(("Delete"===e.key||46===e.keyCode)&&e.preventDefault(),t){let t=e.metaKey;a=t&&!s&&"z"===l,r=t&&s&&"z"===l||t&&"y"===l}else{let t=e.ctrlKey;a=t&&!s&&"z"===l,r=t&&("y"===l||s&&"z"===l)}(a||r)&&(e.preventDefault(),e.stopPropagation(),a?$():X())},[$,X]);(0,c.useEffect)(()=>(window.addEventListener("keydown",Q,!0),()=>{window.removeEventListener("keydown",Q,!0)}),[Q]);let ee=(0,h.Z)(e=>!!e.sidebarType),et=(0,c.useMemo)(()=>{var e,t;let l=null==C?void 0:null===(t=C.data)||void 0===t?void 0:null===(e=t.permission)||void 0===e?void 0:e.is_self;return!0===l||void 0===l},[C]),el=(0,c.useMemo)(()=>{var e,t;return void 0===(null==C?void 0:null===(t=C.data)||void 0===t?void 0:null===(e=t.permission)||void 0===e?void 0:e.is_self)},[C]);(0,c.useEffect)(()=>{!(0,eU.s2)()&&el&&h.Z.getState().setSidebarType("thread")},[el]);let es=em(),ea=ed(),er=(0,c.useMemo)(()=>{let e=L.length,t=L.filter(e=>(null==e?void 0:e.status)===2).length;return 0===t?0:t/e*100},[L]),ei=(0,w.s)()||(Array.isArray(R.query.id)?R.query.id[0]:R.query.id),eo=async e=>{ei&&(U("init"),B({detail:C,isRetry:e}))},ec=async e=>{if(!e)return;h.Z.getState().updateHtmlItem(e,{status:0});let t=await z(e),l=null==t?void 0:t.page;if((null==t?void 0:t.code)===402){h.Z.getState().updateHtmlItem(l,{status:2,code:null==t?void 0:t.code});return}(null==t?void 0:t.success)||!l||h.Z.getState().updateHtmlItem(l,{status:-1,code:null==t?void 0:t.code})},eg=async e=>{let{html:t,element_id:l,ai_input:s,page:a}=e;if(!a||!t||!l||!s)return;let r=M.current[a-1];r&&r.setInited(!1),await W({html:t,element_id:l,ai_input:s,page:a})},ev=async e=>{I(e),Y(e),p.Z.getState().setSortSlidesId(e),B({retryOutline:!0})},ef=async e=>{eV.$.publish("pptActionCreatePpt",e)},ej=async()=>{var e,t;J({plan:{...(null===(t=h.Z.getState().initialSSRDetail)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.plan)||{},slides:h.Z.getState().slidesPlan}})};(0,c.useEffect)(()=>{if(void 0===O||!ei)return;let{setTitle:e,setInitialSSRDetail:t}=h.Z.getState();if(C){var l,s;if(404===C.status&&ei!==eG.yw){B({retryOutline:!0});return}e(null==C?void 0:null===(l=C.data)||void 0===l?void 0:l.title),t(C),p.Z.getState().setSortSlidesId(null==C?void 0:null===(s=C.data)||void 0===s?void 0:s.business_id),B({detail:C})}else e(void 0),t(void 0)},[O,C]),(0,c.useEffect)(()=>{"failed"===H&&P({role:"system",content:(0,s.jsx)(eq,{handleRetry:eo}),type:"feedback"})},[H]);let ey=(null==C?void 0:null===(t=C.data)||void 0===t?void 0:t.title)||F?"".concat((null==C?void 0:null===(l=C.data)||void 0===l?void 0:l.title)||F," - ").concat(A("page_title")):A("page_title");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r(),{children:[(0,s.jsx)("title",{children:ey}),(0,s.jsx)("meta",{name:"description",content:A("page_desc")}),(0,s.jsx)("meta",{name:"keywords",content:n.cL}),(0,s.jsx)("meta",{property:"og:type",content:"website"}),(0,s.jsx)("meta",{property:"og:site_name",content:i.rZ}),(0,s.jsx)("meta",{property:"og:title",content:ey}),(0,s.jsx)("meta",{property:"og:description",content:A("page_desc")}),(0,s.jsx)("meta",{property:"og:image",content:n.VI}),(0,s.jsx)("meta",{property:"og:url",content:"https://felo.ai/slides/".concat(ei)}),(0,s.jsx)("meta",{property:"og:locale",content:D}),(0,s.jsx)("meta",{name:"twitter:card",content:"summary"}),(0,s.jsx)("meta",{name:"twitter:title",content:ey}),(0,s.jsx)("meta",{name:"twitter:description",content:A("page_desc")}),(0,s.jsx)("meta",{name:"twitter:site",content:"@felo_ai"}),(0,s.jsx)("meta",{name:"twitter:creator",content:"@felo_ai"}),(0,s.jsx)("meta",{name:"twitter:image",content:n.VI})]}),(0,s.jsxs)("div",{className:"bg-[#E9EDF1] dark:bg-[#2B313A]",children:[(0,s.jsx)("div",{className:(0,eh.cn)("absolute inset-0 pointer-events-none transition-opacity",!es&&"opacity-0"),style:es?{background:"".concat(es," fixed")}:void 0}),ea&&(0,s.jsx)("div",{className:"absolute inset-0 pointer-events-none",style:{background:ea}}),(0,s.jsx)(V.Z,{title:F,id:String((null==C?void 0:null===(a=C.data)||void 0===a?void 0:a.id)||T||""),businessId:(null==C?void 0:null===(m=C.data)||void 0===m?void 0:m.business_id)||T||ei||"",isSelf:et,modelType:E,status:H}),(0,s.jsxs)("div",{className:(0,eh.cn)("p-10 mx-auto min-h-[calc(100dvh-64px)] transition-[margin]",ee&&"mr-96"),id:"slidesWrapper",children:["waiting"===H&&(0,s.jsxs)("div",{className:"flex flex-col min-h-[calc(100dvh-300px)] w-full justify-center items-center",children:[(0,s.jsx)("img",{src:"/resources/slide/placeholder.webp",className:"w-72 h-72 dark:opacity-40",alt:"ppt-placeholder"}),(0,s.jsx)("p",{className:"text-base text-[#8896AA]",children:A("generateSlides.slides_placeholder_title")})]}),("getOutline"===H||"failed"===H||"getOutlineSuccess"===H)&&(0,s.jsx)(eB,{onRetry:()=>{B({detail:C,retryOutline:!0})},status:H,onGenerateSlides:ef,generateSlides:J,addGeneratePlanNotice:K}),"succeed"===H&&(0,s.jsx)("div",{className:"mx-auto space-y-10 z-10 max-w-[1154px]",children:L.map((e,t)=>(0,s.jsx)(G,{ref:e=>{M.current[t]=e},page:t+1,item:e,regenerateSlide:()=>{ec(null==e?void 0:e.page)},totalCount:L.length,isSelf:et,isShowHeadHandle:!1,messageId:T,modelType:E},t))}),(null==C?void 0:null===(g=C.data)||void 0===g?void 0:null===(x=g.slides)||void 0===x?void 0:x.length)&&(null==C?void 0:null===(b=C.data)||void 0===b?void 0:null===(f=b.plan)||void 0===f?void 0:null===(v=f.slides)||void 0===v?void 0:v.length)===(null==C?void 0:null===(_=C.data)||void 0===_?void 0:null===(k=_.slides)||void 0===k?void 0:k.length)||"failed"===H||"waiting"===H||"init"===H||"getOutline"===H||"getOutlineSuccess"===H?null:(0,s.jsx)("div",{className:"sticky bottom-10 z-30 pointer-events-none",children:(0,s.jsx)(eu,{className:"mx-auto max-w-screen-sm pointer-events-auto",value:er})})]}),et&&(0,s.jsx)(ez.Z,{status:H,disabled:er<100,messageId:T,onUpdateShortId:e=>{history.replaceState(null,document.title,"/slides/".concat(e,"?modelType=PRO"))},onCreateOutline:ev,onCreatePpt:ej})]}),(0,s.jsx)(ex.Z,{onClickRegenerate:ec,onClickEditSlideHtml:eg}),(0,s.jsx)(ep.U,{}),(0,s.jsx)(en,{})]})}}},function(e){e.O(0,[8669,6164,8058,7815,4078,2366,8739,4386,2686,5236,2888,9774,179],function(){return e(e.s=12737)}),_N_E=e.O()}]);