"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7240],{40203:function(e,t,s){var l=s(52676),a=s(75271),i=s(43378),n=s(25010),r=s(25773),o=s(62796),c=s(7717);t.Z=e=>{let{serviceName:t,serviceUrl:s,serviceId:d,isOpen:u,onClose:m,onSuccess:h}=e,p=(0,c.useTranslations)(),[x,g]=(0,a.useState)(!1),[v,f]=(0,a.useState)(null),[_,b]=(0,a.useState)(!1),j=async()=>{g(!0),f(null);try{let e=Math.max(0,(window.innerWidth-600)/2),t=Math.max(0,(window.innerHeight-700)/2),l=window.open(s,"",["popup","width=".concat(600),"height=".concat(700),"left=".concat(e),"top=".concat(t)].join(",")),a=e=>{"authorization_success"===e.data?(window.removeEventListener("message",a),null==l||l.close(),h(),m()):"authorization_error"===e.data&&(window.removeEventListener("message",a),null==l||l.close(),f(p("agent.mcp_auth_check_failed")))};window.addEventListener("message",a);let i=setInterval(()=>{(null==l?void 0:l.closed)&&(clearInterval(i),g(!1),y())},1e3)}catch(e){console.error("Authorization failed",e),f(p("agent.mcp_auth_check_failed")),g(!1)}},y=async()=>{b(!0);let e=0,t=async()=>{try{let{isAuthorized:t,data:s}=await (0,o.q)(d);if(t)return b(!1),h(),m(),!0;if(e>=3)return b(!1),f(p("agent.mcp_auth_check_timeout")),!0;return e++,!1}catch(e){return console.error("Error checking authorization status:",e),b(!1),f(p("agent.mcp_auth_check_failed")),!0}},s=async()=>{await t()||setTimeout(s,2e3)};s()};return(0,a.useEffect)(()=>{u&&j()},[u]),(0,l.jsx)(i.Vq,{open:u,onOpenChange:e=>!e&&m(),children:(0,l.jsxs)(i.cZ,{className:"sm:max-w-md",children:[(0,l.jsx)(i.fK,{children:(0,l.jsx)(i.$N,{children:p("agent.mcp_auth_title",{name:t})})}),(0,l.jsx)("div",{className:"flex flex-col items-center justify-center py-6 space-y-4",children:x||_?(0,l.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,l.jsx)(r.Z,{className:"h-8 w-8 animate-spin text-primary"}),(0,l.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-200",children:x?p("agent.mcp_auth_loading",{name:t}):p("agent.mcp_auth_checking",{name:t})})]}):v?(0,l.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,l.jsx)("p",{className:"text-sm text-red-500",children:v}),(0,l.jsx)(n.z,{onClick:j,variant:"outline",children:p("agent.mcp_auth_retry")})]}):(0,l.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-200",children:p("agent.mcp_auth_please_complete",{name:t})})})]})})}},28818:function(e,t,s){var l=s(52676),a=s(25010),i=s(5588),n=s(25773),r=s(43378),o=s(7717);t.Z=e=>{let{isOpen:t,onOpenChange:s,serverTitle:c,onServerTitleChange:d,serverUrl:u,onServerUrlChange:m,serverHeader:h,onServerHeaderChange:p,testStatus:x,testLoading:g,onTest:v,onSubmit:f}=e,_=(0,o.useTranslations)();return(0,l.jsx)(r.Vq,{open:t,onOpenChange:s,children:(0,l.jsxs)(r.cZ,{className:"sm:max-w-[425px]","aria-describedby":void 0,children:[(0,l.jsx)(r.fK,{children:(0,l.jsx)(r.$N,{children:_("agent.mcp_servers")})}),(0,l.jsx)(r.a7,{children:(0,l.jsxs)("div",{className:"grid gap-4 py-3",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsxs)("label",{htmlFor:"serverTitle",className:"text-sm",children:[(0,l.jsx)("span",{className:"text-red-500 mr-1",children:"*"}),_("agent.mcp_servers_title")]}),(0,l.jsx)(i.I,{id:"serverTitle",value:c,onChange:e=>d(e.target.value),placeholder:"",autoComplete:"off",autoFocus:!0})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsxs)("label",{htmlFor:"serverUrl",className:"text-sm",children:[(0,l.jsx)("span",{className:"text-red-500 mr-1",children:"*"}),_("agent.mcp_servers_url")]}),(0,l.jsx)(i.I,{id:"serverUrl",value:u,onChange:e=>m(e.target.value),placeholder:"https://example.com/sse",autoComplete:"off"})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)("label",{htmlFor:"serverHeaders",className:"text-sm",children:_("agent.mcp_servers_header")}),(0,l.jsx)(i.I,{id:"serverHeaders",value:h,onChange:e=>p(e.target.value),placeholder:_("agent.mcp_servers_header_placeholder",{json:'{"Authorization":"Bearer xx"}'}),autoComplete:"off"})]})]})}),(0,l.jsx)(r.cN,{className:"flex gap-2",children:(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2 w-full",children:[(0,l.jsx)("div",{children:null!==x&&(0,l.jsxs)("div",{className:"flex items-center gap-2 ".concat(x?"text-green-500":"text-red-500"),children:[(0,l.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(x?"bg-green-500":"bg-red-500")}),(0,l.jsx)("span",{children:_(x?"agent.mcp_servers_success":"agent.mcp_servers_failed")})]})}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(a.z,{variant:"outline",onClick:v,disabled:!c||!u,className:"flex-1 sm:flex-none",isLoading:g,children:g?(0,l.jsx)(n.Z,{className:"h-4 w-4 animate-spin"}):_("agent.mcp_servers_test")}),(0,l.jsx)(a.z,{onClick:f,disabled:!c||!u,className:"flex-1 sm:flex-none",children:_("agent.mcp_servers_save")})]})]})})]})})}},17240:function(e,t,s){s.d(t,{Z:function(){return sm}});var l=s(52676),a=s(22955),i=s(26745),n=s(86968),r=s(60904),o=s(73423),c=s(17224),d=s.n(c),u=s(75271),m=s(46571),h=s(37639),p=s(25010),x=s(96164),g=s(46988),v=s(31022),f=s(76011),_=s(7717),b=s(27976),j=s(97571),y=s(29871),w=s(90488),N=s(80626),k=s(53232),S=s(8096),E=s(29764),Z=s(4814),C=s(57546),F=s(34276);let T=e=>(/^https?:\/\//i.test(e)||(e="https://"+e),e);var D=u.memo(e=>{let{data:t,selected:s,goToTraditionalSearch:a}=e,i=(0,c.useRouter)(),n=(0,_.useTranslations)(),r=(0,v.Z)(e=>e.setLoading),[o,d]=(0,u.useState)(!1),m=async()=>{var e;if((null==t?void 0:t.type)==="site"||!await (0,F.f)({query:null===(e=t.title)||void 0===e?void 0:e.trim(),setLoading:r}))return;v.Z.getState().startSearch("guess");let{isOpenThreadModal:s,closeThreadModal:l}=C.Z.getState();s&&l(),i.push((0,h.MD)({query:t.title}))};if((null==t?void 0:t.type)==="site"){let{domain:e,title:a}=t,i=T(e);return(0,l.jsxs)("section",{className:(0,Z.Z)("scroll-m-32","transition-[background] flex group rounded-lg items-center gap-2 p-2 text-sm rounded cursor-pointer",(s||o)&&"bg-[#F6F7F9] dark:bg-[#454E5D]"),onMouseOver:()=>d(!0),onMouseLeave:()=>d(!1),onClick:()=>{window.open(i,"_blank")},children:[(0,l.jsx)("div",{children:(0,l.jsx)(w.Z,{classNames:{wrapper:"flex-shrink-0"},src:"https://www.google.com/s2/favicons?domain=".concat(i,"&sz=",16)})}),(0,l.jsx)("span",{className:"truncate mr-2 flex-shrink-0",children:a}),(0,l.jsxs)("span",{className:"flex items-center min-w-0",children:[(0,l.jsx)(N.Z,{className:"flex-shrink-0 w-3 h-3 mr-1 text-gray-400 dark:text-gray-500"}),(0,l.jsx)("span",{className:"text-xs text-gray-400 dark:text-gray-500 truncate",children:i})]}),(0,l.jsx)(k.Z,{className:"opacity-0 group-hover:opacity-100 transition-opacity ml-auto flex-shrink-0",size:18})]})}return(null==t?void 0:t.type)==="websearch"?(0,l.jsxs)("div",{className:(0,Z.Z)("scroll-m-32","transition-[background] rounded-lg flex group items-center gap-2 p-2 text-sm rounded cursor-pointer",(s||o)&&"bg-[#F6F7F9] dark:bg-[#454E5D]"),onMouseOver:()=>d(!0),onMouseLeave:()=>d(!1),onClick:a,children:[(0,l.jsx)(S.Z,{className:"w-4 h-4"}),(0,l.jsx)("div",{className:"text-sm",children:n("traditional_search")}),(0,l.jsx)("div",{className:"text-xs text-gray-500 ml-1 italic",children:n("traditional_search_tip")}),(0,l.jsx)("div",{className:"ml-auto border border-[#9B9FFF] text-[#9B9FFF] rounded-xl px-1",children:"Beta"})]}):(0,l.jsxs)("div",{className:(0,Z.Z)("scroll-m-32","transition-[background] flex group rounded-lg items-center gap-2 p-2 text-sm rounded cursor-pointer",(s||o)&&"bg-[#F6F7F9] dark:bg-[#454E5D]"),onMouseOver:()=>d(!0),onMouseLeave:()=>d(!1),onClick:m,children:[(0,l.jsx)(E.Z,{className:"w-4 h-4"}),t.title]})}),A=s(26595),z=s(57207),P=s(28946),I=s(94247),R=s(15729),L=s(80145),M=s(9369),U=s(36551),B=s(46344),O=s(31442),W=s(67241),H=s(4590),V=s(97247),q=s(17112),Y=s(43378),J=s(22675),X=s(9164),G=s(44644),K=s(54313),$=s(416),Q=s(84375),ee=s(95808),et=s(18718),es=s(88637),el=s(59167),ea=s(87106),ei=s(81555),en=s(9455),er=s(65550),eo=s(38188),ec=s(65819),ed=s(38793),eu=s(48958),em=s(91165),eh=s(65213),ep=s(29197),ex=s(77249),eg=s(84593),ev=s(70017),ef=s(1167),e_=s(25994),eb=s(31063),ej=s(60161),ey=s(49759),ew=s(56975),eN=s(47014),ek=s(74538),eS=s(19073),eE=s(14386),eZ=s(21133),eC=e=>{let{selectItem:t,selectClick:s}=e,a=(0,_.useTranslations)(),i=(0,ec.gQ)(),n=(0,u.useMemo)(()=>i?[{icon:(0,l.jsx)(eE.aL,{className:"w-5 h-5"}),name:a("shareThread.secret"),value:"PRIVATE"},{icon:(0,l.jsx)(eS.Z,{className:"w-5 h-5"}),name:a("shareThread.enterprise_title"),value:"PARTIAL_PUBLIC"},{icon:(0,l.jsx)(eZ.FO,{className:"w-5 h-5"}),name:a("shareThread.shareable"),value:"PUBLIC"}]:[{icon:(0,l.jsx)(eE.aL,{className:"w-5 h-5"}),name:a("shareThread.secret"),value:"PRIVATE"},{icon:(0,l.jsx)(eZ.FO,{className:"w-5 h-5"}),name:a("shareThread.shareable"),value:"PUBLIC"}],[i]),r=(0,u.useMemo)(()=>{let e=n.find(e=>e.value===t.permission.read_permission);return(null==e?void 0:e.name)||""},[t]),o=(0,u.useMemo)(()=>{let e=n.find(e=>e.value===t.permission.read_permission);return(null==e?void 0:e.icon)||""},[t]);return(0,l.jsxs)(ey.F,{children:[(0,l.jsx)(ew.S,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between w-full px-2 py-1  bg-white border border-gray-300 rounded-md shadow-sm cursor-pointer  hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2  focus:ring-indigo-500 dark:bg-[#202531] dark:border-[#454E5D]  dark:hover:bg-[#202531]",children:[o,(0,l.jsx)("span",{className:"ml-2 mr-4 whitespace-nowrap",children:r}),(0,l.jsx)(M.Z,{size:20})]})}),(0,l.jsx)(eN.a,{"aria-label":"topic Changed",className:"p-2 overflow-auto",style:{position:"relative",pointerEvents:"auto"},children:n.map((e,a)=>(0,l.jsx)(ek.W,{className:"text-[#1D3C6D] cursor-pointer hover:!bg-blue-100 hover:!text-[#1D3C6D] dark:text-[#EDF3FC] hover:dark:!bg-[#2E3643] hover:dark:!text-[#EDF3FC]",onClick:()=>{s(t,e.value)},children:e.name},a))})]})},eF=s(26449),eT=s(89335),eD=s(77844),eA=s(95191),ez=s(59892),eP=e=>{let{defaultItem:t,isUsing:s,isEditing:a,callbacks:i,setIsEditing:n,onSubmit:r,tooltipOpen:o}=e,c=(0,_.useTranslations)(),d=(0,_.useLocale)(),m=(0,v.Z)(e=>e.proSelected),h=(0,ec.ZP)(e=>e.isLogin),[x,g]=(0,u.useState)({name:t.title,description:t.description,placeholder:t.placeholder,steps:t.sub_topics}),[f,b]=(0,u.useState)(""),[j,y]=(0,u.useState)(!1),[w,N]=(0,u.useState)(""),[k,S]=(0,u.useState)(!1),[E,Z]=(0,u.useState)([]),[C,F]=(0,u.useState)([]),[T,D]=(0,u.useState)(!1),{copy:A,copied:z}=(0,ev.V)(),[P,I]=(0,u.useState)(!1),R=eD.Z.getState().current,L=t.system,M=L||!t.created_at,[B,O]=(0,u.useState)("");(0,u.useEffect)(()=>{(async()=>{let e=await (0,eA.Y)(t.title),s=(0,ez.b)(e);O("".concat(location.origin,"/agents/").concat(s,"-").concat(t.short_id).concat(R?"?invite="+R:""))})()},[t.title,t.short_id,R]),(0,u.useEffect)(()=>{try{var e;D(!!(t.params&&(null===(e=t.params[0])||void 0===e?void 0:e.type)==="file"))}catch(e){console.log(e),D(!1)}},[t]);let W=(e,t)=>{t.length>100||g(s=>({...s,steps:s.steps.map((s,l)=>l===e?{...s,title:t}:s)}))},H=(e,t)=>{g(s=>({...s,steps:s.steps.map((s,l)=>l===e?{...s,source_type:t.source_type,source_id:t.source_id,source_info:t.source_info,tools:t.tools}:s)}))},V=e=>{if(x.steps.length<=1){q.Z.warning(c("agent.min_one_step_required"));return}g(t=>({...t,steps:t.steps.filter((t,s)=>s!==e)}))},J=e=>{if(x.steps.length>=e_.o2){q.Z.warning(c("agent.max_steps_reached",{count:e_.o2}));return}g(t=>({...t,steps:[...t.steps.slice(0,e+1),{title:"",source_type:U.gl},...t.steps.slice(e+1)]}))},X=async()=>{try{var e,s;if(!x.name.trim()){N(c("agent.please_input_agent_name"));return}if(x.steps.some(e=>!e.title.trim())){N(c("agent.please_input_steps"));return}if(!h)return;y(!0),N("");let l=null;if(M){let s={introduction:x.description||"",title:x.name,placeholder:x.placeholder,sub_topics:x.steps,params:null==t?void 0:t.params,template_type:ei.W.DEFAULT,lang:d};(l=await (0,ea.YX)(s)).data&&(null===(e=i.onCreate)||void 0===e||e.call(i,l.data))}else if(t){let e={short_id:t.short_id,introduction:x.description||"",title:x.name,placeholder:x.placeholder,sub_topics:x.steps,params:null==t?void 0:t.params,template_type:ei.W.DEFAULT};(l=await (0,ea._Z)(e)).data&&(null===(s=i.onUpdate)||void 0===s||s.call(i,l.data))}if(!l||!l.success){q.Z.error((null==l?void 0:l.error)||c("save_failed")),y(!1);return}q.Z.success(c("save_success")),n(!1),(0,eb.fk)(L?ej.U.AGENT_SAVE:ej.U.AGENT_CREATE_SAVE,{name:x.name},!0)}catch(e){N(e instanceof Error?e.message:c("save_failed"))}finally{y(!1)}},G=async e=>{if(e.preventDefault(),!j){if(!t){N(c("please_select_report_type"));return}if(!f){N(c("please_input_industry_name"));return}try{y(!0),N("");let e=v.Z.getState().proSelected?U.NY:U.R_,s=localStorage.getItem(eo.J.GTAG_EVENT_ACTIVATION)||ec.ZP.getState().anonymousToken,l=await (0,ea.GK)(t.short_id,{query:f,mode:e,device_id:s});if(!l.data||!l.success){q.Z.error((null==l?void 0:l.error)||c("submit_failed")),y(!1);return}let a=l.data.sub_queries;await r(a)}catch(e){N(e instanceof Error?e.message:c("submit_failed"))}finally{y(!1)}}},K=async()=>{var e,s;if(!t)return;if(!h){q.Z.success(c("delete_success")),null===(s=i.onDelete)||void 0===s||s.call(i,t.id);return}let l=await (0,ea.hX)([t.short_id]);if(!l.success){q.Z.error((null==l?void 0:l.error)||c("delete_failed"));return}q.Z.success(c("delete_success")),null===(e=i.onDelete)||void 0===e||e.call(i,t.id)},$=async()=>{S(!0);try{let e=await (0,ea.hi)(t.short_id);e.data&&(Z(e.data.filter(e=>!0===e.permission.is_self)||[]),F(e.data.filter(e=>!1===e.permission.is_self)||[]))}catch(e){console.log(e),Z([]),F([])}},Q=async(e,t)=>{200===(await (0,eT.n2)({topic_id:e.short_id,read_permission:t})).status&&Z(s=>s.map(s=>s.short_id===e.short_id?{...s,permission:{read_permission:t,is_self:s.permission.is_self,can_read:s.permission.can_read}}:s))};(0,u.useEffect)(()=>{if(E.length<=0){I(!0);return}let e=E.every(e=>"PUBLIC"===e.permission.read_permission),t=E.some(e=>"PRIVATE"===e.permission.read_permission);e?I(!0):t?I(!1):I(!0)},[E]);let ee=(0,l.jsx)(Y.Vq,{open:k,onOpenChange:S,children:(0,l.jsxs)(Y.cZ,{className:"max-w-2xl w-full max-h-full",children:[(0,l.jsx)(Y.fK,{children:(0,l.jsx)(Y.$N,{children:c("share_research_plan")})}),(0,l.jsxs)("section",{className:"px-6 pb-8 pt-4 w-full overflow-hidden",children:[(0,l.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:c("agent.copy_link_label")}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("p",{className:"flex-1 p-2 text-sm bg-muted rounded-md rounded-r-none truncate",children:P&&0===C.length?B:"".concat(B.slice(0,40),"...")}),(0,l.jsx)(p.z,{size:"sm",disabled:!P,className:"px-3 shrink-0 rounded-l-none transition-colors duration-300 ".concat(z?"bg-green-500 hover:bg-green-600":""),onClick:()=>{if(C.length>0&&o&&!C.every(e=>"PUBLIC"===e.permission.read_permission)){o();return}A(B),(0,eb.fk)(ej.U.AGENT_SHARE,{value:1},!0)},children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[z?(0,l.jsx)(em.Z,{className:"h-4 w-4"}):(0,l.jsx)(eh.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:c("copy")})]})})]}),E.length>0&&(0,l.jsxs)("div",{className:"border border-theme-border-100 rounded-md mt-6",children:[(0,l.jsxs)("div",{className:"flex gap-2 bg-[#FFF0DE] text-[#f59a23] px-2 py-1 rounded-t-md",children:[(0,l.jsx)(ep.Z,{size:20,className:"mt-[2px]"}),(0,l.jsx)("span",{children:c("agent.share_tip_desc")})]}),(0,l.jsx)("div",{className:"flex flex-col gap-4 p-3 mt-2",children:E.map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"max-w-[200px] whitespace-nowrap overflow-hidden text-ellipsis text-base font-bold",children:e.name}),(0,l.jsxs)("div",{className:"text-sm text-gray-400",children:["(",c("agent.share_tip_desc_file"),")"]}),(0,l.jsx)("div",{className:"ml-auto",children:(0,l.jsx)(eC,{selectItem:e,selectClick:Q})})]},e.short_id))})]}),(0,l.jsx)("div",{className:"mt-6 space-y-4",children:(0,l.jsx)("div",{className:"flex flex-col gap-4",children:(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("p",{className:"text-sm font-medium",children:c("agent.share_description_title")}),(0,l.jsxs)("ul",{className:"list-inside space-y-1 text-sm text-muted-foreground",children:[(0,l.jsx)("li",{children:c("agent.share_description_1")}),(0,l.jsx)("li",{children:c("agent.share_description_2")}),(0,l.jsx)("li",{children:c("agent.share_description_3")})]})]})})})]})]})});if(a){var et;return(0,l.jsxs)("div",{className:"flex flex-col h-full relative",children:[(0,l.jsxs)("div",{className:"flex-1 flex flex-col h-full p-6 overflow-y-auto scrollbar",children:[(0,l.jsx)("h3",{className:"flex-none font-medium mb-4",children:c("agent.edit_template")}),(0,l.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsxs)("label",{className:"block text-sm font-medium mb-2",children:[c("agent.agent_name"),(0,l.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,l.jsxs)("div",{className:"text-xs text-gray-500",children:[x.name.length,"/70"]})]}),(0,l.jsx)(eu.Y,{value:x.name,onChange:e=>g(t=>({...t,name:e.target.value})),placeholder:c("agent.input_agent_name"),maxLength:70})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium",children:c("agent.agent_description")}),(0,l.jsxs)("div",{className:"text-xs text-gray-500",children:[(null===(et=x.description)||void 0===et?void 0:et.length)||0,"/200"]})]}),(0,l.jsx)(ed.Y,{value:x.description,onChange:e=>g(t=>({...t,description:e.target.value})),placeholder:c("agent.input_agent_description"),maxLength:200,minRows:3,maxRows:5})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium",children:c("agent.template_placeholder")}),(0,l.jsxs)("div",{className:"text-xs text-gray-500",children:[x.placeholder.length,"/100"]})]}),(0,l.jsx)(ed.Y,{value:x.placeholder,onChange:e=>g(t=>({...t,placeholder:e.target.value})),placeholder:c("agent.input_template_placeholder"),maxLength:100,minRows:2,maxRows:3})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsxs)("label",{className:"block text-sm font-medium",children:[c("agent.agent_steps"),(0,l.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,l.jsxs)(p.z,{size:"sm",variant:"ghost",onClick:()=>{if(x.steps.length>=e_.o2){q.Z.warning(c("agent.max_steps_reached",{count:e_.o2}));return}g(e=>({...e,steps:[...e.steps,{title:"",source_type:U.gl}]}))},children:["+ ",c("agent.add_step")]})]}),(0,l.jsx)("div",{className:"space-y-2",children:x.steps.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("div",{className:"flex-none w-6 text-sm text-gray-500",children:t+1}),(0,l.jsx)(eu.Y,{value:e.title,onChange:e=>W(t,e.target.value),placeholder:c("agent.input_step_content"),maxLength:100}),(0,l.jsxs)("div",{className:"flex gap-1",children:[!T&&(0,l.jsx)(eF.Z,{item:e,onChange:H,index:t}),(0,l.jsx)(p.z,{size:"sm",variant:"ghost",onClick:()=>J(t),className:"text-gray-500 hover:text-blue-500",children:(0,l.jsx)("span",{children:"+"})}),(0,l.jsx)(p.z,{size:"sm",variant:"ghost",onClick:()=>V(t),className:"text-gray-500 hover:text-red-500",children:(0,l.jsx)("span",{children:"-"})})]})]},t))})]})]}),w&&(0,l.jsx)("div",{className:"mt-4 text-sm text-red-500",children:w})]}),(0,l.jsxs)("div",{className:"flex-none flex items-center justify-between gap-2 px-6 py-4 border-t",children:[!L&&(0,l.jsx)("div",{children:(0,l.jsx)(p.z,{variant:"destructive",size:"sm",onClick:K,children:c("delete")})}),(0,l.jsxs)("div",{className:"flex-1 flex justify-end space-x-2",children:[(0,l.jsx)(p.z,{variant:"outline",size:"sm",onClick:()=>{var e;n(!1),N(""),g({name:t.title,description:t.description,placeholder:t.placeholder,steps:t.sub_topics}),null===(e=i.onBack)||void 0===e||e.call(i)},children:c("cancel")}),(0,l.jsx)(p.z,{size:"sm",onClick:X,disabled:j||!x.name,children:L?c("save_to_my_templates"):c("confirm")})]})]})]})}return s?(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsxs)(p.z,{variant:"ghost",size:"sm",onClick:i.onBack,className:"hover:bg-gray-100 dark:hover:bg-gray-600 mb-4",disabled:j,children:[(0,l.jsx)(ex.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:c("back")})]}),(0,l.jsxs)("form",{onSubmit:G,className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2 mb-2",children:[(0,l.jsxs)("label",{htmlFor:"brandName",className:"block text-sm font-medium",children:[c("research_target"),(0,l.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,l.jsxs)("div",{className:"text-xs text-gray-500",children:[f.length,"/70"]})]}),(0,l.jsx)(eu.Y,{id:"brandName",name:"brandName",placeholder:c("research_target_placeholder",{count:70}),value:f,onChange:e=>{b(e.target.value),N("")},maxLength:70,autoFocus:!0,isDisabled:j,isInvalid:!!w,errorMessage:w,isRequired:!0,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"})]}),(0,l.jsx)("div",{className:"absolute bottom-6 right-6",children:(0,l.jsx)(p.z,{type:"submit",size:"sm",disabled:j,children:j?c("generating"):c("confirm")})})]})]}):!a&&x.name?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("section",{className:"h-full flex flex-col gap-2",children:[(0,l.jsxs)("div",{className:"flex-1 p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("span",{className:"font-bold",children:c("introduction")}),m&&(0,l.jsxs)("span",{className:"flex items-center gap-2",children:[(0,l.jsx)(ef.pn,{delayDuration:100,children:(0,l.jsxs)(ef.u,{children:[(0,l.jsx)(ef.aJ,{children:(0,l.jsx)(eg.Z,{className:"h-4 w-4"})}),(0,l.jsx)(ef._v,{children:c("agent.pro_search_cost_tip")})]})}),(0,l.jsx)("span",{className:"text-sm text-gray-500",children:c("agent.pro_search_cost",{count:x.steps.length})})]})]}),(0,l.jsx)("p",{className:"text-sm mt-6",children:x.description}),(0,l.jsx)("ul",{className:"mt-6 list-disc list-inside space-y-1",children:x.steps.map(e=>(0,l.jsx)("li",{children:e.title},e.title))})]}),(0,l.jsx)("section",{className:"flex-none pl-4 pr-2 pb-4",children:(0,l.jsxs)("section",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("section",{children:h&&(0,l.jsx)(p.z,{variant:"outline",onClick:$,className:"flex items-center gap-2",children:(0,l.jsx)("span",{children:c("share_research_plan")})})}),(0,l.jsxs)("section",{className:"space-x-2",children:[h&&(0,l.jsx)(p.z,{variant:"outline",onClick:()=>{n(!0),(0,eb.fk)(ej.U.AGENT_EDIT,{name:x.name},!0)},children:c("edit")}),(0,l.jsx)(p.z,{onClick:()=>{var e;null===(e=i.onConfirm)||void 0===e||e.call(i,t)},children:c("apply")})]})]})})]}),ee]}):null},eI=s(30674),eR=s(37481);let eL=[{key:"processing",label:"agent.create_agent_step_1"},{key:"createing",label:"agent.create_agent_step_2"},{key:"collecting",label:"agent.create_agent_step_3"},{key:"optimizing",label:"agent.create_agent_step_4"}];var eM=e=>{let{onCreate:t,onCancel:s}=e,a=(0,_.useTranslations)(),[i,n]=(0,u.useState)(!1),[r,o]=(0,u.useState)(!1),[c,d]=(0,u.useState)(""),[m,h]=(0,u.useState)(0),[x,f]=(0,u.useState)();(0,u.useEffect)(()=>{if(i)return(async()=>{for(let e of eL.map((e,t)=>t))await new Promise(e=>setTimeout(e,1e3)),h(e)})(),()=>{h(0)}},[i]);let b=async()=>{n(!0);let{proSelected:e}=v.Z.getState(),t=e?U.NY:U.R_,s=localStorage.getItem(eo.J.GTAG_EVENT_ACTIVATION)||ec.ZP.getState().anonymousToken,l=await (0,ea.RV)({query:c,mode:t,device_id:s});if(!l||!l.success||!l.data){n(!1),q.Z.error((null==l?void 0:l.error)||a("error.failed_to_generate_template"));return}f(l.data),n(!1),o(!0);let{title:i}=l.data;(0,eb.fk)(ej.U.AGENT_CREATE_SUBMIT,{name:i},!0)},j=()=>{d(""),s(),o(!1),f(void 0)};return r&&x?(0,l.jsx)("div",{className:"flex-1 h-full",children:(0,l.jsx)(eP,{defaultItem:x,isUsing:!1,isEditing:!0,setIsEditing:()=>{},onSubmit:()=>{},callbacks:{onBack:j,onCreate:e=>{t(e)},onDelete:()=>{},onUpdate:()=>{},onConfirm:()=>{}}},"create-template")}):(0,l.jsxs)("div",{className:"flex flex-col h-full p-8",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h3",{className:"text-md font-medium",children:a("create_ai_search_agent_button")}),!i&&(0,l.jsxs)("span",{className:"text-sm text-gray-500",children:[c.length," / ",100]})]}),i?(0,l.jsx)("div",{className:"flex-1 flex flex-col",children:(0,l.jsx)("div",{className:"space-y-4 w-full max-w-md",children:eL.map((e,t)=>(0,l.jsxs)("div",{className:(0,eR.cn)("flex items-center space-x-4",m>=t?"text-primary":"text-gray-400"),children:[(0,l.jsx)("span",{children:a(e.label)}),(0,l.jsx)(eI.c,{size:"sm",className:(0,eR.cn)("opacity-0",m===t&&"opacity-100")})]},e.key))})}):(0,l.jsxs)("div",{className:"flex-1 mb-6",children:[(0,l.jsx)(g.Z,{className:(0,eR.cn)("p-4 rounded-xl shadow-sm","border-1 border-[#dbe2e9] dark:border-[#343b4d] dark:bg-[#353B46]","w-full bg-inherit outline-none resize-none transition-height"),value:c,onChange:e=>d(e.target.value),onKeyDown:e=>{13==e.keyCode&&!1==e.shiftKey&&!i&&c.trim()&&(e.preventDefault(),b())},placeholder:a("create_ai_search_agent_placeholder"),maxLength:100,minRows:2,autoFocus:!0}),(0,l.jsxs)("div",{className:"mt-4 text-sm",children:[(0,l.jsx)("p",{className:"text-gray-500 mb-2",children:a("agent.example")}),(0,l.jsxs)("div",{className:"flex flex-col gap-2 text-gray-500",children:[(0,l.jsx)("p",{children:a("agent.example_1")}),(0,l.jsx)("p",{children:a("agent.example_2")}),(0,l.jsx)("p",{children:a("agent.example_3")})]})]})]}),(0,l.jsx)("div",{className:"flex justify-end items-center",children:!i&&(0,l.jsxs)("div",{className:"space-x-2",children:[(0,l.jsx)(p.z,{variant:"outline",onClick:j,children:a("cancel")}),(0,l.jsx)(p.z,{onClick:b,disabled:!c.trim(),children:a("submit_task")})]})})]})},eU=s(5588),eB=s(72696),eO=s(35525),eW=s(32733),eH=e=>{let{defaultValue:t,onChange:s,disabled:a,allowedModels:i}=e,n=(0,_.useTranslations)(),{setIsOpen:r,getDataRetentionEnabled:o,setCallback:c}=(0,eO.Z)(),{allModelList:d}=(0,v.Z)(),u=e=>{if(("deepseek-reasoner"===e||"deepseek-chat"===e)&&!o()){r(!0),c(()=>{s(e)});return}s(e)},h=i&&i.length>0?d.filter(e=>i.includes(e.value)):d;return(0,l.jsxs)(eB.h_,{children:[(0,l.jsx)(eB.$F,{asChild:!0,disabled:a,children:(0,l.jsx)("button",{className:"relative inline-block w-full",children:(0,l.jsxs)("div",{className:(0,m.cn)("flex items-center justify-between w-full px-4 py-2 bg-white border border-[#EBEEF3] rounded-md shadow-sm cursor-pointer hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 border dark:border-[#545D6F] dark:bg-[#202531] dark:hover:bg-gray-700",a&&"opacity-50 cursor-not-allowed"),children:[(0,l.jsxs)("span",{className:"flex items-center whitespace-nowrap",children:[(()=>{var e;let s=null===(e=d.find(e=>e.value===t))||void 0===e?void 0:e.provider;return s?eW.e5[s]:null})(),(0,l.jsx)("span",{className:"ml-2 mr-4",children:(()=>{let e=d.find(e=>e.value===t);return e?e.label:""})()})]}),(0,l.jsx)(M.Z,{size:20})]})})}),(0,l.jsxs)(eB.AW,{className:"w-fit p-3 dark:bg-[#454E5D] dark:border-[#2E3643]",children:[(0,l.jsx)("div",{className:"mb-2 text-base",children:n("set_advanced_model")}),(0,l.jsx)("div",{className:"max-h-[40vh] overflow-y-auto custom-scrollbar",children:h.map(e=>(0,l.jsxs)(eB.Xi,{className:(0,m.cn)("flex items-center cursor-pointer","text-[#1D3C6D] hover:!bg-blue-100 hover:!text-[#1D3C6D] dark:text-[#EDF3FC] hover:dark:!bg-[#2E3643] hover:dark:!text-[#EDF3FC]",!b.r8&&e.is_dev&&"hidden"),onClick:()=>u(e.value),children:[(0,l.jsxs)("span",{className:"flex items-center",children:[eW.e5[e.provider],(0,l.jsx)("span",{className:"ml-2",children:e.label})]}),(0,l.jsxs)("span",{className:"flex gap-2",children:[e.is_beta&&(0,l.jsx)("span",{className:"rounded-xl text-[#0080FF] bg-[#D6F3FF] dark:bg-[#191E26] dark:text-[#EDF3FC] px-2 py-0.5 text-xs",children:"Beta"}),e.is_pro&&(0,l.jsx)("span",{className:"rounded-xl text-[#0080FF] bg-[#D6F3FF] dark:bg-[#191E26] dark:text-[#EDF3FC] px-2 py-0.5 text-xs",children:"Pro"})]})]},e.value))})]})]})},eV=s(93734),eq=e=>{let{dafaultTemplate:t,onCreate:s,onDelete:a,onUpdate:i,onConfirm:n,onCancel:r}=e,o=(0,_.useTranslations)(),c=(0,_.useLocale)(),{agentModelList:d}=(0,v.Z)(),[h,x]=(0,u.useState)(!1),[g,f]=(0,u.useState)({title:"",description:"",instructions:"",model:"",sourceType:U.gl,topicInfo:{title:"",id:""}}),[b,j]=(0,u.useState)(!1),[y,w]=(0,u.useState)("");(0,u.useEffect)(()=>{if(!t||!t.sub_topics[0])return;let{source_id:e,source_type:s,llm_model:l,instructions:a}=t.sub_topics[0];f({title:t.title||"",description:t.placeholder||"",instructions:a||"",model:l||"",sourceType:s||U.gl,topicInfo:{title:t.title||"",id:e||""}})},[t]);let N=()=>{r()},k=()=>({introduction:g.description,title:g.title,placeholder:"",sub_topics:[{title:g.title,source_type:g.sourceType,source_id:g.topicInfo.id,llm_model:g.model,instructions:g.instructions}],template_type:ei.W.CUSTOM,lang:c}),S=async()=>{j(!0);let e=k(),t=await (0,ea.YX)(e);t.data&&s(t.data),j(!1)},E=async()=>{j(!0);let e={...k(),short_id:(null==t?void 0:t.short_id)||""},s=await (0,ea._Z)(e);s.data&&(null==i||i(s.data),x(!1)),j(!1)},Z=async()=>{if(!t)return;let e=await (0,ea.hX)([t.short_id]);if(!e.success){q.Z.error((null==e?void 0:e.error)||o("delete_failed"));return}q.Z.success(o("delete_success")),null==a||a(t.id)};return(0,l.jsx)("div",{className:"flex-1 h-full",children:(0,l.jsxs)("div",{className:"flex flex-col h-full relative",children:[(0,l.jsxs)("div",{className:"flex-1 flex flex-col h-full p-6 overflow-y-auto scrollbar",children:[(0,l.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsxs)("label",{className:"block text-sm font-medium mb-2",children:[o("agent.agent_name"),(0,l.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,l.jsxs)("div",{className:"text-xs text-gray-500",children:[g.title.length,"/70"]})]}),(0,l.jsx)(eU.I,{value:g.title,onChange:e=>f(t=>({...t,title:e.target.value})),placeholder:o("agent.input_agent_name"),maxLength:70,disabled:!h&&!!t})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium",children:o("agent.agent_description")}),(0,l.jsxs)("div",{className:"text-xs text-gray-500",children:[g.description.length,"/200"]})]}),(0,l.jsx)(ed.Y,{value:g.description,onChange:e=>f(t=>({...t,description:e.target.value})),placeholder:o("agent.input_agent_description"),maxLength:200,minRows:2,maxRows:5,isDisabled:!h&&!!t})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,l.jsxs)("label",{className:"block text-sm font-medium",children:[o("agent.instructions"),(0,l.jsx)("span",{className:"text-red-500 ml-0.5",children:"*"})]}),(0,l.jsxs)("div",{className:"text-xs text-gray-500",children:[g.instructions.length,"/2000"]})]}),(0,l.jsx)(ed.Y,{value:g.instructions,onChange:e=>f(t=>({...t,instructions:e.target.value})),placeholder:o("agent.input_agent_prompt"),maxLength:2e3,minRows:3,maxRows:20,isDisabled:!h&&!!t})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"mb-2",children:(0,l.jsx)("label",{className:"block text-sm font-medium",children:o("agent.model")})}),(0,l.jsx)(eH,{defaultValue:g.model,onChange:e=>{f(t=>({...t,model:e}))},disabled:!h&&!!t})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,l.jsx)("label",{className:"block text-sm font-medium",children:o("agent.sources")})}),(0,l.jsx)(eF.Z,{item:{title:g.topicInfo.title,source_type:g.sourceType,source_id:g.topicInfo.id},onChange:(e,t)=>{f(e=>({...e,sourceType:t.source_type})),t.source_type===U.RQ&&f(e=>({...e,topicInfo:{title:t.title,id:t.source_id}}))},index:1,children:(0,l.jsx)(p.z,{variant:"outline",size:"lg",className:"w-full",disabled:!h&&!!t,children:g.sourceType?o((0,eV.Y)(g.sourceType)):o("agent.manage_sources")})})]})]}),y&&(0,l.jsx)("div",{className:"mt-4 text-sm text-red-500",children:y})]}),(0,l.jsx)("div",{className:"flex-none flex items-center justify-between gap-2 px-6 py-4 border-t",children:t?(0,l.jsxs)("div",{className:(0,m.cn)("flex-1 flex space-x-2",h?"justify-between":"justify-end"),children:[h&&(0,l.jsx)(p.z,{variant:"destructive",size:"sm",onClick:Z,children:o("delete")}),h?(0,l.jsxs)("div",{className:"space-x-2",children:[(0,l.jsx)(p.z,{variant:"outline",onClick:()=>{x(!1)},children:o("cancel")}),(0,l.jsx)(p.z,{onClick:E,disabled:b,children:o("confirm")})]}):(0,l.jsx)("div",{className:"space-x-2",children:(0,l.jsx)(p.z,{onClick:()=>{null==n||n(t)},children:o("apply")})})]}):(0,l.jsxs)("div",{className:"flex-1 flex justify-end space-x-2",children:[(0,l.jsx)(p.z,{variant:"outline",size:"sm",onClick:()=>{N()},children:o("cancel")}),(0,l.jsx)(p.z,{size:"sm",onClick:S,disabled:b||!g.title||!g.instructions,children:o("confirm")})]})})]})})},eY=e=>{let{loading:t,isCreating:s,setIsCreating:a,onCreate:i}=e,n=(0,_.useTranslations)(),[r,o]=(0,u.useState)("search"),c=()=>{if(!ec.ZP.getState().isLogin){C.Z.getState().setLoginModalVisible(!0);return}a(!0)},d=e=>{i(e),a(!1)},m=()=>{a(!1)};return s?"search"===r?(0,l.jsx)(eM,{onCreate:d,onCancel:m}):(0,l.jsx)(eq,{onCreate:d,onCancel:m}):(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-8 px-16 text-center ",children:[(0,l.jsx)("h3",{className:"text-xl font-medium mb-4",children:n("create_ai_search_agent")}),(0,l.jsx)("p",{className:"text-gray-500 mb-6",children:n("customize_your_ai_search_assistant")}),(0,l.jsx)("div",{className:"flex flex-col gap-4",children:(0,l.jsxs)(p.z,{size:"lg",className:"w-full h-12 text-base font-medium",disabled:t,onClick:()=>{c(),o("search"),(0,eb.fk)(ej.U.SEARCH_AGENT_CREATE,{name:"create_ai_search_agent"},!0)},children:[(0,l.jsx)(E.Z,{className:"w-5 h-5 mr-2"}),(0,l.jsx)("span",{children:n("create_ai_search_agent_button")})]})})]})},eJ=s(57591),eX=s(74926),eG=e=>{let{isOpen:t,onClose:s,handleEdit:a,onDelete:i,defaultItem:n}=e,r=(0,_.useTranslations)(),o=(0,ec.ZP)(e=>e.isLogin),c=async()=>{if(n){if(o){let e=await (0,ea.hX)([n.short_id]);if(!e.success){q.Z.error((null==e?void 0:e.error)||r("delete_failed"));return}}q.Z.success(r("delete_success")),i(n.id),s()}};return(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(Y.Vq,{open:t,onOpenChange:s,children:(0,l.jsxs)(Y.cZ,{className:"max-w-xl w-full max-h-full",children:[(0,l.jsx)(Y.fK,{children:(0,l.jsx)(Y.$N,{children:(0,l.jsxs)("div",{className:"flex items-center gap-2 mr-3",children:[(0,l.jsx)(ep.Z,{size:20}),(0,l.jsx)("span",{children:r("agent.agent_unavailable")})]})})}),(0,l.jsx)(Y.a7,{className:"pt-0",children:(0,l.jsx)("div",{className:"flex flex-col gap-2",children:o?r("agent.agent_unavailable_desc"):r("agent.agent_unavailable_desc_tip")})}),(0,l.jsxs)(Y.cN,{children:[o&&(0,l.jsx)(p.z,{onClick:a,variant:"outline",children:r("edit")}),(0,l.jsx)(p.z,{onClick:c,color:"primary",children:r("delete")})]})]})})})},eK=()=>{let{id:e}=(0,c.useRouter)().query;return e};let e$=[(0,l.jsx)(J.Z,{className:"h-4 w-4"},"barchart"),(0,l.jsx)(X.Z,{className:"h-4 w-4"},"linechart"),(0,l.jsx)(G.Z,{className:"h-4 w-4"},"wallet"),(0,l.jsx)(K.Z,{className:"h-4 w-4"},"settings"),(0,l.jsx)($.Z,{className:"h-4 w-4"},"share2"),(0,l.jsx)(R.Z,{className:"h-4 w-4"},"filetext"),(0,l.jsx)(E.Z,{className:"h-4 w-4"},"search"),(0,l.jsx)(Q.Z,{className:"h-4 w-4"},"bookopen"),(0,l.jsx)(I.Z,{className:"h-4 w-4"},"messagesquare"),(0,l.jsx)(ee.Z,{className:"h-4 w-4"},"target")],eQ="my-templates";var e0=e=>{var t;let{template:s,onOpenChange:a,onConfirm:i}=e,n=(0,_.useTranslations)(),r=(0,_.useLocale)(),o=(0,ec.ZP)(e=>e.isLogin),c=eK(),{tempTemplates:x}=(0,eX.Z)(),[g,f,b]=(0,eJ.Z)([]),[j,y]=(0,u.useState)(!1),[w,N]=(0,u.useState)(""),[k,S]=(0,u.useState)(eQ),[E,Z]=(0,u.useState)(null),[C,F]=(0,u.useState)(!0),[T,D]=(0,u.useState)(!1),[A,z]=(0,u.useState)(!1),[P,I]=(0,u.useState)(),R=(null===(t=g.find(e=>e.id===eQ))||void 0===t?void 0:t.children)||[],L=g.find(e=>e.id===k),{isOpen:M,onOpen:B,onClose:O}=(0,en.q)();null==L||L.children.find(e=>e.id===E);let W=null==L?void 0:L.children.find(e=>e.id===w),H=(0,u.useMemo)(()=>k===eQ&&0===R.length,[k,R.length]);(0,u.useEffect)(()=>{void 0!==o&&V()},[o]);let V=async()=>{F(!0);try{let e=[(0,ea.P)({language:r,system:!0})];o&&e.unshift((0,ea.P)({language:r,system:!1}));let t=await Promise.all(e),s=o?t[1]:t[0],a=o?t[0]:{success:!0,data:[]};(null==a?void 0:a.success)||q.Z.error((null==a?void 0:a.error)||n("error.get_user_templates_failed")),(null==s?void 0:s.success)||q.Z.error((null==s?void 0:s.error)||n("error.get_system_templates_failed"));let i=[...(null==a?void 0:a.data)||[],...((null==s?void 0:s.data)||[]).filter(e=>e.category)],c=J(i),d={id:"all",icon:(0,l.jsx)(et.Z,{className:"h-4 w-4"}),title:n("agent.all"),children:s.data||[]};f([d,...c]),Y()}catch(e){q.Z.error(n("error.get_templates_failed"))}finally{F(!1)}},Y=async()=>{if(!s||!b.current)return;S(eQ);let e=null;if(b.current.map(t=>{t.children.map(t=>{t.id===s.id&&(e=t)})}),e)X(e);else{let e={introduction:s.introduction,title:s.title,sub_topics:s.sub_topics,placeholder:s.placeholder,params:s.params,template_type:ei.W.CUSTOM,lang:r},t=await (0,ea.YX)(e);if(t.data){q.Z.success(n("agent.add_share_template_success")),Q(t.data);let e=window.location.pathname;history.replaceState({},"",e)}}},J=(0,u.useCallback)(e=>{let t=e.filter(e=>!e.system),s=e.filter(e=>e.system),a={id:eQ,icon:(0,l.jsx)(es.Z,{className:"h-4 w-4"}),title:n("my_templates"),children:t};return!o&&x.length&&a.children.unshift(...x),[a,...Object.entries(s.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{})).map((e,t)=>{let[s,l]=e;return{id:s.toLowerCase().replace(/\s+/g,"-"),icon:e$[t],title:s,children:l}})]},[n]),X=e=>{Z(e.id),I(e)},G=()=>{D(!1),N("")},K=()=>{I(void 0)},$=async e=>{let t=e.sub_topics.filter(e=>{var t;return e.source_type===U.RQ&&(null===(t=e.source_info)||void 0===t?void 0:t.is_self)===!1});if(t&&t.length>0){let s=await (0,ea.hi)(e.short_id);if(s.data&&s.data.length>0&&!t.every(e=>{var t;return null===(t=s.data)||void 0===t?void 0:t.some(t=>t.short_id===e.source_id&&"PUBLIC"===t.permission.read_permission)})){B();return}}null==i||i(e),(0,eb.fk)(e.system?ej.U.AGENT_SEARCH_USE:ej.U.AGENT_CREATE_USE,{value:1},!0)},Q=e=>{if(!b.current)return;let t=[...b.current];t.map(t=>{t.id===eQ&&t.children.unshift(e)}),f(t),S(eQ),z(!1),G(),X(e)},ee=e=>{var t;let s=[...g];s.map(t=>{t.id===eQ&&t.children.map(t=>{t.id===e.id&&(t.title=e.title,t.description=e.introduction,t.placeholder=e.placeholder,t.sub_topics=e.sub_topics,t.params=e.params,t.template_type=e.template_type)})}),f(s);let l=null===(t=s.find(e=>e.id===eQ))||void 0===t?void 0:t.children.find(t=>t.id===e.id);l&&X(l),G()},eo=e=>{let t=[...g];t.map(t=>{t.id===eQ&&(t.children=t.children.filter(t=>t.id!==e))}),f(t),Z(null),G(),K(),c===e&&d().push("/")},ed=async e=>{null==a||a(!1),d().push((0,h.MD)({query:"",multiQuery:e.map(e=>({query:e,category:v.Z.getState().extensionSelected}))}))};return(0,l.jsxs)("div",{className:"flex px-2 border-t min-h-[500px] max-h-[80vh] min-w-[900px] h-[550px] overflow-hidden",children:[(0,l.jsxs)("div",{className:(0,m.cn)("flex-none border-r p-4 min-w-[200px] flex flex-col overflow-y-auto scrollbar",(T||j)&&"opacity-50 pointer-events-none"),children:[(0,l.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,l.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n("agent.recommend_templates")}),C?(0,l.jsxs)("section",{className:"space-y-3",children:[(0,l.jsx)(er.X,{className:"rounded-lg w-full h-8"}),(0,l.jsx)(er.X,{className:"rounded-lg w-full h-8"}),(0,l.jsx)(er.X,{className:"rounded-lg w-full h-8"})]}):g.map(e=>e.id===eQ?null:(0,l.jsxs)("div",{className:"flex items-center gap-2 rounded px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 ".concat(k===e.id?"bg-gray-100 dark:bg-gray-600":""),onMouseEnter:()=>{z(!1),S(e.id),k!==e.id&&(Z(null),G(),K())},children:[e.icon,(0,l.jsx)("span",{children:e.title})]},e.id))]}),(0,l.jsx)("div",{className:"flex-none",children:(0,l.jsxs)(p.z,{variant:"outline",className:(0,m.cn)("w-full flex items-center gap-2",k===eQ&&"bg-gray-100 dark:bg-gray-600"),onMouseEnter:()=>{z(!1),S(eQ),k!==eQ&&(Z(null),G(),K())},children:[(0,l.jsx)(es.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:n("my_templates")})]})})]}),(0,l.jsxs)("div",{className:(0,m.cn)("flex-none p-4 space-y-2 border-r max-w-[30%] overflow-y-auto scrollbar",!(null==L?void 0:L.children.length)&&"hidden",(T||j)&&"opacity-50 pointer-events-none"),children:[k===eQ&&o&&(0,l.jsxs)(p.z,{variant:"outline",className:(0,m.cn)("w-full flex items-center gap-2",A&&"bg-gray-100 dark:bg-gray-600"),onMouseEnter:()=>{z(!0)},children:[(0,l.jsx)(el.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:n("agent.add_template")})]}),null==L?void 0:L.children.map(e=>(0,l.jsx)("div",{className:"rounded px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600 ".concat(E!==e.id||A?"":"bg-gray-100 dark:bg-gray-600"),onClick:()=>{$(e)},onMouseEnter:()=>{z(!1),X(e)},children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"truncate",children:e.title}),!o&&!e.system&&(0,l.jsx)("span",{className:"px-1.5 py-0.5 text-xs rounded bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 whitespace-nowrap",children:n("temp")})]})},e.id))]}),(0,l.jsx)("div",{className:"flex-1 relative flex flex-col overflow-y-auto scrollbar",children:H||A||!P?(0,l.jsx)(eY,{loading:C,isCreating:j,setIsCreating:y,onCreate:Q}):(0,l.jsx)("section",{className:"flex-1 h-full",children:[ei.W.CUSTOM,ei.W.DIRECT_DUTY].includes(P.template_type)?(0,l.jsx)(eq,{dafaultTemplate:P,onCreate:Q,onDelete:eo,onUpdate:ee,onConfirm:$,onCancel:()=>{}}):(0,l.jsx)(eP,{defaultItem:P,isUsing:!!(null==W?void 0:W.id),isEditing:T,setIsEditing:D,onSubmit:ed,tooltipOpen:B,callbacks:{onBack:G,onConfirm:$,onCreate:Q,onDelete:eo,onUpdate:ee}},E)})}),P&&(0,l.jsx)(eG,{isOpen:M,handleEdit:()=>{D(!0),O()},onClose:O,onDelete:eo,defaultItem:P})]})};s(79395);var e1=s(55994),e2=s(44509),e5=s(17436),e4=s(54047),e6=e=>{let{open:t,onOpenChange:s,onConfirm:a}=e,i=(0,_.useTranslations)(),{query:n,isReady:r}=(0,c.useRouter)();(0,ec.ZP)(e=>e.isLogin);let{tempTemplates:o,addTempTemplate:d}=(0,eX.Z)(),{getList:m,inited:h}=(0,e5.Z)(),[p,x]=(0,u.useState)(void 0),g=(0,u.useRef)(null),{setShowAgentLimitModal:v,setShowLimitModalData:f}=(0,e4.Z)();return(0,u.useEffect)(()=>{!h&&t&&m()},[h,t]),(0,u.useEffect)(()=>{p&&sessionStorage.setItem(e1.o.AGENT_SHARE_TEMPLATE_ID,p.short_id)},[p]),(0,u.useEffect)(()=>{!t&&p&&x(void 0)},[t]),(0,l.jsx)(Y.Vq,{open:t,onOpenChange:s,children:(0,l.jsxs)(Y.cZ,{className:"max-w-5xl w-full max-h-full",ref:g,"aria-describedby":void 0,children:[(0,l.jsx)(Y.fK,{children:(0,l.jsx)(Y.$N,{children:i("extension.search_agent")})}),(0,l.jsx)(e0,{template:p,onOpenChange:s,onConfirm:e=>{if(!g.current)return;let t=C.Z.getState().isOpenThreadModal?"modal_search_form":"default_search_form";(0,e2.T)(g.current,t,()=>{null==a||a(e)})}})]})})},e3=s(37766),e7=s(75963);let e9=[U.zA,U.xn,U.X7];var e8=e=>{var t;let{isDisalbedExtension:s}=e,a=(0,_.useTranslations)(),i=(0,e7.useRouter)(),n=(0,e7.usePathname)(),r=(0,u.useRef)(!0),[o,c]=(0,u.useState)(!1),[d,h]=(0,u.useState)(!1),{isMobile:p,isReady:g}=(0,y.Z)(),f=(0,v.Z)(e=>e.extensionEnable),b=(0,v.Z)(e=>e.extensionSelected),j=(0,eX.Z)(e=>e.template),w=(0,eX.Z)(e=>e.setTemplate);(0,v.Z)(e=>e.extensionSelectedLoading),(0,v.Z)(e=>e.extensionSelectedErrorMsg);let N=(0,v.Z)(e=>e.setExtensionEnable),k=(0,v.Z)(e=>e.setExtensionSelectedLoading),S=()=>v.Z.getState().setExtensionError(void 0,""),{homeImages:Z,homeFiles:F,setPreviousSearchCategory:T}=(0,e3.Z)(),[D,Y]=(0,u.useState)(!1),J=[{value:U.gl,title:a("extension.all"),desc:a("extension.all_desc"),icon:(0,l.jsx)(E.Z,{size:20}),visible:!0,disable:!1},{value:U.aI,title:a("extension.chat"),desc:a("extension.chat_desc"),icon:(0,l.jsx)(P.Z,{size:20}),visible:!0,disable:!1},{value:U.pN,title:a("extension.social"),desc:a("extension.social_desc"),icon:(0,l.jsx)(I.Z,{size:20}),visible:!0,disable:!1},{value:U.Kp,title:a("extension.academic"),desc:a("extension.academic_desc"),icon:(0,l.jsx)(W.Od,{className:"w-5 h-5"}),visible:!0,disable:!1},{value:U.hs,title:a("extension.document"),desc:a("extension.document_desc"),icon:(0,l.jsx)(R.Z,{size:20}),visible:!0,disable:!1},{value:U.J5,title:a("extension.chat"),desc:a("extension.chat_desc"),icon:(0,l.jsx)(P.Z,{size:20}),visible:!1,disable:!1},{value:U.Ys,title:a("extension.chat"),desc:a("extension.chat_desc"),icon:(0,l.jsx)(P.Z,{size:20}),visible:!1,disable:!1}],X=[{value:U.X7,title:a("extension.twitter"),desc:s?a("extension.disable_to_topic"):a("extension.twitter_desc"),icon:(0,l.jsx)(W.iB,{className:"w-5 h-5"}),visible:!0,disable:!!s}];(0,V.Eg)()&&(J=J.filter(e=>e.value!==U.hs));let G=[...J,...X],K=e=>{let{setExtensionSelected:t,setExtensionError:s}=v.Z.getState();(0,B.ev)().then(l=>{(0,H.n4)(l,U.dP)>=0?e():(N(!1),t("google"),s(void 0,O.e.AdvancedAssistantDisable))}).catch(e=>{N(!1),t("google"),s(void 0,O.e.AdvancedAssistantDisable)})},$=async e=>{let{setExtensionError:t,setExtensionSelected:s}=v.Z.getState(),{searchErrorModalVisible:l,setSearchErrorModalVisible:a}=C.Z.getState();if(!e9.includes(e)){c(!1),l||t(void 0,"");return}if(!f){c(!1),s("google"),t(void 0,O.e.AdvancedAssistantDisable),a(!0);return}k(!0);let i=!1;switch(e){case U.zA:await (0,B.i9)().then(s=>{s?(i=!0,S()):K(()=>{let{extensionEnable:s}=v.Z.getState();s&&(i=!0,t(e,O.e.LoginExpired))})});break;case U.xn:await new Promise(e=>{K(()=>{let{extensionEnable:t}=v.Z.getState();t&&(i=!0,S()),e(!0)})});break;case U.X7:await (0,B.lk)().then(s=>{let{extensionEnable:l}=v.Z.getState();s?(i=!0,S()):K(()=>{t(e,O.e.LoginExpired),l&&(i=!0)})})}k(!1),a(!i),c(!1),r.current=!1},Q=async e=>{if(T(e),g&&p&&(e===U.zA||e===U.X7||e===U.xn)){q.Z.info(a("useInBrowser"));return}let{setExtensionSelected:t}=v.Z.getState();t(e),e!==U.Wh&&(null==n?void 0:n.includes("/agents"))&&i.push("/search")},ee=async e=>{h(!1);let t=await (0,eA.Y)(e.title),s=(0,ez.b)(t);i.push("/agents/".concat(s,"-").concat(e.short_id))};return(0,u.useEffect)(()=>{if(s){o&&c(!1);return}void 0!==f&&$(b)},[f,b]),(0,u.useEffect)(()=>{!j&&(null!=n&&n.includes("/agents")||Q(J[0].value))},[]),(0,u.useEffect)(()=>{(null==F?void 0:F.length)||(null==Z?void 0:Z.length)?Y(!0):Y(!1)},[F,Z]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(z.J2,{open:o,onOpenChange:c,children:[(0,l.jsx)(x.e,{delay:0,closeDelay:0,content:D?a("searchAddition.switch_search_mode_tip"):a("extension.search_range_desc"),classNames:{content:["text-white bg-gray-600 dark:bg-[#353535]"]},isDisabled:D,children:(0,l.jsx)("div",{className:"max-w-fit",children:(0,l.jsx)(z.xo,{asChild:!0,children:(0,l.jsxs)(A.A,{variant:"light",size:"sm",className:"text-[#30394A] dark:text-[#FFFFFF] border-1 border-[#E6E9EF] dark:border-[#545D6F] px-2 py-2 gap-1 text-sm rounded-lg",disabled:D,color:"default",isDisabled:D,children:[(0,l.jsx)("span",{className:"max-w-[150px] truncate",children:j?j.title:null===(t=G.find(e=>e.value===b))||void 0===t?void 0:t.title}),o?(0,l.jsx)(L.Z,{className:"w-4 h-4"}):(0,l.jsx)(M.Z,{className:"w-4 h-4"})]})})})}),(0,l.jsx)(z.yk,{className:"w-auto p-0 rounded-xl shadow-lg",align:"start",children:(0,l.jsxs)("section",{className:"w-[40em] max-w-[90vw]",children:[(0,l.jsx)("h2",{className:"px-6 pt-4 text-xs font-semibold opacity-60",children:a("extension.search_range")}),(0,l.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-1 p-2 text-sm",children:G.slice(0,(0,V.vU)()?J.length:G.length).map((e,t)=>{if(!e.visible)return;let s=e.disable;return(0,l.jsxs)("button",{className:(0,m.cn)("rounded-lg p-4 text-left",s?"text-gray-400":"hover:bg-[#E6E9EF] dark:hover:bg-[#454E5D] cursor-pointer",!s&&b===e.value&&"text-blue-500"),autoFocus:!s&&b===e.value,onClick:e.onClick?e.onClick:()=>{s||(j&&w(void 0),Q(e.value))},children:[(0,l.jsxs)("span",{className:"flex items-center font-medium mb-1",children:[e.icon,(0,l.jsx)("span",{className:"ml-2",children:e.title}),e.isBeta&&(0,l.jsx)("span",{className:"ml-2 rounded text-gray-500 bg-gray-200 dark:bg-theme-bg-dark-300 px-2 py-0.5 text-xs",children:"Beta"})]}),(0,l.jsx)("span",{className:"opacity-50",children:e.desc})]},t)})})]})})]}),(0,l.jsx)(e6,{open:d,onOpenChange:h,onConfirm:ee})]})},te=e=>{let{isDisalbedExtension:t}=e,s=(0,_.useTranslations)(),a=(0,v.Z)(e=>e.extensionSelected),i=[{value:U.gl,title:s("extension.all"),isDisabled:!1},{value:U.pN,title:s("extension.social"),isDisabled:!1},{value:U.X7,title:s("extension.twitter"),isDisabled:t},{value:U.Kp,title:s("extension.academic"),isDisabled:!1},{value:U.aI,title:s("extension.chat"),isDisabled:!1},{value:U.hs,title:s("extension.document"),isDisabled:!1}],n=(e,t)=>{e.preventDefault();let{setExtensionSelected:s}=v.Z.getState();s(t)};return(0,l.jsxs)("div",{className:"px-4 py-3 text-sm border-t border-[#dbe2e9] dark:border-zinc-700",children:[(0,l.jsxs)("span",{className:"mr-4",children:[s("extension.search_range"),":"]}),i.map(e=>(0,l.jsx)("a",{href:"",className:(0,Z.Z)("mr-2",a===e.value?"text-blue-500":"text-zinc-400",e.isDisabled&&"cursor-not-allowed opacity-50"),onClick:t=>{if(e.isDisabled){t.preventDefault();return}n(t,e.value)},children:e.title},e.value))]})},tt=s(13263),ts=s(27585);let tl=(e,t)=>{let s=(0,ts.lx)(e);return Object.keys(t).forEach(e=>s.searchParams.append(e,t[e])),s.toString()};var ta=s(52166);let ti=e=>{let{query:t}=e,s=(0,ta.a1)();return fetch(tl("".concat(b.XJ,"/official-website"),{query:t}),{method:"GET",headers:{Authorization:"".concat(s)}}).then(async e=>200!==e.status?Promise.reject([]):await e.json()).catch(e=>[])};var tn=s(2240),tr=function(e){let{enable:t,value:s,debouncedValue:l,inputRef:a}=e;(0,_.useTranslations)();let[i,n]=(0,u.useState)([]),r=(0,tn.Z)(),[o,c]=(0,u.useState)([]),[d,m]=(0,u.useState)(-1),h=o.length>0||i.length>0&&i[0],p=e=>{a.current&&(-1===e?a.current.value=s:a.current.value=x[e].title)};(0,u.useEffect)(()=>{var e,i;if(!s||!t||v.Z.getState().extensionSelected===U.aI||v.Z.getState().extensionSelected===U.J5||v.Z.getState().extensionSelected===U.Ys||(null===(e=e3.Z.getState().homeImages)||void 0===e?void 0:e.length)||(null===(i=e3.Z.getState().files)||void 0===i?void 0:i.length)){n([]);return}l&&ti({query:s}).then(e=>{var t;(null===(t=a.current)||void 0===t?void 0:t.value)===s&&n(e)})},[l]),(0,u.useEffect)(()=>{var e,l;if(!s||!t||v.Z.getState().extensionSelected===U.aI||v.Z.getState().extensionSelected===U.J5||(null===(e=e3.Z.getState().files)||void 0===e?void 0:e.length)||v.Z.getState().extensionSelected===U.Ys||(null===(l=e3.Z.getState().homeImages)||void 0===l?void 0:l.length)){c([]);return}(0,tt.a5)({keywords:s}).then(e=>{var t;(null===(t=a.current)||void 0===t?void 0:t.value)===s&&c(e)}).catch(e=>{console.warn("getQuestion Error:",e)})},[l]),(0,u.useEffect)(()=>{m(-1)},[s]);let x=(0,u.useMemo)(()=>[{title:"traditionalSearch",type:"websearch"},...i.map(e=>({...e,type:"site"})),...o.map(e=>({title:e,type:"question"}))].splice(0,8),[o,i]);return{results:x,dropDownSelected:d,setDropDownSelected:m,showQueryDropdownMenu:h,reduceSearchResult:()=>{if(!r.current)return;let e=0;if(-1===d&&(e=x.length-1),d>-1&&(e=d-1),0===e){m(e);return}m(e),p(e)},addSearchResult:()=>{if(!r.current)return;let e=0;if(d===x.length-1&&(e=-1),d<x.length-1&&(e=d+1),0===e){m(e);return}m(e),p(e)}}},to=s(52597),tc=s(65105),td=s(96156),tu=s(84706),tm=s(12490),th=s(70113),tp=s(51054),tx=s(72070),tg=s.n(tx),tv=e=>{let{file:t}=e,{removeHomeImageSById:s}=(0,e3.Z)();return(0,l.jsxs)("div",{className:(0,Z.Z)("relative group","items-center justify-between gap-1 text-xs  text-gray-500 rounded","p-0","border border-gray-100","hover:bg-[#EDFAFF] dark:hover:bg-[#3E536E]"),children:[(0,l.jsx)("div",{className:"flex items-center gap-1",children:(0,l.jsxs)("div",{className:"w-16 h-16 flex items-center justify-center relative",children:[(0,l.jsx)(tg(),{className:(0,Z.Z)("object-cover","rounded","!w-full !h-full"),src:t.url,alt:t.title,width:72,height:72}),(0,l.jsx)("div",{className:(0,Z.Z)("absolute top-0 right-0","flex flex-col","w-full h-full","justify-center items-center","rounded","bg-gray-800/60","text-white text-xs",(null==t?void 0:t.status)!=="completed"?"flex":"hidden"),children:(null==t?void 0:t.status)=="error"?(0,l.jsx)(ep.Z,{className:"text-red-400"}):(null==t?void 0:t.progress)<=0?(0,l.jsx)(tp.Z,{size:"sm",classNames:{svg:"w-6 h-6",track:"stroke-white/80",label:"text-white"},"aria-label":"Loading..."}):(0,l.jsx)(tp.Z,{size:"sm",classNames:{svg:"w-6 h-6",track:"stroke-white/80",label:"text-white"},"aria-label":"Loading...",value:(null==t?void 0:t.progress)||0,showValueLabel:!0})})]})}),(null==t?void 0:t.status)==="completed"&&(0,l.jsx)("div",{className:(0,Z.Z)("absolute -top-2 -right-2","group-hover:block"),children:(0,l.jsx)(A.A,{size:"sm",radius:"full",className:(0,Z.Z)("p-0 m-0 h-4 w-4 min-w-0 min-h-0","border-0","bg-[#3D4C67] text-white/80","hover:bg-[#3D4C67] hover:opacity-100"),startContent:(0,l.jsx)(r.Z,{size:12,className:"rounded-full"}),onPress:()=>{s([null==t?void 0:t.id])}})})]})},tf=s(70262),t_=s(48518),tb=s(78236),tj=()=>{let e=(0,c.useRouter)(),t=(0,eX.Z)(e=>e.template),s=(0,v.Z)(e=>e.isResearch),l=(0,v.Z)(e=>e.extensionSelected),a=(0,v.Z)(e=>e.proSelected),i=(0,eX.Z)(e=>e.category),{homeFiles:n}=(0,tb.Z)(),r=(0,u.useMemo)(()=>U.iu.find(e=>e===l)&&a,[l,a]),o=(0,u.useMemo)(()=>{var e;return null==n?void 0:null===(e=n.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===e?void 0:e.length},[n]);return{goToSearchDetailPage:l=>{var a,n,c;let{query:d,category:u,action:m}=l;if(!d&&!t)return;let p={query:d};if(r&&s||t){if((null==t?void 0:t.template_type)===ei.W.CUSTOM){t_.Z.getState().setTemplateData({templateQuery:d,template:t});let e=t.sub_topics[0].source_type;p.category=e,p.model=t.sub_topics[0].llm_model,e===U.RQ&&(p.topicId=t.sub_topics[0].source_id)}else{eX.Z.getState().openAgentPlanModal(d);return}}if(!d)return;let x=(null===(a=e3.Z.getState().homeFiles)||void 0===a?void 0:a.filter(e=>!(null==e?void 0:e.threadId)))||[],g=null==x?void 0:x.filter(e=>(null==e?void 0:e.status)==="completed"),v=e3.Z.getState().homeImages||[],f=null==v?void 0:v.filter(e=>(null==e?void 0:e.status)==="completed");u===U.J5?(p.category=U.J5,p.documents=null==g?void 0:null===(n=g.map(e=>null==e?void 0:e.id))||void 0===n?void 0:n.join(",")):(p.category=U.Ys,p.documents=null==f?void 0:null===(c=f.map(e=>null==e?void 0:e.id))||void 0===c?void 0:c.join(",")),m&&(p.documentAction=m),t&&(p.templateId=t.id,p.category="long_text"===i&&o?U.J5:i);let _=(0,h.MD)(p);e.push(_,void 0,{scroll:!0})}}},ty=()=>{var e;let t=(0,_.useTranslations)(),{homeImages:s,homeImageSQustions:a,setIsGoToSearch:i,isGoToSearch:n}=(0,e3.Z)(),{goToSearchDetailPage:r}=tj(),{isOpenThreadModal:o,closeThreadModal:c}=(0,C.Z)(),{extensionSelected:d}=(0,v.Z)(),m=(0,v.Z)(e=>e.isResearch),h=e=>{let{query:t,action:s}=e;i(!0),!0===o&&c(),r({query:t,action:s})};return((0,u.useCallback)(()=>{i(!1)},[]),0===s.length)?null:(0,l.jsxs)("div",{className:(0,Z.Z)("px-0 pb-4 mx-3","flex flex-wrap gap-2 items-end","border-b border-[#dbe2e9]/60 dark:border-[#545D6F]"," bg-white dark:bg-transparent"),children:[s.map(e=>(0,l.jsx)(tv,{file:e},e.id)),d===U.Ys&&!m&&(null===(e=s.filter(e=>"completed"===e.status))||void 0===e?void 0:e.length)?(0,l.jsxs)("div",{className:"flex items-center gap-2 ml-2",children:[(0,l.jsx)(A.A,{color:"secondary",size:"sm",className:(0,Z.Z)("px-1 py-1.5 min-h-0 h-auto text-[#596B87]","bg-[#EDFAFF] dark:bg-[#25364DCC] dark:text-white/90"),onPress:()=>h({query:t(tf.Tp.answer),action:"explain"}),isDisabled:n,children:t(tf.Tp.answer)},"answer"),a.map(e=>(0,l.jsx)(A.A,{color:"secondary",size:"sm",className:(0,Z.Z)("px-1 py-1.5 min-h-0 h-auto text-[#596B87]","bg-[#EDFAFF] dark:bg-[#25364DCC]  dark:text-white/90"),onPress:()=>h({query:t(tf.Tp[e.type]),action:e.type}),isDisabled:n,children:t(tf.Tp[e.type])},e.type))]}):null]})},tw=s(64412),tN=e=>{var t;let{file:s}=e,a=(0,_.useTranslations)(),{removeHomeFilesById:i}=(0,e3.Z)();return(0,l.jsxs)("div",{className:(0,Z.Z)("relative group","items-center justify-between gap-1 text-xs  text-gray-500 rounded","p-0","bg-gray-50 dark:bg-gray-700"),children:[(0,l.jsx)("div",{className:"flex items-center",children:(0,l.jsxs)("div",{className:"max-w-52 flex items-center justify-start relative p-2 ",children:[(0,l.jsx)("div",{className:"w-5",children:(0,l.jsx)(tw.Z,{fileName:s.title,w:5,h:5})}),(0,l.jsxs)("div",{className:"ml-2",children:[(0,l.jsx)("div",{className:"text-sm truncate w-36 dark:text-white/90",children:s.title}),(0,l.jsxs)("div",{className:"text-[12px] text-gray-400 ",children:[(null==s?void 0:s.type)?"".concat(null===tf.Sj||void 0===tf.Sj?void 0:null===(t=tf.Sj[s.type])||void 0===t?void 0:t.toLocaleUpperCase()," / "):"",(0,tf.cn)(s.size)," ",(null==s?void 0:s.pages)?"/ ".concat(a("searchAddition.file_pages",{pages:s.pages})):""]})]}),(0,l.jsx)("div",{className:(0,Z.Z)("absolute top-0 right-0","flex flex-col","w-full h-full","justify-center items-center","rounded","bg-gray-800/60","text-white text-xs",(null==s?void 0:s.status)!=="completed"?"flex":"hidden"),children:(null==s?void 0:s.status)=="error"?(0,l.jsx)(ep.Z,{className:"text-red-400"}):(null==s?void 0:s.progress)<=0?(0,l.jsx)(tp.Z,{size:"sm",classNames:{svg:"w-6 h-6",track:"stroke-white/80",label:"text-white"},"aria-label":"Loading..."}):(0,l.jsx)(tp.Z,{size:"sm",classNames:{svg:"w-6 h-6",track:"stroke-white/80",label:"text-white"},"aria-label":"Loading...",value:(null==s?void 0:s.progress)||0,showValueLabel:!0})})]})}),(null==s?void 0:s.status)==="completed"&&(0,l.jsx)("div",{className:(0,Z.Z)("absolute -top-2 -right-2","group-hover:block"),children:(0,l.jsx)(A.A,{size:"sm",radius:"full",className:(0,Z.Z)("p-0 m-0 h-4 w-4 min-w-0 min-h-0","border-0","bg-[#3D4C67] text-white/80","hover:bg-[#3D4C67] hover:opacity-100"),startContent:(0,l.jsx)(r.Z,{size:12,className:"rounded-full"}),onPress:()=>{i([null==s?void 0:s.id])}})})]})},tk=s(78017),tS=()=>{var e;let t=(0,_.useTranslations)(),{homeFiles:s,setIsGoToSearch:a,isGoToSearch:i,isUploading:n}=(0,e3.Z)(),{goToSearchDetailPage:r}=tj(),{isOpenThreadModal:o,closeThreadModal:c}=(0,C.Z)(),{extensionSelected:d}=(0,v.Z)(),m=(0,v.Z)(e=>e.isResearch),h=(0,eX.Z)(e=>e.template),p=(0,u.useMemo)(()=>!!h&&!!h.code&&[tk.m5,tk.PZ].includes(h.code),[h]),x=e=>{let{query:t}=e;a(!0),!0===o&&c(),r({query:t,category:U.J5,action:"summary"})};return((0,u.useEffect)(()=>{a(!1)},[]),0===s.length)?null:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:(0,Z.Z)("px-0 pt-2 pb-4","flex flex-nowrap gap-3 items-end w-[calc(100%-30px)] overflow-x-auto"," bg-white dark:bg-transparent","scrollbar"),children:[s.map(e=>(0,l.jsx)(tN,{file:e},e.id)),!p&&d===U.J5&&(null==h?void 0:h.template_type)!==ei.W.DIRECT_DUTY&&!m&&(null===(e=s.filter(e=>"completed"===e.status))||void 0===e?void 0:e.length)>0&&(0,l.jsx)("div",{className:"flex items-center gap-2 ml-2",children:(0,l.jsx)(A.A,{color:"secondary",size:"sm",className:(0,Z.Z)("px-1 py-1.5 min-h-0 h-auto text-[#596B87] bg-[#EDFAFF]","dark:bg-[#25364DCC] dark:text-white/90"),onPress:()=>x({query:t("searchAddition.summary_file")}),isDisabled:i||n,children:t("searchAddition.summary_file")},"answer")})]}),(0,l.jsx)("hr",{className:(0,Z.Z)("mt-0 mb-4 border-0","h-[1px] overflow-hidden","bg-[#dbe2e9]/60 dark:bg-[#545D6F]")})]})},tE=s(56885),tZ=s(26894),tC=s(88708),tF=s(39109),tT=s(31510),tD=s(13366),tA=s(26949),tz=e=>{let{value:t,label:s,icon:a}=e;return(0,l.jsxs)(tA.SP,{value:t,className:(0,Z.Z)("gap-1 px-2","rounded-full text-[#8896AA] text-xs h-8 font-normal rounded-md","data-[state=active]:bg-[#FFFFFF] data-[state=active]:shadow-none data-[state=active]:text-primary","dark:data-[state=active]:bg-[#353B46]"),children:[a,s]})},tP=s(37067),tI=s(6967),tR=s(25568),tL=s(31162),tM=e=>{var t;let{file:s}=e,a=(0,_.useTranslations)(),{removeHomeFilesById:i}=(0,tb.Z)();return(0,l.jsxs)("div",{className:(0,Z.Z)("relative group","items-center justify-between gap-1 text-xs  text-gray-500 rounded","p-0","bg-[#F7F7F9] dark:bg-[#374251]"),children:[(0,l.jsx)("div",{className:"flex items-center",children:(0,l.jsxs)("div",{className:"max-w-52 flex items-center justify-start relative p-2 h-14",children:[(0,l.jsx)("div",{className:"w-5",children:(0,l.jsx)(tw.Z,{fileName:s.title,w:5,h:5})}),(0,l.jsxs)("div",{className:"ml-2",children:[(0,l.jsx)("div",{className:(0,Z.Z)("text-sm truncate dark:text-white/90","sm:w-36 w-20"),children:s.title}),(0,l.jsxs)("div",{className:"text-[12px] text-gray-400 ",children:[(null==s?void 0:s.type)?"".concat(null===tf.Sj||void 0===tf.Sj?void 0:null===(t=tf.Sj[s.type])||void 0===t?void 0:t.toLocaleUpperCase()," / "):"",(0,tf.cn)(s.size)," ",(null==s?void 0:s.pages)?"/ ".concat(a("searchAddition.file_pages",{pages:s.pages})):""]})]}),(0,l.jsx)("div",{className:(0,Z.Z)("absolute top-0 right-0","flex flex-col","w-full h-full","justify-center items-center","rounded","bg-gray-800/60","text-white text-xs",(null==s?void 0:s.status)!=="completed"?"flex":"hidden"),children:(null==s?void 0:s.status)=="error"?(0,l.jsx)(ep.Z,{className:"text-red-400"}):(null==s?void 0:s.progress)<=0?(0,l.jsx)(tp.Z,{size:"sm",classNames:{svg:"w-6 h-6",track:"stroke-white/80",label:"text-white"},"aria-label":"Loading..."}):(0,l.jsx)(tp.Z,{size:"sm",classNames:{svg:"w-6 h-6",track:"stroke-white/80",label:"text-white"},"aria-label":"Loading...",value:(null==s?void 0:s.progress)||0,showValueLabel:!0})})]})}),(null==s?void 0:s.status)==="completed"&&(0,l.jsx)("div",{className:(0,Z.Z)("absolute -top-2 -right-2","group-hover:block"),children:(0,l.jsx)(A.A,{size:"sm",radius:"full",className:(0,Z.Z)("p-0 m-0 h-4 w-4 min-w-0 min-h-0","border-0","bg-[#3D4C67] text-white/80","hover:bg-[#3D4C67] hover:opacity-100"),startContent:(0,l.jsx)(r.Z,{size:12,className:"rounded-full"}),onPress:()=>{i([null==s?void 0:s.id])}})})]})},tU=()=>{let e=(0,tb.Z)(e=>e.homeFiles);return 0===e.length?null:(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("div",{className:(0,Z.Z)("p-0 m-0 pt-2"," relative z-10","flex flex-nowrap gap-3 items-end w-[calc(100%-30px)] overflow-x-auto","bg-white dark:bg-transparent","scrollbar"),children:e.map(e=>(0,l.jsx)(tM,{file:e},e.id))})})},tB=s(41223),tO=s(38058);let tW=e=>{let{type:t="home",threadId:s}=e,l=(0,_.useTranslations)(),a=(0,tF.Z)(),i=(0,tc.WI)(),n=(0,tc.P2)(),r=(0,tc.Oi)("chatDocumentsUsage"),{homeFiles:o,files:c,threadFiles:d,setHomeFiles:m,setFiles:h,setIsUploading:p,setCurrentFileProgress:x,setNThUpload:g}=(0,tb.Z)(),v=()=>"home"===t?tb.Z.getState().homeFiles:tb.Z.getState().files,f=(0,u.useMemo)(()=>r?tf.Mr:tf.CD,[r]),b=(0,u.useMemo)(()=>{if(!r){var e,t;return(null!==(t=null==n?void 0:null===(e=n.chatDocumentsUsage)||void 0===e?void 0:e.balance)&&void 0!==t?t:0)<=0}return!1},[null==n?void 0:n.chatDocumentsUsage,r]),j=()=>{var e,s;return"home"===t?(null===(e=tb.Z.getState().homeFiles)||void 0===e?void 0:e.length)||0:(null===(s=tb.Z.getState().files)||void 0===s?void 0:s.length)||0},y=e=>{let{type:t}=e,l="home"===t?tb.Z.getState().homeFiles:tb.Z.getState().files,a=tb.Z.getState().threadFiles;return Array.from(new Set([...(s?(null==l?void 0:l.filter(e=>(null==e?void 0:e.threadId)===s))||[]:(null==l?void 0:l.filter(e=>!(null==e?void 0:e.threadId)))||[]).map(e=>null==e?void 0:e.id),...(s&&(null==a?void 0:a.filter(e=>(null==e?void 0:e.threadId)===s))||[]).map(e=>null==e?void 0:e.id)]))},w=(0,u.useMemo)(()=>{var e;return(null===(e=y({type:t}))||void 0===e?void 0:e.length)>f},[f]),N=(0,u.useMemo)(()=>i?tf.fc:tf.r0,[i]),k=(0,u.useMemo)(()=>{let e="home"===t?o||[]:c||[],l=s&&(null==d?void 0:d.filter(e=>(null==e?void 0:e.threadId)===s))||[];return Array.from(new Set([...e,...l].map(e=>e.id))).map(t=>[...e,...l].find(e=>e.id===t)).reduce((e,t)=>{var s;return e+(null!==(s=null==t?void 0:t.words)&&void 0!==s?s:0)},0)>N},[t,o,c,s,d,N]),S=(0,u.useMemo)(()=>i?l("searchAddition.max_words"):l("searchAddition.max_words_free"),[i]),E=e=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/plain"].includes(e.type)?e.size>26214400?(a.default(l("searchAddition.size_limit_exceeded_tip",{size:25,pages:500})),!1):k?(a.default(l("searchAddition.thread_words_limit_exceeded_tip",{words:S})),!1):!w||(i||tu.$.publish("showSubscriptionPlan",void 0),a.default(l("searchAddition.thread_upload_limit_exceeded_tip",{count:f})),!1):(a.default(l("topic.error_file_type_not_supported")),!1),Z=e=>{var s;let l=null!==(s=tb.Z.getState().currentFileProgress)&&void 0!==s?s:0,a=setInterval(()=>{var s,i;let n=v();l=(null!==(i=null===(s=n.find(t=>t.id===e))||void 0===s?void 0:s.progress)&&void 0!==i?i:l)+(1.9*Math.random()+.1),"home"===t?m(n.map(t=>t.id===e?{...t,progress:Math.min(l,95),status:"analyzing"}:t)):h(n.map(t=>t.id===e?{...t,progress:Math.min(l,95),status:"analyzing"}:t)),l>=95&&clearInterval(a)},800);return a};return{handleFiles:async e=>{var n,r,o,c,d;if(tb.Z.getState().isUploading)return;if(b){a.default(l("searchAddition.upload_limit_exceeded_tip")),tu.$.publish("showSubscriptionPlan",void 0);return}if(w)return;let u=null===(n=y({type:t}))||void 0===n?void 0:n.length;if((null!==(r=null==e?void 0:e.length)&&void 0!==r?r:0)+u>f){if(!i){tu.$.publish("showSubscriptionPlan",void 0);return}a.default(l("searchAddition.thread_upload_limit_exceeded_tip",{count:f}));return}g((null!==(o=tb.Z.getState().nThUpload)&&void 0!==o?o:0)+1);let _=Array.from(e);for(let[e,l]of(p(!0),Array.from(_).entries())){let a=v(),i=null!==(c=tb.Z.getState().nThUpload)&&void 0!==c?c:0,n="".concat(i,"_").concat(e),r=[{id:n,title:l.name,size:(0,tf.sS)(l.size),token:0,pages:0,progress:0,status:"uploading",type:l.type,created_at:new Date().toISOString(),modified_at:new Date().toISOString(),length:0,words:0,threadId:s||"",tempId:n}];"home"===t&&m([...r,...a])}let C=new Map;for(let[e,n]of Array.from(_).entries()){let r=null!==(d=tb.Z.getState().nThUpload)&&void 0!==d?d:0,o="".concat(r,"_").concat(e);p(!0),x(0);try{if(await (0,tO.Wl)()){if(i?a.default(l("searchAddition.upload_limit_exceeded_tip")):tu.$.publish("showSubscriptionPlan",void 0),p(!1),x(0),"home"===t){let e=v();m((0,tf._n)({files:e,tempId:o}))}continue}}catch(e){if(a.default(l("server.INTERNAL_SERVER_ERROR")),p(!1),x(0),"home"===t){let e=v();m((0,tf._n)({files:e,tempId:o}))}continue}let c="";if(!E(n)){if("home"===t){let e=v();m((0,tf._n)({files:e,tempId:o}))}p(!1),x(0);continue}(0,eb.fk)(ej.U.SEAECH_FILE,{fileName:n.name},!0),p(!0);let u=(0,tf.ct)(0,e=>{if(x(null!=e?e:0),"home"===t){let t=v();m((0,tf._n)({files:t,tempId:o})),m(t.map(t=>t.tempId===o?{...t,progress:e}:t))}});"1"!==(0,tf.y6)()&&(0,tf.ny)();try{C.set(n.name,!0),await (0,eT.Vj)({file:n,threadId:s||"",queryParams:"application/pdf"===n.type?{from:"agent"}:void 0,onProgress:l=>{if(c||(c=l.file_id),!C.has(c)){var a,i;let r=null!==(a=tb.Z.getState().nThUpload)&&void 0!==a?a:0,o=v(),d="home"===t?o.map(t=>t.tempId==="".concat(r,"_").concat(e)?{...t,id:c}:t):[{id:c,title:n.name,size:(0,tf.sS)(n.size),token:0,pages:0,progress:null!==(i=tb.Z.getState().currentFileProgress)&&void 0!==i?i:0,status:"uploading",type:n.type,created_at:new Date().toISOString(),modified_at:new Date().toISOString(),length:(null==l?void 0:l.length)||0,words:(null==l?void 0:l.words)||0,threadId:s||""}];"home"===t?m([...d]):h([...d,...o]);let u=Z(c);C.set(c,u),C.delete(n.name)}},onDone:e=>{if(u(),C.has(c)&&(clearInterval(C.get(c)),C.delete(c)),(null==e?void 0:e.status)==="SUCCESS"){var s;let i=v(),n=i.reduce((e,t)=>{var s;return e+(null!==(s=null==t?void 0:t.words)&&void 0!==s?s:0)},0);if(k||n+(null!==(s=null==e?void 0:e.words)&&void 0!==s?s:0)>N){if(a.default(l("searchAddition.thread_words_limit_exceeded_tip",{words:S})),"home"===t){let e=v();m((0,tf.mF)({files:e,id:c}))}else h([...(0,tf.mF)({files:i,id:c})]);p(!1);return}"home"===t?m(i.map(t=>t.id===c?{...t,progress:100,words:(null==e?void 0:e.words)||0,pages:(null==e?void 0:e.page_count)||0,status:"completed"}:t)):h(i.map(t=>t.id===c?{...t,progress:100,words:(null==e?void 0:e.words)||0,pages:(null==e?void 0:e.page_count)||0,status:"completed"}:t)),p(!1);return}(null==e?void 0:e.status)==="PAGE_OVER_SIZE"?a.default(l("searchAddition.page_limit_exceeded_tip",{pages:"500"})):a.default(l("server.INTERNAL_SERVER_ERROR"));let i=v();"home"===t?m((0,tf.mF)({files:i,id:c})):h([...(0,tf.mF)({files:i,id:c})]),p(!1),x(0)},onError:()=>{a.default(l("server.INTERNAL_SERVER_ERROR")),u(),C.delete(n.name),0===C.size&&p(!1);let e=v();"home"===t?m((0,tf.mF)({files:e,id:c})):h([...(0,tf.mF)({files:e,id:c})]),x(0)}})}catch(s){u(),a.default(l("server.INTERNAL_SERVER_ERROR")),p(!1),x(0);let e=v();"home"===t?m((0,tf.mF)({files:e,id:c})):h([...(0,tf.mF)({files:e,id:c})])}}j()||x(0)},validateFile:E,currentFilesList:v,isInsufficientBalance:b,isDraggingDisabled:w,MAX_FILE_COUNT:f,isLimitExceeded:k}},tH=(0,u.forwardRef)((e,t)=>{let{value:s,threadId:a,type:i="home",hiddenButton:n}=e,r=(0,_.useTranslations)(),o=(0,tc.WI)(),c=(0,tF.Z)(),{homeFiles:d}=(0,tb.Z)(),m=(0,ec.ZP)(e=>e.isLogin),[h,x]=(0,u.useState)(!1),[g,v]=(0,u.useState)(!1),f=(0,u.useRef)(null),{handleFiles:b,isInsufficientBalance:j,isDraggingDisabled:y,MAX_FILE_COUNT:w}=tW({type:i,threadId:a});return(0,u.useImperativeHandle)(t,()=>({handleFiles:b})),(0,l.jsx)(tA.nU,{className:"p-0 m-0",value:s,children:(0,l.jsxs)("div",{className:"ml-3 flex gap-3",children:[!n&&(0,l.jsxs)("div",{className:"max-w-fit relative pt-2",children:[(0,l.jsx)("input",{type:"file",ref:f,className:"hidden",multiple:!0,accept:".pdf,.doc,.docx,.txt,.xls,.xlsx,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:e=>{let{files:t}=e.target;t&&b(t),e.target.value=""}}),(0,l.jsxs)(p.z,{variant:"secondary",size:"lg",className:(0,Z.Z)("sm:px-6 px-3",(null==d?void 0:d.length)?"h-14":"h-10","bg-[#F7F7F9] dark:bg-[#374251]"),onClick:e=>{var t;if(e.preventDefault(),(0,tB.s2)()){v(!0);return}if(!m){C.Z.getState().setLoginModalVisible(!0);return}if(j){tu.$.publish("showSubscriptionPlan",void 0);return}if(y){o||tu.$.publish("showSubscriptionPlan",void 0),c.default(r("searchAddition.thread_upload_limit_exceeded_tip",{count:w}));return}null===(t=f.current)||void 0===t||t.click()},children:[(0,l.jsx)(tL.Z,{}),r("agentConfig.add_file")]})]}),(0,l.jsx)(tU,{})]})})});var tV=e=>{var t,s;let{topTabType:a,setTopTabType:i}=e,n=(0,_.useTranslations)(),r=(0,eX.Z)(e=>e.template),o=(0,eX.Z)(e=>e.setCategory),c=(0,u.useRef)(null),d=(0,u.useMemo)(()=>{var e,t;return(null==r?void 0:null===(t=r.tool_config)||void 0===t?void 0:null===(e=t.top_bar)||void 0===e?void 0:e.top_bar_list)||[]},[null==r?void 0:null===(s=r.tool_config)||void 0===s?void 0:null===(t=s.top_bar)||void 0===t?void 0:t.top_bar_list]),m=(0,u.useCallback)(e=>d.find(t=>t.type===e),[d]);return(0,u.useEffect)(()=>{o(a)},[a]),(0,l.jsxs)(tA.mQ,{value:a,onValueChange:e=>{console.log("onValueChange",e),i(e),o(e)},children:[(0,l.jsx)("div",{className:"group -mt-[6px] flex justify-between items-center rounded-t-xl pb-0 border-[#EBEEF3] dark:border-[#545D6F]",children:(0,l.jsx)("div",{className:(0,Z.Z)("w-full flex items-center text-sm text-gray-400 overflow-hidden gap-2","overflow-x-auto scrollbar"),children:(0,l.jsxs)(tA.dr,{className:"bg-[#F6F7F9] dark:bg-[#454E5D] p-1 rounded-lg relative z-0",children:[m(U.gl)?(0,l.jsx)("div",{onClick:()=>i(U.gl),children:(0,l.jsx)(tz,{value:U.gl,label:n("agentConfig.ask_anything"),icon:(0,l.jsx)(tP.Z,{className:"w-4"})})}):null,m(U.J5)?(0,l.jsx)("div",{onClick:()=>i(U.J5),children:(0,l.jsx)(tz,{value:U.J5,label:n("agent.document"),icon:(0,l.jsx)(tR.nr,{className:(0,Z.Z)("w-4")})})}):null,m("long_text")?(0,l.jsx)("div",{onClick:()=>i("long_text"),children:(0,l.jsx)(tz,{value:"long_text",label:n("agentConfig.long_text"),icon:(0,l.jsx)(R.Z,{className:"w-4"})})}):null,m(U.V9)?(0,l.jsx)("div",{onClick:()=>i(U.V9),children:(0,l.jsx)(tz,{value:U.V9,label:n("agentConfig.webpage"),icon:(0,l.jsx)(S.Z,{className:"w-4"})})}):null,m(U.rN)?(0,l.jsxs)("div",{onClick:()=>i(U.rN),children:[(0,l.jsx)(tz,{value:U.rN,label:n("agentConfig.youtube"),icon:(0,l.jsx)(tI.Z,{className:"w-5"})})," "]}):null]})})}),(0,l.jsx)(tH,{value:U.J5}),(0,l.jsx)(tH,{value:U.SH,hiddenButton:!0,ref:c})]})},tq=s(32700),tY=s(25773),tJ=s(28818),tX=s(40203),tG=s(15893),tK=s(62796);let t$=e=>e.map(e=>{var t,s;return"mcp_services"===e.name&&(null===(t=e.config)||void 0===t?void 0:t.list)?{...e,config:{...e.config,list:e.config.list.map(e=>{if("user"===e.attribution){let{select_status:t,...s}=e;return s}return e})}}:"external_tool_services"===e.name&&(null===(s=e.config)||void 0===s?void 0:s.list)?{...e,config:{...e.config,list:e.config.list.map(e=>{if("user"===e.attribution){let{select_status:t,...s}=e;return s}return e})}}:e});var tQ=e=>{let{visible:t,onClose:s,template:a,mcpServices:i,onMcpServicesUpdate:n,selectedTools:r,onAuthStatusUpdate:o,localAuthStatus:c,isCreator:d=!1}=e,m=(0,_.useTranslations)(),h=(0,tF.Z)(),p=(0,tG.n)(m),[x,g]=(0,u.useState)(!1),[v,f]=(0,u.useState)(""),[b,j]=(0,u.useState)(""),[y,w]=(0,u.useState)(""),[N,k]=(0,u.useState)(null),[S,E]=(0,u.useState)(!1),[Z,C]=(0,u.useState)(),[F,T]=(0,u.useState)(!1),[D,A]=(0,u.useState)(null),[z,P]=(0,u.useState)(null),I=(0,u.useMemo)(()=>p.map(e=>{var t,s,l,a;let i=r.find(t=>t.external_tool_id===e.id),n=null!==(s=null!==(t=c[e.id])&&void 0!==t?t:null==i?void 0:i.auth_status)&&void 0!==s&&s;return{...e,auth_status:n,scope_auth:null!==(l=null==i?void 0:i.scope_auth)&&void 0!==l?l:e.scope_auth,attribution:null!==(a=null==i?void 0:i.attribution)&&void 0!==a?a:e.attribution}}),[p,r,c]),R=async()=>{E(!0);try{k(!0)}catch(e){k(!1)}finally{E(!1)}},L=async()=>{if(!v.trim()||!b.trim())return;if(!(null==a?void 0:a.short_id)){q.Z.error(m("agent.mcp_missing_template_id"));return}let e={};if(y.trim())try{let t=JSON.parse(y.trim());if("object"!=typeof t||null===t||Array.isArray(t)){q.Z.error(m("agent.mcp_headers_error_json_object"));return}if(Object.entries(t).every(e=>{let[t,s]=e;return"string"==typeof t&&"string"==typeof s}))e=t;else{q.Z.error(m("agent.mcp_headers_error_string_values"));return}}catch(t){if(y.trim().includes(":")){q.Z.error(m("agent.mcp_headers_error_format"));return}e={Authorization:y.trim()}}let t={title:v.trim(),url:b.trim(),header:e,select_status:!0,attribution:"user",scope_auth:"personal"};try{var s,l,r;let e=[...(null===(l=a.sub_topics)||void 0===l?void 0:null===(s=l[0])||void 0===s?void 0:s.tools)||[]],o=[...i,t],c=e.findIndex(e=>"mcp_services"===e.name),d={name:"mcp_services",config:{list:o}};c>=0?e[c]=d:e.push(d);let u=t$(e.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name));if((await (0,ea.WN)(a.short_id,u)).success){n(o);let t={...a,sub_topics:(null===(r=a.sub_topics)||void 0===r?void 0:r.map((t,s)=>0===s?{...t,tools:e}:t))||[]};eX.Z.getState().setTemplate(t),q.Z.success(m("agent.mcp_service_add_success")),f(""),j(""),w(""),k(null),g(!1)}else q.Z.error(m("agent.mcp_service_add_local"))}catch(e){q.Z.error(m("agent.mcp_service_add_local"))}},M=async e=>{if("isa"!==e.attribution||!e.auth_status||d){if(e.auth_status){await B(e.id,e.name);return}try{A(e.id);let{isAuthorized:n,data:r}=await (0,tK.q)(e.id);if(n){if(!(null==a?void 0:a.short_id)){o(e.id,!0),h.success(m("agent.mcp_auth_success",{name:e.name}));return}try{var t,s,l,i;let n=[...(null===(s=a.sub_topics)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:t.tools)||[]],r=n.findIndex(e=>"external_tool_services"===e.name),c=r>=0?n[r]:{name:"external_tool_services",config:{list:[]}};(null===(l=c.config)||void 0===l?void 0:l.list)||(c.config={list:[]});let d=c.config.list.findIndex(t=>t.external_tool_id===e.id),u={external_tool_id:e.id,scope_auth:e.scope_auth||"personal",attribution:e.attribution,auth_status:!0,select_status:!0};d>=0?c.config.list[d]=u:c.config.list.push(u),r>=0?n[r]=c:n.push(c);let p=t$(n.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name));if((await (0,ea.WN)(a.short_id,p)).success){o(e.id,!0);let t={...a,sub_topics:(null===(i=a.sub_topics)||void 0===i?void 0:i.map((e,t)=>0===t?{...e,tools:n}:e))||[]};eX.Z.getState().setTemplate(t),h.success(m("agent.mcp_auth_success",{name:e.name}))}else h.error(m("agent.mcp_install_save_failed"))}catch(e){}}else r?(C({id:r.external_tool_id,name:r.other_info.name,url:r.redirect_uri}),T(!0)):h.error(m("agent.mcp_auth_check_failed"))}catch(e){h.error(m("agent.mcp_auth_check_failed"))}finally{A(null)}}},U=async()=>{if(Z&&(null==a?void 0:a.short_id))try{var e,t,s,l,i;let n=[...(null===(t=a.sub_topics)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.tools)||[]],r=n.findIndex(e=>"external_tool_services"===e.name),c=r>=0?n[r]:{name:"external_tool_services",config:{list:[]}};(null===(s=c.config)||void 0===s?void 0:s.list)||(c.config={list:[]});let d=c.config.list.findIndex(e=>e.external_tool_id===Z.id),u={external_tool_id:Z.id,scope_auth:"personal",attribution:null===(l=I.find(e=>e.id===Z.id))||void 0===l?void 0:l.attribution,auth_status:!0,select_status:!0};d>=0?c.config.list[d]=u:c.config.list.push(u),r>=0?n[r]=c:n.push(c);let p=t$(n.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name));if((await (0,ea.WN)(a.short_id,p)).success){o(Z.id,!0);let e={...a,sub_topics:(null===(i=a.sub_topics)||void 0===i?void 0:i.map((e,t)=>0===t?{...e,tools:n}:e))||[]};eX.Z.getState().setTemplate(e),h.success(m("agent.mcp_auth_success",{name:Z.name}))}else h.error(m("agent.mcp_auth_save_failed"))}catch(e){h.error(m("agent.mcp_auth_save_failed"))}},B=async(e,t)=>{if(!(null==a?void 0:a.short_id)){q.Z.error(m("agent.mcp_missing_template_id"));return}try{if(P(e),(await (0,tK.c)(e)).success)try{var s,l,i,n;let r=[...(null===(l=a.sub_topics)||void 0===l?void 0:null===(s=l[0])||void 0===s?void 0:s.tools)||[]],c=r.findIndex(e=>"external_tool_services"===e.name);if(c>=0){let s=r[c];if(null===(i=s.config)||void 0===i?void 0:i.list){let l=s.config.list.findIndex(t=>t.external_tool_id===e);if(l>=0){let e=s.config.list[l];"user"===e.attribution?s.config.list.splice(l,1):s.config.list[l]={...e,auth_status:!1}}r[c]=s;let i=t$(r.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name));if((await (0,ea.WN)(a.short_id,i)).success){o(e,!1);let s={...a,sub_topics:(null===(n=a.sub_topics)||void 0===n?void 0:n.map((e,t)=>0===t?{...e,tools:r}:e))||[]};eX.Z.getState().setTemplate(s),h.success(m("agent.mcp_auth_revoked",{name:t}))}else h.success(m("agent.mcp_revoke_save_failed"))}}else o(e,!1),h.success(m("agent.mcp_auth_revoked",{name:t}))}catch(e){h.error(m("agent.mcp_revoke_save_failed"))}else h.error(m("agent.mcp_auth_revoke_failed",{name:t}))}catch(e){h.error(m("agent.mcp_auth_revoke_failed",{name:t}))}finally{P(null)}},O=async e=>{if(!(null==a?void 0:a.short_id)){q.Z.error(m("agent.mcp_missing_template_id"));return}try{var t,s,l;let r=i.filter((t,s)=>s!==e),o=[...(null===(s=a.sub_topics)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:t.tools)||[]],c=o.findIndex(e=>"mcp_services"===e.name),d={name:"mcp_services",config:{list:r}};c>=0?o[c]=d:o.push(d);let u=t$(o.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name));if((await (0,ea.WN)(a.short_id,u)).success){n(r);let e={...a,sub_topics:(null===(l=a.sub_topics)||void 0===l?void 0:l.map((e,t)=>0===t?{...e,tools:o}:e))||[]};eX.Z.getState().setTemplate(e),h.success(m("agent.mcp_service_delete_success"))}else q.Z.error(m("agent.mcp_service_delete_local"))}catch(e){q.Z.error(m("agent.mcp_service_delete_local"))}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(Y.Vq,{open:t,onOpenChange:s,children:(0,l.jsxs)(Y.cZ,{className:"max-w-sm sm:max-w-2xl lg:max-w-4xl max-h-[90vh] overflow-y-auto",onOpenAutoFocus:e=>e.preventDefault(),children:[(0,l.jsx)(Y.fK,{className:"flex justify-start flex-row items-center pb-0 pt-6",children:(0,l.jsx)("h2",{className:"text-2xl font-semibold",children:m("agent.mcp_tools")})}),(0,l.jsxs)(Y.a7,{className:"my-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("div",{className:"text-lg font-semibold",children:m("agent.mcp_tool_section")}),(0,l.jsxs)("button",{className:"text-primary text-sm hover:underline",onClick:()=>{g(!0)},children:["+ ",m("agent.mcp_add_service")]})]}),(0,l.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:I.map(e=>{let t=D===e.id,s=z===e.id,a="public"!==e.scope_auth||d&&"public"===e.scope_auth&&"isa"===e.attribution,i="isa"===e.attribution,n=t?m("agent.mcp_checking"):s?m("agent.mcp_uninstalling"):i&&!d?e.auth_status?m("agent.mcp_authorized"):m("agent.mcp_authorize"):e.auth_status?m("agent.mcp_uninstall"):m("agent.mcp_authorize"),r=t||s||e.disabled||i&&!d&&e.auth_status;return(0,l.jsxs)("div",{className:"border rounded-lg p-4 flex flex-col gap-2 relative",children:[(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("img",{src:e.icon,alt:e.name,className:(0,eR.cn)("w-5 h-5",("ModelContextProtocol"===e.name||"Notion"===e.name)&&"dark:brightness-0 dark:invert")}),t&&(0,l.jsx)("div",{className:"absolute -bottom-1 -right-1 bg-primary text-white rounded-full p-1 flex items-center justify-center w-4 h-4",children:(0,l.jsx)(tY.Z,{size:10,className:"animate-spin"})})]}),(0,l.jsxs)("span",{className:"font-medium text-sm",children:[e.name,"public"===e.scope_auth&&(0,l.jsxs)("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",m("agent.mcp_public"),")"]}),i&&(0,l.jsxs)("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",m("agent.mcp_isa_config"),")"]})]})]}),(0,l.jsx)("div",{className:"ml-auto",children:a&&(0,l.jsx)("button",{className:"px-3 py-1 rounded text-xs whitespace-nowrap ".concat(e.auth_status&&(d||!i)?"bg-red-500 text-white hover:bg-red-600":i&&!d&&e.auth_status?"bg-green-500 text-white cursor-not-allowed":"bg-primary text-white hover:bg-primary/90"," ").concat(r?"opacity-50 cursor-not-allowed":""),disabled:r,onClick:()=>M(e),children:n})})]}),(0,l.jsx)(ef.pn,{children:(0,l.jsxs)(ef.u,{children:[(0,l.jsx)(ef.aJ,{asChild:!0,children:(0,l.jsx)("div",{className:"text-xs text-muted-foreground line-clamp-2",children:e.description})}),(0,l.jsx)(ef._v,{className:"max-w-[300px]",children:(0,l.jsx)("p",{children:e.description})})]})})]},e.id)})}),i.length>0&&(0,l.jsxs)("div",{className:"mt-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-2",children:m("agent.mcp_custom_tools")}),(0,l.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4",children:i.map((e,t)=>{e.scope_auth;let s="isa"===e.attribution;return(0,l.jsxs)("div",{className:"border rounded-lg p-4 flex flex-col gap-2",children:[(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsxs)("div",{className:"flex flex-1 mr-4 truncate items-center gap-2",children:[(0,l.jsx)("img",{src:"/icons/mcp/mcp.svg",alt:"MCP",className:"w-5 h-5 dark:brightness-0 dark:invert"}),(0,l.jsxs)("span",{className:"font-medium text-sm truncate",children:[e.title,s&&(0,l.jsxs)("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",m("agent.mcp_isa_config"),")"]})]})]}),!s&&(0,l.jsx)("button",{className:"px-3 py-1 rounded bg-red-500 text-white text-xs hover:bg-red-600 ml-auto",onClick:()=>O(t),children:m("agent.mcp_delete")})]}),(0,l.jsxs)("div",{className:"text-xs text-muted-foreground truncate",children:[m("agent.mcp_url_prefix")," ",e.url]}),Object.keys(e.header).length>0&&(0,l.jsx)("div",{className:"text-xs text-muted-foreground",children:m("agent.mcp_headers_count",{count:Object.keys(e.header).length})})]},t)})})]})]})]})}),(0,l.jsx)(tJ.Z,{isOpen:x,onOpenChange:g,serverTitle:v,onServerTitleChange:f,serverUrl:b,onServerUrlChange:j,serverHeader:y,onServerHeaderChange:w,testStatus:N,testLoading:S,onTest:R,onSubmit:L}),Z&&(0,l.jsx)(tX.Z,{serviceName:Z.name,serviceUrl:Z.url,serviceId:Z.id,isOpen:F,onClose:()=>{T(!1),C(void 0)},onSuccess:U})]})},t0=s(81080),t1=e=>{let{showTips:t,onCloseTips:s,onTipsClick:a,selectedServices:i=[]}=e,n=(0,_.useTranslations)(),[o,c]=(0,u.useState)(16),[d,m]=(0,u.useState)(!1),h=(0,u.useCallback)(()=>{t&&setTimeout(()=>{let e=document.querySelector('[data-testid="mcp-setting-button"]'),t=document.querySelector('[data-testid="mcp-tip-container"]');if(e&&t){let s=e.getBoundingClientRect(),l=t.getBoundingClientRect(),a=s.left+s.width/2-l.left;c(Math.max(16,Math.min(l.width-16,a))),d||m(!0)}},10)},[t,d]);return((0,u.useEffect)(()=>{if(!t){m(!1);return}h(),window.addEventListener("resize",h),window.addEventListener("scroll",h);let e=new MutationObserver(h),s=document.body;return s&&e.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style"]}),()=>{window.removeEventListener("resize",h),window.removeEventListener("scroll",h),e.disconnect()}},[t,h]),t&&(null==i?void 0:i.length)&&d)?(0,l.jsxs)("div",{className:"absolute left-0 right-0 top-full mt-2 z-10","data-testid":"mcp-tip-container",children:[(0,l.jsx)("div",{className:"absolute -top-[16px] w-0 h-0 border-l-[16px] border-l-transparent border-r-[16px] border-r-transparent border-b-[24px] border-b-[#E5E7EB] dark:border-b-[#2D3139]",style:{left:"".concat(o,"px"),transform:"translateX(-50%)"}}),(0,l.jsxs)("div",{className:"flex text-sm items-center bg-[#E5E7EB] dark:bg-[#2D3139] py-2 pl-4 pr-2 rounded-lg cursor-pointer transition-colors",onClick:a,children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{children:n("agent.mcp_personalization")}),(0,l.jsx)("div",{className:"flex items-center gap-2 ml-2",children:i.map(e=>(0,l.jsx)(tg(),{src:e.icon,alt:e.name,width:20,height:20,className:(0,eR.cn)("rounded",("ModelContextProtocol"===e.name||"Notion"===e.name)&&"dark:brightness-0 dark:invert")},e.id))})]}),(0,l.jsx)(r.Z,{onClick:e=>{e.stopPropagation(),s()},className:"ml-auto cursor-pointer",size:18})]})]}):null},t2=s(29634);let t5="hide_mcp_tips",t4={id:"mcp",name:"ModelContextProtocol",icon:"/icons/mcp/mcp.svg",description:"",hidden:!1,disabled:!1,scope_auth:"personal"};var t6=e=>{var t,s,a;let{template:i,isListModalVisible:n,onListModalClose:r}=e,o=(0,_.useTranslations)(),{isLogin:c}=(0,ec.ZP)(),[d,h]=(0,u.useState)(!1),[p,x]=(0,u.useState)(n||!1),[g,v]=(0,u.useState)(!0),[f,b]=(0,u.useState)([]),[j,y]=(0,u.useState)([]),[w,N]=(0,u.useState)([]),[k,S]=(0,u.useState)([]),[E,Z]=(0,u.useState)([]),F=(0,ec.ZP)(e=>e.userInfo),[T,D]=(0,u.useState)({});(0,u.useEffect)(()=>{b((0,tG.n)(o))},[o]),(0,u.useEffect)(()=>{"true"===t2.Z.get(t5)&&v(!1)},[]);let P=(0,u.useCallback)(()=>{var e,t,s,l;if(!(null==i?void 0:null===(t=i.sub_topics)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.tools)||!f.length){Z([]);return}let a=i.sub_topics[0].tools,n=[];try{let e=a.find(e=>"external_tool_services"===e.name);(null==e?void 0:null===(s=e.config)||void 0===s?void 0:s.list)&&e.config.list.forEach(e=>{let t=f.find(t=>t.id===e.external_tool_id);t&&n.push(t)});let t=a.find(e=>"mcp_services"===e.name);t&&(null===(l=t.config)||void 0===l?void 0:l.list)&&t.config.list.length>0&&n.push(t4)}catch(e){console.error("Error in getSelectedMCPServices:",e)}Z(n)},[null==i?void 0:i.sub_topics,f]);(0,u.useEffect)(()=>{P()},[P,j,w]),(0,u.useEffect)(()=>{var e,t,s,l;if(null==i?void 0:null===(t=i.sub_topics)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.tools){let e=i.sub_topics[0].tools,t=e.find(e=>"external_tool_services"===e.name);if(null==t?void 0:null===(s=t.config)||void 0===s?void 0:s.list){let e=t.config.list;y(e);let s={};e.forEach(e=>{void 0!==e.auth_status&&(s[e.external_tool_id]=e.auth_status)}),D(s)}else y([]),D({});let a=e.find(e=>"mcp_services"===e.name);if(null==a?void 0:null===(l=a.config)||void 0===l?void 0:l.list){let e=a.config.list;N(e),S(e.map((e,t)=>({id:"server-".concat(t),selected:e.select_status})).filter(e=>e.selected).map(e=>e.id))}else N([]),S([]);P()}},[null==i?void 0:i.short_id,null==i?void 0:null===(s=i.sub_topics)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:t.tools]),(0,u.useEffect)(()=>{void 0!==n&&x(n)},[n]);let I=async(e,t)=>{if(!(null==i?void 0:i.short_id)){q.Z.error(o("agent.mcp_missing_template_id"));return}e.startsWith("server-")?S(s=>{var l,a;let n=t?[...s,e]:s.filter(t=>t!==e),r=parseInt(e.replace("server-",""));N(e=>{let s=[...e];return s[r]&&(s[r]={...s[r],select_status:t}),s});let o=[...(null===(a=i.sub_topics)||void 0===a?void 0:null===(l=a[0])||void 0===l?void 0:l.tools)||[]],c=o.findIndex(e=>"mcp_services"===e.name);c>=0&&(o[c]={...o[c],config:{list:w.map((e,s)=>({...e,select_status:s===r?t:e.select_status})),selected:n}}),o.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name);let d={...i,sub_topics:i.sub_topics?[{...i.sub_topics[0],tools:o},...i.sub_topics.slice(1)]:[{title:"Default Topic",tools:o,source_type:"chat",instructions:"",llm_model:""}]};return eX.Z.getState().setTemplate(d),n}):y(s=>{var l,a;let n=s.findIndex(t=>t.external_tool_id===e),r=[...s];-1!==n?r[n]={...r[n],select_status:t}:r=[...s,{external_tool_id:e,scope_auth:"personal",attribution:"user",select_status:t}];let o=[...(null===(a=i.sub_topics)||void 0===a?void 0:null===(l=a[0])||void 0===l?void 0:l.tools)||[]],c=o.findIndex(e=>"external_tool_services"===e.name);c>=0?o[c]={...o[c],config:{list:r}}:o.push({name:"external_tool_services",config:{list:r}});let d={...i,sub_topics:i.sub_topics?[{...i.sub_topics[0],tools:o},...i.sub_topics.slice(1)]:[{title:"Default Topic",tools:o,source_type:"chat",instructions:"",llm_model:""}]};return eX.Z.getState().setTemplate(d),r})},R=async(e,t)=>{if(!(null==i?void 0:i.short_id)){q.Z.error(o("agent.mcp_missing_template_id"));return}D(s=>({...s,[e]:t})),t?y(s=>{var l,a;let n=s.find(t=>t.external_tool_id===e),r=[...s];if(n)r=s.map(s=>s.external_tool_id===e?{...s,auth_status:t}:s);else{let t=f.find(t=>t.id===e);t&&(r=[...s,{external_tool_id:e,scope_auth:t.scope_auth||"personal",attribution:t.attribution||"user",auth_status:!0,select_status:!0}])}let o=[...(null===(a=i.sub_topics)||void 0===a?void 0:null===(l=a[0])||void 0===l?void 0:l.tools)||[]],c=o.findIndex(e=>"external_tool_services"===e.name);c>=0?o[c]={name:"external_tool_services",config:{list:r}}:o.push({name:"external_tool_services",config:{list:r}});let d={...i,sub_topics:i.sub_topics?[{...i.sub_topics[0],tools:o},...i.sub_topics.slice(1)]:[{title:"Default Topic",tools:o,source_type:"chat",instructions:"",llm_model:""}]};return eX.Z.getState().setTemplate(d),r}):y(s=>{var l,a,n;let r=s.map(s=>s.external_tool_id===e?{...s,auth_status:t}:s),o=[...(null===(a=i.sub_topics)||void 0===a?void 0:null===(l=a[0])||void 0===l?void 0:l.tools)||[]],c=o.findIndex(e=>"external_tool_services"===e.name);c>=0&&(o[c]={...o[c],config:{list:r}}),o.filter(e=>"mcp_services"===e.name||"external_tool_services"===e.name);let d={...i,sub_topics:(null===(n=i.sub_topics)||void 0===n?void 0:n.map((e,t)=>0===t?{...e,tools:o}:e))||[]};return eX.Z.getState().setTemplate(d),r})},L=(()=>{let e=[],t=j.filter(e=>e.select_status);return(t.length>0&&t.forEach(t=>{let s=f.find(e=>e.id===t.external_tool_id);s&&e.push({icon:s.icon,name:s.name})}),w.filter(e=>e.select_status).forEach(()=>{e.push({icon:"/icons/mcp/mcp.svg",name:"ModelContextProtocol"})}),e.length>0)?e.slice(0,2):f.filter(e=>"Notion"===e.name||"Gmail"===e.name).map(e=>({icon:e.icon,name:e.name}))})(),U=j.some(e=>e.select_status)||w.some(e=>e.select_status);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t1,{template:i,showTips:g,onCloseTips:()=>{v(!1),t2.Z.set(t5,"true",{expires:30})},onTipsClick:()=>{if(!c){C.Z.getState().setLoginModalVisible(!0);return}x(!0)},selectedServices:(0,tG.n)(o)}),(0,l.jsxs)(z.J2,{open:d,onOpenChange:h,children:[(0,l.jsx)(z.xo,{asChild:!0,children:(0,l.jsxs)(A.A,{variant:"light",size:"sm",className:(0,m.cn)("border border-[#E6E9EF] dark:border-[#545D6F] bg-transparent hover:bg-accent hover:text-accent-foreground h-8 px-2 flex items-center gap-1.5","text-[#30394A] dark:text-[#FFFFFF]"),"data-testid":"mcp-setting-button",onClick:e=>{if(!c){e.preventDefault(),e.stopPropagation(),C.Z.getState().setLoginModalVisible(!0);return}0===j.length&&0===w.length&&(e.preventDefault(),e.stopPropagation(),x(!0))},children:[L.map((e,t)=>(0,l.jsx)("img",{src:e.icon,alt:e.name,className:(0,m.cn)("w-4 h-4 object-contain",("ModelContextProtocol"===e.name||"Notion"===e.name)&&"dark:brightness-0 dark:invert")},t)),U&&(0,l.jsx)(M.Z,{size:14})]})}),(0,l.jsx)(z.yk,{className:"w-auto max-h-[300px] overflow-y-auto overflow-x-hidden custom-scrollbar p-0 rounded-xl shadow-lg",align:"start",children:(0,l.jsxs)("section",{className:"w-[22em] max-w-[90vw]",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center px-6 pt-4",children:[(0,l.jsx)("h2",{className:"text-xs font-semibold opacity-60",children:o("agent.mcp_select_tools")}),(0,l.jsxs)("span",{className:"text-xs text-blue-500 cursor-pointer",onClick:()=>x(!0),children:["+ ",o("agent.mcp_add")]})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-1 p-2 text-sm",children:[j.map(e=>{let t=f.find(t=>t.id===e.external_tool_id);if(!t)return null;let s="isa"===e.attribution,a="public"===e.scope_auth,n=!0===e.auth_status,r=!!(null==i?void 0:i.creator),c=o("agent.mcp_authorized_connected");n||(c=a&&!r?o("agent.mcp_need_creator_auth"):o("agent.mcp_need_login_auth"));let d=!n&&!(a&&!r);return(0,l.jsx)("div",{className:(0,m.cn)("flex flex-col px-4 py-2 rounded-lg",d?"hover:bg-accent cursor-pointer":"hover:bg-accent"),onClick:()=>{d&&x(!0)},children:(0,l.jsxs)("div",{className:"grid grid-cols-[24px,1fr,auto] gap-3 items-center",children:[(0,l.jsx)("div",{className:"flex items-center justify-center",children:(0,l.jsx)("img",{src:t.icon,alt:t.name,className:(0,m.cn)("w-5 h-5 object-contain",("ModelContextProtocol"===t.name||"Notion"===t.name)&&"dark:brightness-0 dark:invert")})}),(0,l.jsxs)("div",{className:"flex flex-col min-w-0 py-0.5",children:[(0,l.jsxs)("div",{className:"flex items-center gap-1 flex-wrap",children:[(0,l.jsx)("span",{className:"truncate",children:t.name}),a&&(0,l.jsxs)("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:["(",o("agent.mcp_public"),")"]}),s&&(0,l.jsxs)("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:["(",o("agent.mcp_isa_config"),")"]})]}),(0,l.jsx)("div",{className:"text-xs text-muted-foreground",children:c})]}),(0,l.jsx)("div",{className:"flex items-center",onClick:e=>e.stopPropagation(),children:(0,l.jsx)(t0.X,{checked:"isa"===e.attribution||e.select_status,disabled:s,onCheckedChange:t=>I(e.external_tool_id,t)})})]})},e.external_tool_id)}),w.map((e,t)=>{let s="server-".concat(t),a="isa"===e.attribution;return(0,l.jsxs)("div",{className:"flex items-center gap-3 px-4 py-2 hover:bg-accent rounded-lg",children:[(0,l.jsx)("div",{className:"w-5 h-5",children:(0,l.jsx)("img",{src:"/icons/mcp/mcp.svg",alt:"MCP",className:"w-5 h-5 dark:brightness-0 dark:invert"})}),(0,l.jsxs)("span",{className:"flex-1 truncate",children:[e.title,a&&(0,l.jsxs)("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",o("agent.mcp_isa_config"),")"]})]}),(0,l.jsx)(t0.X,{checked:"isa"===e.attribution||k.includes(s),disabled:a,onCheckedChange:e=>I(s,e)})]},s)})]})]})})]}),(0,l.jsx)(tQ,{template:i,visible:p,onClose:()=>{x(!1),null==r||r()},mcpServices:w,onMcpServicesUpdate:e=>{N(e)},selectedTools:j,onAuthStatusUpdate:R,localAuthStatus:T,isCreator:(null==i?void 0:null===(a=i.creator)||void 0===a?void 0:a.uid)===F.uid})]})},t3=s(2854),t7=s(55480);let t9={ja:{id:"ccc3cfb0-c532-41b0-81f7-bfa2219adc4e",introduction:"Feloスライドショーは全面的にアップグレードされて、あなたのために独自の専用PPTをスマートにカスタマイズして、ワンクリックでYouTube、PDF、Webページを美しいスライドショーに変更して、期間限定で無料で体験します。",title:"Feloパワーポイント作成ツール",nickname:"Felo プレゼン",lang:"ja",short_id:"mN8pRx5nKq7YtE3HcV6bF2"},en:{id:"769aa342-ccb6-4f5e-8f9d-60e241a733d3",introduction:"Felo slides are fully upgraded, and unique and exclusive PPT can be intelligently customized for you. YouTube, PDF, and web pages can be converted into exquisite slides with one click. Free experience for a limited time.",title:"Felo Slides",nickname:"Felo Slides",lang:"en",short_id:"qP4dLw7kMv9ZuG5FnX8cH1"},"zh-Hant":{id:"88c0f987-a58a-4079-89e0-cd68aa8f2cbe",introduction:"Felo簡報全面升級，為你智能定製獨一無二的專屬PPT，一鍵將YouTube、PDF、網頁轉為精美幻燈片，限時免費體驗。",title:"Felo 簡報",nickname:"Felo 簡報",lang:"zh-Hant",short_id:"aTb9xK2mVp4WsR8CjL1eQ3"},ko:{id:"72416b09-3db4-48f9-908f-0f5f4d6b47e1",introduction:"Felo 슬라이드 전면 업그레이드, 당신을 위한 독특한 PPT 스마트 맞춤형, YouTube, PDF, 웹페이지를 클릭으로 아름다운 슬라이드로 변환할 수 있으며, 한정 시간 무료로 체험할 수 있습니다.",title:"초간편 Felo PPT 제작 마스터",nickname:"Felo 슬라이드",lang:"ko",short_id:"sT6hOz9pNw2ZxJ7KpY0dK4"},"zh-Hans":{id:"6a2aeeeb-ca81-4a63-9098-b94ff78e4e41",introduction:"Felo 幻灯片全面升级，为你智能定制独一无二的专属PPT，一键将YouTube、PDF、网页转为精美幻灯片，限时免费体验。",title:"Felo 幻灯片",nickname:"Felo 幻灯片",lang:"zh-Hans",short_id:"ePhFvdWnun2YQa97sf0ea714"},ru:{id:"e7f34d71-f35e-4d3b-9c6b-4bb400f82b5f",introduction:"Felo слайды полностью обновлены, уникальные и эксклюзивные PPT могут быть интеллектуально настроены для вас. YouTube, PDF и веб-страницы могут быть преобразованы в элегантные слайды с одним щелчком мыши. Бесплатный опыт в течение ограниченного времени.",title:"Felo PPT-мастер",nickname:"Felo PPT-мастер",lang:"ru",short_id:"vU8lRz1qOx4ZyM9NqZ2eM6"}},t8={created_at:"2025-06-05T09:03:51.050633",modified_at:"2025-07-01T06:49:44.973596",placeholder:"",category:"",system:!0,code:"ppt_generation_v2",icon_key:"https://cdn.felo.ai/felo-search/icons/Icon-17-new_v2.svg",slug:"ai-powerpoint-generator",sub_topics:[{title:"Felo PPT",source_type:"google",source_id:"",llm_model:"claude-3-7-sonnet",instructions:"***",tools:[{name:"web_search",config:null},{name:"web_scraper",config:null},{name:"ppt_outline_image_search",config:null},{name:"ppt_outline",config:null},{name:"summary_file",config:null},{name:"external_tool_services",config:{list:[],status:!0}},{name:"mcp_services",config:{list:[],status:!0}}],source_info:null}],template_type:1,params:[{name:"sys_hide_image",type:"hide_image",value:null},{name:"sys_hide_file",type:"hide_file",value:null},{name:"ppt_outline_edit",type:"sub_agent",value:null,config:{title:"Felo PPT",source_type:"google",source_id:"",llm_model:"claude-3-7-sonnet",instructions:"You are a professional outline revision and forwarding assistant...",tools:[{name:"web_search",config:null},{name:"web_scraper",config:null},{name:"ppt_outline_edit",config:null}]}},{name:"topBar",type:"top_bar",value:null,top_bar_list:[{name:"Ask Anything",type:"google",defaultSelected:!0,placeholder:"ask_anything"},{name:"Upload File",type:"chat_with_document",defaultSelected:!1,placeholder:"upload_file"},{name:"Long Text",type:"long_text",defaultSelected:!1,placeholder:"long_text"},{name:"Webpage",type:"web_summary",defaultSelected:!1,placeholder:"webpage"},{name:"YouTube",type:"video_summary",defaultSelected:!1,placeholder:"youtube"}]}],hide_instructions:!0,uid:null,is_deleted:!1,org_sharing:null,is_favorite:!1,owner:null,creator:null,permission:{is_self:!1,can_read:!0,read_permission:"PUBLIC",org_name:null,access_emails:null,is_change:!1},component:null,need_auths:[],tool_config:{hide_image:{name:"sys_hide_image",type:"hide_image",value:null},hide_file:{name:"sys_hide_file",type:"hide_file",value:null},sub_agent:{name:"ppt_outline_edit",type:"sub_agent",value:null,config:{title:"Felo PPT",source_type:"google",source_id:"",llm_model:"claude-3-7-sonnet",instructions:"You are a professional outline revision and forwarding assistant...",tools:[{name:"web_search",config:null},{name:"web_scraper",config:null},{name:"ppt_outline_edit",config:null}]}},top_bar:{name:"topBar",type:"top_bar",value:null,top_bar_list:[{name:"Ask Anything",type:"google",defaultSelected:!0,placeholder:"ask_anything"},{name:"Upload File",type:"chat_with_document",defaultSelected:!1,placeholder:"upload_file"},{name:"Long Text",type:"long_text",defaultSelected:!1,placeholder:"long_text"},{name:"Webpage",type:"web_summary",defaultSelected:!1,placeholder:"webpage"},{name:"YouTube",type:"video_summary",defaultSelected:!1,placeholder:"youtube"}]}}},se=e=>{let t=t9[e];return t?{...t8,...t}:{...t8,...t9.en}},st={ja:{id:"41c0c0bf-874c-4b30-9e65-80b821b1e7c7",introduction:"ウェブページを生成する",title:"HTMLページ生成",nickname:"",lang:"ja",short_id:"SvPSWyCSSEJsiL4KrduKJJ"},en:{id:"045b6d33-521c-4db1-b2a0-4538e8fd5360",introduction:"Generate a webpage",title:"HTML Generator",nickname:"",lang:"en",short_id:"DEs4rDwpKuezSiRDbcKi7o"},"zh-Hant":{id:"ba438031-c300-4912-bcb8-b02c4492b91d",introduction:"生成一個網頁",title:"生成網頁",nickname:"",lang:"zh-Hant",short_id:"fHByCETiZxXQuiXBxgT8p9"},"zh-Hans":{id:"1e072065-62f9-411a-be6b-d753c3e49e9f",introduction:"生成一个网页",title:"生成网页",nickname:"",lang:"zh-Hans",short_id:"8Rfzs6rWJkKoBDRiEoKUGd"},ko:{id:"a574d247-1883-405e-bd74-4d835df1598d",introduction:"웹페이지 생성하기",title:"HTML 생성기",nickname:"",lang:"ko",short_id:"Ed4crmaUbxVWjueqfamiKR"},ru:{id:"0fd28784-34b0-4412-8ab4-9d30dcba2c61",introduction:"Создание веб-страницы",title:"Генератор HTML",nickname:"",lang:"ru",short_id:"fj6hPrPE7dQz4mTVB4LSLk"}},ss={created_at:"2025-06-27T08:22:13.984192",modified_at:"2025-06-27T12:29:34.878820",placeholder:"",category:"",system:!0,code:"html_agent",icon_key:null,slug:null,sub_topics:[{title:"HTML",source_type:"google",source_id:"",llm_model:"claude-3-7-sonnet",instructions:"***",tools:[{name:"web_search",config:null},{name:"web_scraper",config:null},{name:"image_search",config:null},{name:"html_generator",config:null},{name:"summary_file",config:null},{name:"external_tool_services",config:{list:[],status:!0}},{name:"mcp_services",config:{list:[],status:!0}}],source_info:null}],template_type:1,params:[{name:"sys_hide_file",type:"hide_file",value:null},{name:"sys_hide_image",type:"hide_image",value:null},{name:"topBar",type:"top_bar",value:null,top_bar_list:[{name:"Ask Anything",type:"google",defaultSelected:!0,placeholder:"ask_anything"},{name:"Upload File",type:"chat_with_document",defaultSelected:!1,placeholder:"upload_file"},{name:"Long Text",type:"long_text",defaultSelected:!1,placeholder:"long_text"},{name:"Webpage",type:"web_summary",defaultSelected:!1,placeholder:"webpage"},{name:"YouTube",type:"video_summary",defaultSelected:!1,placeholder:"youtube"}]}],hide_instructions:!0,uid:null,is_deleted:!1,org_sharing:null,is_favorite:!1,owner:null,creator:null,permission:{is_self:!1,can_read:!0,read_permission:"PUBLIC",org_name:null,access_emails:null,is_change:!1},component:null,need_auths:[],tool_config:{hide_file:{name:"sys_hide_file",type:"hide_file",value:null},hide_image:{name:"sys_hide_image",type:"hide_image",value:null},top_bar:{name:"topBar",type:"top_bar",value:null,top_bar_list:[{name:"Ask Anything",type:"google",defaultSelected:!0,placeholder:"ask_anything"},{name:"Upload File",type:"chat_with_document",defaultSelected:!1,placeholder:"upload_file"},{name:"Long Text",type:"long_text",defaultSelected:!1,placeholder:"long_text"},{name:"Webpage",type:"web_summary",defaultSelected:!1,placeholder:"webpage"},{name:"YouTube",type:"video_summary",defaultSelected:!1,placeholder:"youtube"}]}}},sl=e=>{let t=st[e];return t?{...ss,...t}:{...ss,...st.en}};sl("en");var sa=s(53410),si=s(44342),sn=e=>{let{setPinDiscovery:t}=e,s=(0,_.useTranslations)(),a=(0,_.useLocale)(),{searchType:i,setSearchType:n}=(0,v.Z)(),{pinUserList:r,pinSystemList:d}=(0,t7.Z)(),{setHomeTemplate:m}=(0,eX.Z)(),h=(0,c.useRouter)(),x=(0,tF.Z)(),[g,f]=(0,u.useState)(!1),{setProSelected:b}=(0,v.Z)(),j=(0,ec.ZP)(e=>e.isLogin),{proUsageQuota:y}=(0,tq.I)(),{isMobile:w}=(0,si.b)(),{pinList:N,reorderPinList:k,setPinUserList:S,setPinSystemList:Z,setLoading:C}=(0,t7.Z)(),F=[{name:s("emoji.searchPlaceholder"),icon:(0,l.jsx)(E.Z,{size:20,className:"text-[#0080FF] dark:text-[#1EB1FF]"}),id:v.S.SEARCH,activeStyle:"border-theme-blue-500 text-theme-blue-500 bg-[#EDFAFF] dark:bg-[#0E335D] dark:text-[#1EB1FF] dark:border-[#1EB1FF]",hoverStyle:"hover:border-theme-blue-500 hover:text-theme-blue-500 hover:bg-[#EDFAFF] hover:dark:bg-[#0E335D] hover:dark:text-[#1EB1FF] hover:dark:border-[#1EB1FF]"},{name:s("research_analysis"),icon:(0,l.jsx)(t3.wC,{className:"text-[#268DBA] dark:text-[#B2E0FA] w-5 h-5"}),id:v.S.RESEARCH,activeStyle:"border-[#268DBA] text-[#268DBA] bg-[#ECF8FD] dark:bg-[#1A556E] dark:text-[#B2E0FA] dark:border-[#B2E0FA]",hoverStyle:"hover:border-[#268DBA] hover:text-[#268DBA] hover:bg-[#ECF8FD] hover:dark:bg-[#1A556E] hover:dark:text-[#B2E0FA] hover:dark:border-[#B2E0FA]"},{name:s("ppt_generation_v2"),icon:(0,l.jsx)(t3.rq,{className:"w-5 h-5 text-[#D14625] dark:text-[#E68054]"}),id:v.S.AI_PPT,activeStyle:"dark:bg-[#521D16] dark:border-[#E68054] dark:text-[#E68054] border-[#D14625] text-[#D14625] bg-[#FDF5EF]",code:"ppt_generation_v2",hoverStyle:"hover:dark:bg-[#521D16] hover:dark:border-[#E68054] hover:dark:text-[#E68054] hover:border-[#D14625] hover:text-[#D14625] hover:bg-[#FDF5EF]"},{name:s("html_agent"),icon:(0,l.jsx)(t3.fb,{className:"w-5 h-5 text-[#7651DC] dark:text-[#A496EF]"}),id:v.S.INTERACTIVE_WEBPAGE,activeStyle:"dark:bg-[#2A195C] dark:border-[#A496EF] dark:text-[#A496EF] border-[#7651DC] text-[#7651DC] bg-[#F5F4FE]",code:"html_agent",hoverStyle:"hover:dark:bg-[#2A195C] hover:dark:border-[#A496EF] hover:dark:text-[#A496EF] hover:border-[#7651DC] hover:text-[#7651DC] hover:bg-[#F5F4FE]"}];(0,u.useEffect)(()=>{void 0===j||j||i!==v.S.RESEARCH||n(v.S.SEARCH)},[j]);let T=async()=>{try{let e=await (0,sa.rc)({lang:a});S(e.user),Z(e.system),k()}catch(e){console.error("Failed to fetch pin list:",e)}finally{C(!1)}};(0,u.useEffect)(()=>{void 0!==j&&T()},[a,j]);let D=async e=>{let t=await (0,ea.VN)(e);if(t.data){var l;let e=await (0,eA.Y)(t.data.title),s=(0,ez.b)(e),a="/agents/".concat(s,"-").concat(null===(l=t.data)||void 0===l?void 0:l.short_id);m(t.data),window.history.pushState({},"",a)}else x.error(s("ppt.failed_generate"))},A=async e=>{if(!e.code){if(e.id===v.S.RESEARCH){if(!j){tu.$.publish("showLogin",void 0);return}if(0===y){tu.$.publish("showSubscriptionPlan",void 0);return}b(!0),t(!0,!0)}e.id===v.S.SEARCH&&t(!1,!0),n(e.id),m(null),window.history.pushState({},"","/search");return}n(e.id);try{let t;if("html_agent"===e.code)t=sl(a);else if("ppt_generation_v2"===e.code)t=se(a);else{var l,i;let a=d.find(t=>t.component_key===e.code),n=(null==a?void 0:null===(l=a.thread_template_tiny)||void 0===l?void 0:l.short_id)||(null==a?void 0:null===(i=a.attributes)||void 0===i?void 0:i.agent_id);if(!n){x.error(s("ppt.failed_generate"));return}t=(await (0,ea.VN)(n)).data}if(t){m(t);let e=await (0,eA.Y)(t.title),s=(0,ez.b)(e),l="/agents/".concat(s,"-").concat(t.short_id);window.history.pushState({},"",l),("ppt_generation_v2"===t.code||"html_agent"===t.code)&&D(t.short_id)}else x.error(s("ppt.failed_generate"))}catch(e){console.log("error:",e),x.error(s("ppt.failed_generate"))}},P=async e=>{f(!1),n(e.component_key||"");try{var t,l;let a=(null==e?void 0:null===(t=e.thread_template_tiny)||void 0===t?void 0:t.short_id)||(null==e?void 0:null===(l=e.attributes)||void 0===l?void 0:l.agent_id);if(!a){x.error(s("ppt.failed_generate"));return}D(a)}catch(e){x.error(s("ppt.failed_generate"))}},[I,R]=(0,u.useState)({});(0,u.useEffect)(()=>{d.forEach(e=>{e.icon_url&&L(e.icon_url)})},[d]),(0,u.useEffect)(()=>{r.forEach(e=>{e.icon_url&&L(e.icon_url)})},[r]);let L=async e=>{try{if(!e)return;let t=await (0,eR.U)(e);R(s=>({...s,[e]:t}))}catch(e){console.error("Failed to fetch SVG content")}},[M,U]=(0,u.useState)(w?2:F.length),B=(0,u.useRef)(null),O=(0,u.useRef)([]),W=(0,u.useRef)(null),H=(0,u.useCallback)(()=>{if(w){U(2);return}if(!B.current||!W.current)return;let e=B.current.offsetWidth-(W.current.offsetWidth+8),t=0;for(let s=0;s<F.length;s++){let l=O.current[s];if(l){let s=l.offsetWidth+8;if(e>=s)e-=s,t++;else break}}U(t<2?2:t)},[F.length,w]);return(0,u.useEffect)(()=>{let e=setTimeout(()=>{H()},100),t=()=>{H()};return window.addEventListener("resize",t),()=>{clearTimeout(e),window.removeEventListener("resize",t)}},[H,F.length]),(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsxs)("div",{className:"absolute opacity-0 pointer-events-none -z-10",children:[F.map((e,t)=>(0,l.jsxs)("button",{ref:e=>{O.current[t]=e},style:{boxShadow:"0px 2px 20px 0px #0061C30D"},className:"flex items-center rounded-3xl gap-2 px-4 py-2 text-sm font-medium transition-colors border ".concat(i===e.id?e.activeStyle:"border-transparent text-[#30394A] dark:text-white bg-white dark:bg-[#353B46]"," ").concat(e.hoverStyle),children:[e.icon,(0,l.jsx)("span",{children:e.name})]},"measure-".concat(e.id))),(0,l.jsxs)("button",{ref:W,className:"flex items-center rounded-3xl gap-2 px-4 py-2 text-sm font-medium transition-colors shadow-[0px_2px_20px_0px_#0061C30D] bg-white dark:bg-[#353B46] border border-transparent",children:[(0,l.jsx)(o.Z,{size:20}),(0,l.jsx)("span",{children:s("pinAll.more")})]})]}),(0,l.jsxs)("div",{ref:B,className:"flex overflow-hidden flex-wrap gap-2 justify-center w-[95vw] md:w-auto ml-[-2.5vw] md:ml-0",children:[F.slice(0,M).map(e=>(0,l.jsxs)("button",{tabIndex:-1,id:"agent-".concat(e.id),className:"flex items-center rounded-3xl gap-2 px-4 py-2 text-sm font-medium transition-colors border shadow-[0px_2px_20px_0px_#0061C30D] ".concat(i===e.id?e.activeStyle:"border-transparent text-[#30394A] dark:text-white bg-white dark:bg-[#353B46]"," ").concat(e.hoverStyle),onClick:()=>A(e),children:[e.icon,(0,l.jsx)("span",{children:e.name})]},e.id)),(0,l.jsxs)(z.J2,{open:g,onOpenChange:f,children:[(0,l.jsx)(z.xo,{asChild:!0,children:(0,l.jsxs)("button",{tabIndex:-1,className:"flex items-center rounded-3xl gap-2 px-4 py-2 text-sm font-medium transition-colors shadow-[0px_2px_20px_0px_#0061C30D] ".concat(g||!F.slice(0,M).map(e=>e.id).includes(i)?"bg-[#F6F7F9] border border-[#5F7698] text-[#5F7698] dark:bg-[#454E5D] dark:border-[#969FB0] dark:text-[#969FB0]":"bg-white dark:bg-[#353B46] border border-transparent"," hover:bg-[#F6F7F9] hover:border-[#5F7698] hover:text-[#5F7698] dark:hover:bg-[#454E5D] dark:hover:border-[#969FB0] dark:hover:text-[#969FB0]"),children:[(0,l.jsx)(o.Z,{size:20}),(0,l.jsx)("span",{children:s("pinAll.more")})]})}),(0,l.jsx)(z.yk,{className:"w-[300px] rounded-2xl p-2 max-h-[400px] overflow-y-auto custom-scrollbar dark:border-[#454E5D] dark:bg-[#353B46]",align:"start",side:"bottom",children:(0,l.jsxs)("div",{children:[r.length>0&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-sm mb-2 mt-1 ml-2 text-[#5F7698] dark:text-[#D0D4DC]",children:"Pin Agent"}),(0,l.jsx)("div",{className:"space-y-1",children:r.map(e=>{var t;return(0,l.jsx)(p.z,{variant:"ghost",className:"w-full h-10 hover:dark:bg-[#454E5D] text-[#30394A] dark:text-white justify-start text-left group ".concat(i===e.component_key?"border border-[#0080FF26] bg-[#0080FF26]":""),onClick:()=>P(e),children:(0,l.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(null==e?void 0:e.icon_url)?(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:I[e.icon_url]||""}}):(null==e?void 0:null===(t=e.attributes)||void 0===t?void 0:t.template_type)===ei.W.DEFAULT?(0,l.jsx)(eZ.WA,{className:"w-4 h-4"}):(0,l.jsx)(eZ.x0,{className:"w-4 h-4"})}),(0,l.jsx)("span",{className:"truncate max-w-[200px]",children:e.title})]}),i===e.component_key&&(0,l.jsx)(em.Z,{className:"w-4 h-4 text-[#0080FF] flex-shrink-0"})]})},e.component_key)})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-sm mb-2 dark:text-[#D0D4DC] mt-3 ml-2 text-[#5F7698]",children:s("pinAll.pin_agent_recommend_title")}),(0,l.jsx)("div",{className:"space-y-1",children:d.filter(e=>!r.some(t=>t.component_key===e.component_key)&&(M>=4?"ppt_generation_v2"!==e.component_key&&"html_agent"!==e.component_key:!(M>=3)||"ppt_generation_v2"!==e.component_key)).map(e=>{var t;return(0,l.jsx)(p.z,{variant:"ghost",className:"w-full h-10 hover:dark:bg-[#454E5D] text-[#30394A] dark:text-white dark:hover:border-[#969FB0] justify-start text-left group ".concat(i===e.component_key?"border border-[#0080FF26] bg-[#0080FF26]":""),onClick:()=>P(e),children:(0,l.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(null==e?void 0:e.icon_url)?(0,l.jsx)("span",{dangerouslySetInnerHTML:{__html:I[e.icon_url]||""}}):(null==e?void 0:null===(t=e.attributes)||void 0===t?void 0:t.template_type)===ei.W.DEFAULT?(0,l.jsx)(eZ.WA,{className:"w-4 h-4"}):(0,l.jsx)(eZ.x0,{className:"w-4 h-4"})}),(0,l.jsx)("span",{className:"truncate max-w-[200px]",children:e.title})]}),i===e.component_key&&(0,l.jsx)(em.Z,{className:"w-4 h-4 text-[#0080FF] flex-shrink-0"})]})},e.component_key)})})]}),(0,l.jsx)("div",{className:"text-center text-sm font-medium dark:text-[#1EB1FF] my-2 mt-2 cursor-pointer text-blue-500",onClick:()=>h.push("/agents"),children:s("pinAll.all_agent")})]})})]})]})]})},sr=s(33451),so=s(50933);let sc=()=>{let{points:e,isLoading:t,error:s,setPoints:l,deduct:a,startLoading:i,setError:n}=(0,sr.Z)(),r=(0,u.useCallback)(async()=>{if(!t){i();try{let e=await so.O7();l(e.points)}catch(e){n(e.message||"Failed to fetch points")}}},[t,i,l,n]),o=(0,u.useCallback)(async t=>{try{t.points&&null!==e&&a(t.points);let s=await so.Uh(t);if(!s.success)throw await r(),Error(s.message||"Failed to deduct points");return await r(),s}catch(e){throw await r(),n(e.message||"Failed to deduct points"),e}},[e,a,r,n]);return{points:e,isLoading:t,error:s,fetchPoints:r,deductPoints:o}};var sd=s(98795);let su=e=>(/^https?:\/\//i.test(e)||(e="https://"+e),e);var sm=u.memo(e=>{var t,s,d,w,N,k,S,E;let{className:Z,autoFocus:T,query:A,mode:z="default",isModal:P=!1,isFresh:I=!1,topicId:R,isMyTopic:L,onModeBarChange:M,needLogin:B=!1,isDisabled:O}=e,W=(0,_.useTranslations)(),q=(0,c.useRouter)(),Y="default"===z,{proUsageQuota:J}=(0,tq.I)(),{points:X,deductPoints:G}=sc(),[K,$]=(0,u.useState)(!1),{isDark:Q}=(0,j.Z)(),{isMobile:ee}=(0,y.Z)(),{homeFiles:et,isUploading:es,isImageUploading:el,homeImages:ea,setHomeFiles:en}=(0,e3.Z)(),er=(0,tc.Oi)("chatDocumentsUsage"),{homeFiles:eo,isUploading:ed,setHomeFiles:eu}=(0,tb.Z)(),em=(0,v.Z)(e=>e.searchValue),eh=(0,v.Z)(e=>e.setSearchValue),{handleFiles:ep}=tW({type:"home",threadId:""}),[ex]=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{leading:!1},[l,a]=(0,u.useState)(e),i=(0,u.useRef)(!1),n=(0,u.useRef)(null),r=(0,u.useRef)(!1),o=()=>window.clearTimeout(n.current);return(0,u.useEffect)(()=>{i.current&&(!r.current&&s.leading?(r.current=!0,a(e)):(o(),n.current=window.setTimeout(()=>{r.current=!1,a(e)},t)))},[e,s.leading,t]),(0,u.useEffect)(()=>(i.current=!0,o),[]),[l,o]}(em,200),[eg,ev]=(0,u.useState)(!0),[ef,e_]=(0,u.useState)(!1),[ey,ew]=(0,u.useState)(!1),eN=(0,u.useRef)(null),ek=(0,u.useRef)(null),eS=(0,u.useRef)(0),eE=(0,u.useRef)(null),{language:eZ,setLanguage:eC}=(0,tD.Z)(),eF=(0,v.Z)(e=>e.isBeginAnswer),{uploadFiles:eT}=(0,tE.Z)({}),eD=e=>{var t,s;"/"!==e.key&&"、"!==e.key||["INPUT","TEXTAREA"].includes((null===(t=document.activeElement)||void 0===t?void 0:t.tagName)||"")||document.activeElement instanceof HTMLElement&&document.activeElement.isContentEditable||(e.preventDefault(),null===(s=ek.current)||void 0===s||s.focus(),e_(!0))};(0,u.useEffect)(()=>P?P?(document.addEventListener("keydown",eD),()=>document.removeEventListener("keydown",eD)):void 0:(window.addEventListener("keydown",eD),()=>window.removeEventListener("keydown",eD)),[P]),(0,u.useEffect)(()=>{let e=e=>{var t;!e.target||(null===(t=eN.current)||void 0===t?void 0:t.contains(e.target))||e_(!1)};return window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}},[]);let eA=(0,ec.ZP)(e=>e.isLogin),ez=(0,v.Z)(e=>e.loading),eP=(0,v.Z)(e=>e.setLoading),eR=(0,v.Z)(e=>e.startSearch),eL=(0,v.Z)(e=>e.extensionSelected),eM=(0,v.Z)(e=>e.proSelected),eU=(0,v.Z)(e=>e.isDiscovery),eB=(0,v.Z)(e=>e.isResearch),eO=(0,v.Z)(e=>e.setIsDiscovery),eH=(0,v.Z)(e=>e.setIsResearch),eV=(0,eX.Z)(e=>e.template),eq=(0,u.useMemo)(()=>{var e,t;return(null==eV?void 0:null===(t=eV.tool_config)||void 0===t?void 0:null===(e=t.top_bar)||void 0===e?void 0:e.top_bar_list)||[]},[null==eV?void 0:null===(t=eV.toolsConfig)||void 0===t?void 0:t.topBar]),[eY,eJ]=(0,u.useState)((null===(s=eq.find(e=>e.defaultSelected))||void 0===s?void 0:s.type)||"google"),{selectModelValueList:eG}=(0,tT.Z)(),eK=(0,tF.Z)(),{isOpenThreadModal:e$,closeThreadModal:eQ}=(0,C.Z)(),[e0,e1]=(0,u.useState)(!1),e2=(0,ec.ZP)(e=>e.userInfo),[e5,e4]=(0,u.useState)(!1),e6=(0,tc.WI)(),e7=sr.Z.getState().pointsConfig,e9=(0,eX.Z)(e=>e.category),tt=(0,tc.ZP)(e=>e.isSearchOnlyProduct),{searchType:ts}=(0,v.Z)(),{isTopicSearchNetwork:tl,isFreshSearch:ta,setIsFreshSearch:ti,setIsTopicReply:tn,isTopicReply:tp,setWillBindTopicId:tx,isSingleAgentCanUse:tg,isFirstDeepCoerceR1:tv,setIsFirstDeepCoerceR1:tf,setSelectedModel:tj,setIsShowDeepTooltip:tw,selectedModel:tN}=(0,v.Z)();(0,u.useEffect)(()=>{!localStorage.getItem(U.VB+e2.email)&&eA&&e2.email&&!P&&(!eV||(null==eV?void 0:eV.template_type)!==ei.W.CUSTOM)&&(!eA||!e2.email||e6||e2.chat_model||eM||(0,V.N0)()?(localStorage.setItem(U.VB+e2.email,"true"),e4(!1)):e4(!0))},[eA,e2]),(0,u.useEffect)(()=>{R?(tx(R),eX.Z.getState().clearTemplate(),tn(!0)):(tx(""),tn(!1))},[R]),(0,u.useEffect)(()=>{(ts===v.S.SEARCH||ts===v.S.RESEARCH)&&eJ(U.gl)},[ts]);let tA=(0,u.useMemo)(()=>em.includes("\n"),[em]),{results:tz,dropDownSelected:tP,showQueryDropdownMenu:tI,reduceSearchResult:tR,addSearchResult:tL}=tr({enable:!eV&&!tA,value:em,debouncedValue:ex,inputRef:ek}),tM=U.N2,{subscriptionInfo:tU}=tc.ZP.getState(),tB=(0,u.useMemo)(()=>U.iu.find(e=>e===eL)&&eM,[eL,eM]);(0,u.useEffect)(()=>{void 0===eA||tB||t8(!1,!0)},[tB,eA]);let tO=(0,u.useMemo)(()=>!1,[eL]),tH=(0,u.useMemo)(()=>!!eV&&(0,tC.uI)(eV),[eV]),tY=(0,u.useMemo)(()=>!!eV&&(0,tC.el)(eV),[eV]),tJ=(0,u.useMemo)(()=>!!eV&&(0,tC.u1)(eV),[eV]),tX=(0,u.useMemo)(()=>{var e;return!!eV&&(null===(e=eV.params)||void 0===e?void 0:e.some(e=>(0,tC.Sc)(e.type)))},[eV]),tG=(0,u.useMemo)(()=>em.length>tM,[em]),tK=(0,u.useMemo)(()=>{let e=eV&&(0,tC.uI)(eV);return!((!e||(null==et?void 0:et.length)||em.trim())&&((null==eV?void 0:eV.template_type)!==ei.W.CUSTOM&&(null==eV?void 0:eV.template_type)!==ei.W.DIRECT_DUTY||e||em.trim()))||!eV&&!em.trim()},[em,eV,et]),t$=(0,u.useMemo)(()=>{var e,t;return(null!=et&&!!et.length||null!=ea&&!!ea.length)&&!!((null==et?void 0:et.length)&&(null==et?void 0:null===(e=et.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===e?void 0:e.length)||(null==ea?void 0:ea.length)&&(null==ea?void 0:null===(t=ea.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===t?void 0:t.length))},[et,ea]),tQ=(0,u.useMemo)(()=>{var e;return null==eo?void 0:null===(e=eo.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===e?void 0:e.length},[eo]),t0=(0,u.useMemo)(()=>tQ&&!ed,[tQ,ed]),t1=(0,u.useMemo)(()=>{if(t0)return!1;if(eY===U.J5&&!tQ)return!0;if((null==eV?void 0:eV.template_type)===ei.W.CUSTOM&&t$){if((0,tC.wd)(eV))return!1;if((0,tC.uI)(eV)&&!em.trim())return!0}return tK||tG||es||el||ed},[em,t0,eY,tQ,eV,t$,tK,tG,es,el,ed]),t2=(0,u.useMemo)(()=>{if(!(null==tU?void 0:tU.pointsUsage))return 0;let{balance:e,total_limit:t}=tU.pointsUsage;return t===sd.a.UNLIMITED?1/0:e},[tU]),t5=()=>{ek.current&&q.push("/websearch?q=".concat(ek.current.value))},t4=()=>{var e,t,s,l,a,i,n,r,o,c,d;if(!ek.current)return;let u=ek.current.value.trim();if(-1!==tP&&(u=tz[tP].title),!u&&!eV)return;eV&&(0,tC.wd)(eV)&&!u&&(u=W("generate_PPT_by_content"));let m={query:u};if((tB&&eB||eV)&&!R){if((null==eV?void 0:eV.template_type)===ei.W.CUSTOM||(null==eV?void 0:eV.template_type)===ei.W.DIRECT_DUTY){let e=eV;tY&&(e={...eV,params:null===(l=eV.params)||void 0===l?void 0:l.map(e=>(0,tC.YX)(e.type)?{...e,value:eZ}:e)}),t_.Z.getState().setTemplateData({templateQuery:u,template:e}),eX.Z.getState().setTemplate(e);let t=eV.sub_topics[0].source_type;m.category=t,m.model=eV.sub_topics[0].llm_model,t===U.RQ&&(m.topicId=eV.sub_topics[0].source_id)}else{eX.Z.getState().openAgentPlanModal(u);return}}if(eV){let e=(0,tC.uI)(eV),t=null==eo?void 0:null===(a=eo.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===a?void 0:a.length;if(!e&&!u&&!t)return}let p=(null==eV?void 0:eV.template_type)===ei.W.CUSTOM;if(!R&&((null==et?void 0:null===(e=et.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===e?void 0:e.length)||(null==eo?void 0:null===(t=eo.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===t?void 0:t.length))&&(p||(m.category=U.J5),r=[...et,...eo],m.documents=void 0===r?void 0:null===(n=r.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===n?void 0:null===(i=n.map(e=>null==e?void 0:e.id))||void 0===i?void 0:i.join(","),(null==eo?void 0:null===(o=eo.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===o?void 0:o.length)&&(m.documentAction="summary",u||(m.query=(null==eV?void 0:eV.code)===tk.m5?W("searchAddition.generate_ppt_from_file"):W("searchAddition.summary_file")))),!R&&(null==ea?void 0:null===(s=ea.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===s?void 0:s.length)&&(p||(m.category=U.Ys),m.documents=null==ea?void 0:null===(d=ea.filter(e=>(null==e?void 0:e.status)==="completed"))||void 0===d?void 0:null===(c=d.map(e=>null==e?void 0:e.id))||void 0===c?void 0:c.join(",")),tp&&(m.topicSource="topic"),R&&(m.category=U.gl,m.topicSource="topic",m.topicId=R),eU&&(m.mode=U.iV),eV&&(m.templateId=eV.id,m.category="long_text"===e9&&tQ?U.J5:e9),[tk.m5,tk.PZ].includes((null==eV?void 0:eV.code)||"")){let e=(0,h.MD)({...m,category:U.Wh,prefix:"/thread-chat"}),t="";switch(null==eV?void 0:eV.code){case tk.m5:t="/slides/".concat(tk.yw,"?chatUrl=").concat(encodeURIComponent(e));break;case tk.PZ:t="/page/".concat(tk.yw,"?chatUrl=").concat(encodeURIComponent(e),"&business_type=AGENT_THREAD")}q.push(t,void 0,{scroll:!0}),eP(!1);return}let x=(0,h.MD)(m);q.push(x,void 0,{scroll:!0})},t3=()=>{tu.$.publish("showLogin",void 0)},t7=async e=>{var t,s,l,a,i,n;if(e.preventDefault(),eV&&!eA||ts===v.S.RESEARCH&&!eA){t3();return}let r=null!==(i=null==e7?void 0:null===(t=e7.find(e=>"RESEARCH_AGENT"===e.deduction_item))||void 0===t?void 0:t.points)&&void 0!==i?i:0;if(ts===v.S.RESEARCH&&"number"==typeof t2&&t2<r||eV&&0===t2){tu.$.publish("felo_showPaidModal",{type:"INSUFFICIENT_POINTS"});return}if(eM&&ts===v.S.SEARCH&&0===t2&&0===J){tu.$.publish("felo_showPaidModal",{type:"INSUFFICIENT_QUERIES"});return}if(eB||eL===U.Wh&&(null==eV?void 0:eV.short_id)!==tk.m5){if(null!==X&&X<10){eK.error(W("points.insufficient"));return}try{await G({action:eB?"RESEARCH":"AGENT_SEARCH",points:10})}catch(e){eK.error(e.message||W("points.deduction_failed"));return}}if(ez)return;if(B&&!eA){t3();return}if(t1)return;if(!eV&&tt&&(0,h.eF)()){eK.custom(W("cannot_use_model"));return}let o=(null==eV?void 0:eV.template_type)===ei.W.CUSTOM;if(o&&eV&&st(eV)){$(!0);return}if((o||R||null==et||!et.filter(e=>"completed"===e.status).length||(v.Z.getState().setExtensionSelected(U.J5),await se()))&&(R&&eX.Z.getState().clearTemplate(),await (0,F.f)({query:null===(l=ek.current)||void 0===l?void 0:null===(s=l.value)||void 0===s?void 0:s.trim(),setLoading:eP}))){if(-1===tP)eR("form"),t4();else{let e=tz[tP];if("site"===e.type){let t=su(e.domain);window.open(t,"_blank")}else eR("form"),t4()}!0===e$&&eQ(),R&&(0,eb.fk)(L?ej.U.COLLECTION_THREAD_SUBMIT:ej.U.COLLECTION_SHARE_THREAD_SUBMIT,{query:null===(n=ek.current)||void 0===n?void 0:n.value,webSearch:tl},!0),(0,eb.fk)(Y?ej.U.SEARCH_SUBMIT:ej.U.THREAD_NEW,{query:null===(a=ek.current)||void 0===a?void 0:a.value},!0),t9()}},t9=()=>{eh(""),ek.current&&(ek.current.value="",ek.current.focus())};(0,u.useEffect)(()=>(ev(!1),()=>{ta&&ti(!1)}),[]),(0,u.useEffect)(()=>{(0,H.f8)(()=>{if(ek.current&&T){ek.current.focus();let e=(A||"").length;ek.current.setSelectionRange(e,e)}})},[]);let t8=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];eO(e),eH(!1),t&&e&&(0,eb.fk)(ej.U.PRO_DISCOVERY_SEARCH,{},!0)},se=async()=>{var e;let{subscriptionInfo:t}=tc.ZP.getState();return console.log("subscriptionInfo",t),!!t&&(!!er||!(0>=((null==t?void 0:null===(e=t.chatDocumentsUsage)||void 0===e?void 0:e.balance)||0))||(tu.$.publish("showSubscriptionPlan",void 0),!1))},st=e=>{var t,s,l;if(!(null==e?void 0:null===(s=e.sub_topics)||void 0===s?void 0:null===(t=s[0])||void 0===t?void 0:t.tools))return!1;let a=e.sub_topics[0].tools.find(e=>"external_tool_services"===e.name);return null!=a&&null!==(l=a.config)&&void 0!==l&&!!l.list&&a.config.list.filter(e=>!!e.select_status&&!1===e.auth_status).length>0};(0,u.useEffect)(()=>{void 0!==eA&&(eM?U.Wh:t8(!1))},[eM,eA]),(0,u.useEffect)(()=>{A&&eh(A)},[A]),(0,u.useEffect)(()=>{},[eF]),(0,u.useEffect)(()=>{M&&M(!!(tB&&!R))},[tB,R]);let ss=[{id:"quick",icon:(0,l.jsx)(to.RK,{className:"w-4 h-4"}),label:W("quick_search"),isActive:!eU&&!eB,display:!0,onClick:()=>t8(!1,!0),disabled:!1},{id:"discovery",icon:(0,l.jsx)(a.Z,{size:16}),label:W("study_search"),isActive:eU&&!eB,display:!0,onClick:()=>{t8(!0,!0)},disabled:!1,tooltipLable:W("deep_research_desc")},{id:"research",icon:(0,l.jsx)(i.Z,{className:"w-4 h-4"}),label:W("extension.search_agent"),isActive:eB,display:!1,onClick:()=>eH(!0),disabled:!1}],sl=e=>{let{mode:t,isFirst:s,isLast:a,disabled:i,id:n}=e,r=(0,m.cn)("flex items-center gap-1 border px-2 py-1 cursor-pointer","text-[#98A2B3] border-[#E4E7EC] dark:border-[#434955] dark:text-[#797E8D]",t.isActive&&"text-[#0080FF] dark:text-[#0080FF]",i&&"cursor-default opacity-50",s&&"rounded-s-lg",!s&&"border-l-0",a&&"rounded-e-lg");return(0,l.jsx)(l.Fragment,{children:t.tooltipLable?(0,l.jsx)(x.e,{delay:0,closeDelay:0,content:t.tooltipLable,classNames:{content:["text-white bg-gray-600 dark:bg-[#353535]"]},children:(0,l.jsxs)("div",{className:r,id:"mode-".concat(n),onClick:()=>!i&&t.onClick(),children:[t.icon,t.label]})}):(0,l.jsxs)("div",{className:r,id:"mode-".concat(n),onClick:()=>!i&&t.onClick(),children:[t.icon,t.label]})})};(0,u.useEffect)(()=>(e1(!0),()=>{e1(!1)}),[]);let sa=(0,u.useMemo)(()=>e0?(null==eV?void 0:eV.code)==="ppt_generation_v2"?W("ppt_placeholder_desc"):(null==eV?void 0:eV.code)==="html_agent"?W("html_agent_placeholder_desc"):"long_text"===eY?W("agentConfig.paste_text_here"):"chat_with_document"===eY?W("agentConfig.supports_PDF_Doc_TXT"):"web_summary"==eY?W("agentConfig.paste_url_here"):"video_summary"===eY?W("agentConfig.paste_video_link_here"):eV?eV.placeholder||W("search_placeholder"):R?W("search_placeholder"):eU?W("research_placeholder_desc"):eB?W("agent.input_research_question"):W("search_placeholder"):W("search_placeholder"),[eV,eU,eB,e0,W,R,eY]),si=e=>{let t=new Date,s=new File([e],e.slice(0,20)+".txt",{type:"text/plain",lastModified:t.getTime()});Object.defineProperty(s,"lastModifiedDate",{value:t}),Object.defineProperty(s,"webkitRelativePath",{value:""});let l=new DataTransfer;l.items.add(s),ep(l.files)},so=(0,u.useCallback)(e=>{var t;if(null==et?void 0:et.length)return;let s=e.clipboardData.getData("text");if(s.length>4e3&&"long_text"===eY){si(s),e.preventDefault();return}if(eV&&!(0,tC.uI)(eV)||R||(null==et?void 0:et.length))return;let l=null===(t=e.clipboardData)||void 0===t?void 0:t.items,a=null==l?void 0:l[0];if(!a||!a.type.startsWith("image"))return;let i=a.getAsFile();if(i){e.preventDefault(),eT([i]);return}},[eY,eA,et]);return(0,l.jsxs)(l.Fragment,{children:[!R&&(0,l.jsx)(sn,{setPinDiscovery:t8}),(0,l.jsx)("form",{ref:eN,className:(0,m.cn)("flex justify-center",Z),onSubmit:t7,children:(0,l.jsx)("div",{className:"rounded-2xl w-full",children:(0,l.jsx)("div",{className:(0,m.cn)("rounded-2xl w-full gap-2 relative","gap-2"),children:(0,l.jsxs)("div",{className:(0,m.cn)("pt-[18px] pb-6 px-6","h-full w-full rounded-2xl relative border-1 border-[#E6E9EF] dark:border-[#545D6F] bg-white dark:bg-[#353B46]",!es&&eL===U.J5&&ey?"border-primary  bg-sky-50/80":""),style:{boxShadow:"0px 0px 20px 0px #0061C314"},onDragEnter:e=>{e.preventDefault(),e.stopPropagation(),eS.current+=1,1===eS.current&&ew(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),eS.current-=1,0===eS.current&&ew(!1)},onDragOver:e=>{e.preventDefault(),e.stopPropagation()},onDrop:e=>{var t;if(e.preventDefault(),e.stopPropagation(),ew(!1),eS.current=0,e3.Z.getState().isUploading)return;let{files:s}=e.dataTransfer;console.log("files",s),(null==s?void 0:s.length)&&(null===(t=eE.current)||void 0===t||t.handleFiles(s))},children:[(0,l.jsxs)("div",{className:(0,m.cn)("flex items-center justify-center rounded-xl h-full absolute top-0 left-0 right-0 bottom-0 gap-1 pointer-events-none z-50  text-primary bg-white/70 dark:bg-black/70",!es&&eL===U.J5&&ey?"":"hidden"),children:[(0,l.jsx)(n.Z,{size:22}),W("searchAddition.drop_your_file_here")]}),R&&eM&&(0,l.jsx)("div",{className:"group -mx-3 -mt-4 h-[40px] flex justify-between items-center rounded-t-xl px-3 py-3 bg-[#F9FAFB] dark:bg-[#2F333C] min-h-10 mb-2",children:(0,l.jsxs)("div",{className:"w-full flex items-center text-sm text-gray-400 overflow-hidden gap-3",children:[(0,l.jsx)("div",{className:"flex items-center dark:bg-[#2d313a]",children:ss.map((e,t)=>e.display?(0,l.jsx)(sl,{mode:e,isFirst:0===t,id:e.id,isLast:t===ss.filter(e=>e.display).length-1,disabled:e.disabled||tO},e.id):null)}),(0,l.jsx)("span",{className:"flex-1 line-clamp-1 text-[#98A2B3] dark:text-[#797E8D]",children:eB?W("research_desc"):eU?W("deep_search_desc_placeholder"):W("quick_search_desc")})]})}),(null==eV?void 0:null===(N=eV.tool_config)||void 0===N?void 0:null===(w=N.top_bar)||void 0===w?void 0:null===(d=w.top_bar_list)||void 0===d?void 0:d.length)&&(null==eV?void 0:eV.code)!=="ppt_generation_v2"&&(null==eV?void 0:eV.code)!=="html_agent"&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(tV,{topTabType:eY,setTopTabType:e=>{e!==eY&&(en([]),eu([]),eJ(e))}})}),!R&&(0,l.jsx)(ty,{}),!R&&(0,l.jsx)(tS,{}),(0,l.jsxs)("div",{className:(0,m.cn)("flex relative",(null==eV?void 0:null===(E=eV.tool_config)||void 0===E?void 0:null===(S=E.top_bar)||void 0===S?void 0:null===(k=S.top_bar_list)||void 0===k?void 0:k.length)&&(null==eV?void 0:eV.code)!=="ppt_generation_v2"&&(null==eV?void 0:eV.code)!=="html_agent"&&"pt-3"),children:[(0,l.jsx)("span",{id:"modal"===z?"modal_search_form":"default_search_form",className:"invisible"}),(0,l.jsx)(g.Z,{ref:ek,className:(0,m.cn)(!Y&&"max-h-[40vh] overflow-y-auto scrollbar","m-0 w-full bg-inherit outline-none resize-none transition-height",em.length>tM&&"text-red-500","custom-scrollbar"),disabled:eg,value:em,onChange:e=>{e.target.value.length>4e3&&"long_text"===eY?si(e.target.value):eh(e.target.value)},onKeyDown:e=>{if(13===e.keyCode&&e.ctrlKey){e.preventDefault(),t5();return}if(13==e.keyCode&&!1==e.shiftKey&&!ee){var t;if(e.preventDefault(),0===tP){t5();return}null===(t=e.target.form)||void 0===t||t.requestSubmit()}"Escape"===e.key&&e$&&(e.preventDefault(),eQ()),"ArrowUp"===e.key&&tz.length>1&&(e.preventDefault(),tR()),"ArrowDown"===e.key&&tz.length>1&&(e.preventDefault(),tL())},onFocus:()=>e_(!0),minRows:4,maxRows:8,placeholder:sa,spellCheck:!1,rows:3,onPaste:so}),(0,l.jsx)("div",{className:em?"opacity-100":"opacity-0",children:(0,l.jsx)(x.e,{delay:0,closeDelay:0,content:W("clear_search_tip"),isDisabled:!em,children:(0,l.jsx)(p.z,{size:"icon",disabled:ez||!em,variant:"ghost",className:"h-8 w-8 rounded-full text-gray-600 dark:text-white hover:scale-105 hover:text-black","aria-label":W("clear_search_tip"),tabIndex:em?0:-1,onClick:t9,children:(0,l.jsx)(r.Z,{className:"h-4 w-4"})})})})]}),(0,l.jsxs)("div",{className:"flex flex-wrap w-full items-end justify-between gap-2",children:[(0,l.jsxs)("div",{className:"flex flex-wrap text-[#1d3c6d] dark:text-[#edf3fc] gap-2",children:[!R&&!eV&&!eU&&(0,l.jsx)(e8,{isDisalbedExtension:I}),tY&&!R?(0,l.jsx)("div",{className:"ml-3",children:(0,l.jsx)(tZ.Z,{hideAutoDetect:tX,language:eZ,onChangeLanguage:eC,template:eV})}):(0,l.jsxs)(l.Fragment,{children:[!R&&(!eV||tH)&&!eU&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(td.Z,{template:eV,ref:eE,type:"home",mode:z,isUseFileNewEngine:eV&&(0,tC.Of)(eV)})}),!R&&!eV&&!eU&&(0,l.jsx)(th.Z,{ref:eE})]}),R&&(0,l.jsx)(tm.Z,{isReply:!1}),b.r8&&(0,l.jsx)(f.Z,{}),eV&&(null==eV?void 0:eV.template_type)!==ei.W.DEFAULT&&(eV.system&&"ppt_generation_v2"===eV.code||!eV.system)&&(0,l.jsx)(t6,{template:eV,isListModalVisible:K,onListModalClose:()=>$(!1)})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[em.length>tM&&(0,l.jsx)("div",{className:"text-sm text-red-600",children:tM-em.length}),!tJ&&(0,l.jsx)(eW.ZP,{agentTemplate:null,isTopic:!!R}),ez?(0,l.jsx)(eI.c,{className:"px-2 h-8",classNames:{circle1:"".concat(Q?"border-b-white":"border-b-[#b3bcca]"),circle2:"".concat(Q?"border-b-white":"border-b-[#b3bcca]")},size:"sm"}):(0,l.jsx)(p.z,{size:"icon",type:"submit",className:(0,m.cn)("h-8 w-8 rounded-full hover:scale-105 transition-all",!t1||ez?"bg-[#0080FF] dark:bg-[#1EB1FF] hover:bg-[#0080FF]/90":"bg-[#E6E9EF] dark:bg-[#454E5D]"),disabled:t1||O,children:(0,l.jsx)(o.Z,{className:(0,m.cn)("h-4 w-4",!t1||ez?"text-white":"text-[#ACB9CD] dark:text-[#737F96]")})})]})]}),(0,l.jsxs)("div",{className:(0,m.cn)("absolute -left-px -right-px  z-10","hidden",!R&&!eV&&ef&&em&&eL!==U.J5&&eL!==U.Ys&&"block","mt-1.5","border border-[#E6E9EF] dark:border-[#545D6F]","rounded-b-xl bg-white dark:bg-[#353B46]"),children:[(0,l.jsx)("div",{className:"max-h-[19em] px-4 py-2 overflow-auto custom-scrollbar",children:tz.map((e,t)=>(0,l.jsx)(D,{data:e,selected:tP===t,goToTraditionalSearch:t5},e.title))}),eL!==U.aI&&eL!==U.J5&&eL!==U.Ys&&ef&&tI&&tz.length>1&&!ee&&(0,l.jsx)(te,{isDisalbedExtension:I})]})]})})})})]})})},81080:function(e,t,s){s.d(t,{X:function(){return o}});var l=s(52676),a=s(75271),i=s(24903),n=s(91165),r=s(37481);let o=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,l.jsx)(i.fC,{ref:t,className:(0,r.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:(0,l.jsx)(i.z$,{className:(0,r.cn)("flex items-center justify-center text-current"),children:(0,l.jsx)(n.Z,{className:"h-4 w-4"})})})});o.displayName=i.fC.displayName},62796:function(e,t,s){s.d(t,{c:function(){return n},q:function(){return i}});var l=s(27976),a=s(13263);let i=async e=>{let t=(0,a.LP)();try{let s=await fetch("".concat(l.XJ,"/threads/templates/tools/connect"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"".concat(t)},body:JSON.stringify({external_tool_id:e})});if((null==s?void 0:s.status)===403)return{isAuthorized:!1,message:"未授权访问"};if(null==s?void 0:s.ok){let e=await s.json();return{isAuthorized:"active"===e.status,data:e}}return{isAuthorized:!1,message:"请求失败"}}catch(e){return console.error("Error checking MCP tool authorization:",e),{isAuthorized:!1,message:"请求异常"}}},n=async e=>{let t=(0,a.LP)();try{let s=await fetch("".concat(l.XJ,"/threads/templates/tools/connect_reset"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"".concat(t)},body:JSON.stringify({external_tool_id:e})});if(null==s?void 0:s.ok){let e=await s.json();return{success:!0,message:e}}if((null==s?void 0:s.status)===422){let e=await s.json();return{success:!1,message:(null==e?void 0:e.message)||"参数校验失败"}}return{success:!1,message:"请求失败"}}catch(e){return console.error("Error resetting MCP tool authorization:",e),{success:!1,message:"请求异常"}}}},35525:function(e,t,s){var l=s(75910),a=s(65819);let i=(0,l.Ue)(e=>({isOpen:!1,callback:()=>{},setIsOpen:t=>e({isOpen:t}),getDataRetentionEnabled:()=>{var e,t;return null===(t=null===(e=a.ZP.getState().userInfo.settings)||void 0===e?void 0:e.ai_data_retention)||void 0===t||t},setCallback:t=>e({callback:t})}));t.Z=i},54047:function(e,t,s){let l=(0,s(75910).Ue)(e=>({showAgentLimitModal:!1,setShowAgentLimitModal:t=>e({showAgentLimitModal:t}),showLimitModalData:null,setShowLimitModalData:t=>e({showLimitModalData:t}),shareStep:1,setShareStep:t=>e({shareStep:t}),showAgentStatus:"PRIVATE",setShowAgentStatus:t=>e({showAgentStatus:t}),sharePermission:null,setSharePermission:t=>e({sharePermission:t}),updateSharePermission:t=>e(e=>({sharePermission:e.sharePermission?{...e.sharePermission,...t}:null}))}));t.Z=l}}]);